<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Azure VM のリストア (既存を置換) が失敗する | Japan CSS ABRS &amp; SCEM Support Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="皆様こんにちは、Azure Backup サポートの山本です。今回は、Azure VM Backup にて、対象の仮想マシンを 「VM の復元」-「構成の復元：既存を置換」にて「復元」を実行すると、「OlrBackupFailed」エラーが発生する場合の原因と対処法についてご案内します。 上記「OlrBackupFailed」エラーが発生した場合、考えられる要因として、対象の仮想マシンに対して「">
<meta property="og:type" content="article">
<meta property="og:title" content="Azure VM のリストア (既存を置換) が失敗する">
<meta property="og:url" content="https://jpabrs-scem.github.io/blog/AzureVMBackup/VM_Restorefail_invalid_protection/index.html">
<meta property="og:site_name" content="Japan CSS ABRS &amp; SCEM Support Blog">
<meta property="og:description" content="皆様こんにちは、Azure Backup サポートの山本です。今回は、Azure VM Backup にて、対象の仮想マシンを 「VM の復元」-「構成の復元：既存を置換」にて「復元」を実行すると、「OlrBackupFailed」エラーが発生する場合の原因と対処法についてご案内します。 上記「OlrBackupFailed」エラーが発生した場合、考えられる要因として、対象の仮想マシンに対して「">
<meta property="og:locale" content="ja_JP">
<meta property="og:image" content="https://user-images.githubusercontent.com/71251920/152478015-6ef0aea5-4143-4347-99b3-1eea5ec42b06.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/71251920/152478012-f216f599-44e5-4e0f-913e-5c0013071509.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/71251920/148112964-af3db82c-a70e-4fe0-bdab-8d0dddc58086.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/71251920/148112978-b25ab648-9245-4db6-a81e-bc7279595399.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/71251920/148112973-7caf6f19-c212-4f22-90ea-558998abc2d7.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/71251920/148112977-0cd72cb6-c2bb-403f-8100-cd25a5b02b44.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/71251920/148112975-73526fb8-4586-4cc9-863e-c3d314999398.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/71251920/148112970-9689b050-a986-4de4-b752-274624c4a17e.gif">
<meta property="og:image" content="https://user-images.githubusercontent.com/71251920/148112967-eaab9628-7f5e-4fd4-a11f-63faa6ad75b5.jpg">
<meta property="article:published_time" content="2022-02-05T03:00:00.000Z">
<meta property="article:modified_time" content="2022-02-10T15:32:43.053Z">
<meta property="article:author" content="Japan CSS ABRS &amp; SCEM Support Team">
<meta property="article:tag" content="Azure VM Backup">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/71251920/152478015-6ef0aea5-4143-4347-99b3-1eea5ec42b06.png">
  
    <link rel="alternate" href="../../atom.xml" title="Japan CSS ABRS &amp; SCEM Support Blog" type="application/atom+xml">
  

  <link rel="icon" href="../../favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
  <link rel="manifest" href="../../site.webmanifest">
  <link rel="mask-icon" href="../../safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="../../css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="site-header-logo"></div>
  <div id="site-header-blog-wrapper"></div>
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        <div id="ms-logo"></div>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
        <a class="main-nav-link" target="_blank" rel="noopener" href="https://cssjpn.github.io/">サポート情報</a>
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="../../atom.xml" title="RSSフィード"></a>
        
      </nav>
      <div id="search-form-wrap">
        <form action="//www.bing.com/search" method="get" accept-charset="UTF-8" name="bing-search" onsubmit="var f=this;if(f['q'].value){var searchUrl =  'https://www.bing.com/search?q=' +  encodeURIComponent(f['q'].value + ' site:' + f['sitesearch'].value) ;window.open(searchUrl, 'blank') };return false;" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="検索"><button type="submit" id="nav-search-btn" class="search-form-submit"></button><input type="hidden" name="sitesearch" value="https://jpabrs-scem.github.io/blog"></form>
      </div>
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="../../index.html" id="logo">Japan CSS ABRS &amp; SCEM Support Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="../../index.html" id="subtitle">Azure Backup,Azure Site Recovery,Azure Migrate および System Center 製品(Orchestrator , Operations/Virtual Machine/Service/Data Protection Manager)に関するサポート情報を発信します。</a>
        </h2>
      
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-AzureVMBackup/VM_Restorefail_invalid_protection" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header-single">
        
  
    <h1 class="article-title" itemprop="name">
      Azure VM のリストア (既存を置換) が失敗する
    </h1>
  

      </header>
      <div class="article-share">
        Last Update: 
        <a href="" class="article-date-single">
  <time datetime="2022-02-05T03:00:00.000Z" itemprop="datePublished">2022-02-05</time>
</a>
        
        
        <a href="https://jpabrs-scem.github.io/blog/issues/new?title=&body=%0A%0A---%0A%0A%23%23%23%23+Document+Details%0A%0A%E2%9A%A0+*Do+not+edit+this+section.%0A%0A*+ID%3A+946d5410-3e30-5150-b569-d739bc930c34%0A*+%E5%AF%BE%E8%B1%A1%E8%A8%98%E4%BA%8B%3A+%5BAzure+VM+%E3%81%AE%E3%83%AA%E3%82%B9%E3%83%88%E3%82%A2+%28%E6%97%A2%E5%AD%98%E3%82%92%E7%BD%AE%E6%8F%9B%29+%E3%81%8C%E5%A4%B1%E6%95%97%E3%81%99%E3%82%8B%5D%28https%3A%2F%2Fjpabrs-scem.github.io%2Fblog%2FAzureVMBackup%2FVM_Restorefail_invalid_protection%2F%29%0A*+Content+Source%3A+%5Barticles%2FAzureVMBackup%2FVM_Restorefail_invalid_protection.md%5D%28https%3A%2F%2Fjpabrs-scem.github.io%2Fblog%2Fblob%2Fmain%2Farticles%2FAzureVMBackup%2FVM_Restorefail_invalid_protection.md%29%0A*+Author%3A+" class="article-github-issue-link" target="_blank" rel="noopener noreferrer">feedback</a>
        
        <a data-url="https://jpabrs-scem.github.io/blog/AzureVMBackup/VM_Restorefail_invalid_protection/" data-id="ckzh53vv4000s0mqn7lb38tqi" class="article-share-link">共有</a>
      </div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <span id="more"></span>
<p>皆様こんにちは、Azure Backup サポートの山本です。<br>今回は、Azure VM Backup にて、対象の仮想マシンを <strong>「VM の復元」-「構成の復元：既存を置換」にて「復元」を実行すると、「OlrBackupFailed」エラーが発生する</strong>場合の原因と対処法についてご案内します。</p>
<p>上記「OlrBackupFailed」エラーが発生した場合、考えられる要因として、対象の仮想マシンに対して「バックアップの停止」を行っていることが考えられます。<br>（対象の仮想マシンに対して「バックアップの停止」を行っていない、後述のシナリオに合致しない等あれば、弊社までお問い合わせ願います。）</p>
<h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr>
<p><a href="#0">0.【前提】対象の VM の電源は停止しておく必要がございます</a><br><a href="#1">1. 該当シナリオ</a><br><a href="#2">2. 原因</a><br><a href="#3">3. 「構成の復元：既存を置換」として復元したい場合の回避策</a></p>
<hr>
<h3 id="【前提】対象の-VM-は停止してください。"><a href="#【前提】対象の-VM-は停止してください。" class="headerlink" title="【前提】対象の VM は停止してください。"></a>【前提】対象の VM は停止してください。<a id="0"></a></h3><p>既存を置換 にて復元する場合、ディスクのリストア後、対象 VM に対してディスクのスワップが実施されるため、対象の VM の電源は停止しておく必要がございます。<br>作業実施前にの画面ショットのように ”停止済み(割り当て解除)” であることを確認してください。<br><img src="https://user-images.githubusercontent.com/71251920/152478015-6ef0aea5-4143-4347-99b3-1eea5ec42b06.png" alt="OLR_premise_01"></p>
<p>VM を起動したまま実施した場合、下記のような Error Message、および 画面となり失敗します。(リストアのトリガー自体ができません。)<br>その場合は、上記の画面ショットの状態になるように VM の電源 を停止してください。</p>
<blockquote>
<p>エラー コード    UserErrorVmNotShutDown<br>エラー メッセージ    VM needs to be in deallocated state for performing replace disks operation<br>推奨される操作    Please shut down the VM, and retry</p>
</blockquote>
<p><img src="https://user-images.githubusercontent.com/71251920/152478012-f216f599-44e5-4e0f-913e-5c0013071509.png" alt="OLR_premise_02"></p>
<h2 id="1-該当シナリオ"><a href="#1-該当シナリオ" class="headerlink" title="1. 該当シナリオ"></a>1. 該当シナリオ<a id="1"></a></h2><p>１） 「VM の復元」を実行したい仮想マシンに対して、「バックアップの停止」を実施済である<br>（下図のように、「バックアップの停止」ボタンが非活性、「バックアップの再開」ボタンが活性、「前回のバックアップの状態：警告（バックアップが無効）」と表示されている状態となります）<br><img src="https://user-images.githubusercontent.com/71251920/148112964-af3db82c-a70e-4fe0-bdab-8d0dddc58086.png" alt="invalid_VM_backup"></p>
<p>２）上記「バックアップの停止」を実施済の状態で、「VM の復元」をクリックし、「構成の復元：既存を置換」を選択している状態で「復元」を実行する<br><img src="https://user-images.githubusercontent.com/71251920/148112978-b25ab648-9245-4db6-a81e-bc7279595399.png" alt="VM_OLR"></p>
<p>３）「バックアップ ジョブ」画面にて、以下の状態で処理が終了する。<br>「Operation : Restore」・・・「StatusCompleted with warnings」「Error Code : OlrBackupFailed」<br>「Operation : Backup」・・・「Status : Failed」「Error Code : UserErrorBcmDatasourceNotPresent」<br><img src="https://user-images.githubusercontent.com/71251920/148112973-7caf6f19-c212-4f22-90ea-558998abc2d7.png" alt="OLR_Error_Jobs"><br>（「Operation : Restore」側の詳細画面）<br><img src="https://user-images.githubusercontent.com/71251920/148112977-0cd72cb6-c2bb-403f-8100-cd25a5b02b44.png" alt="Restore_error_details"><br>（「Operation : Backup」側の詳細画面）<br><img src="https://user-images.githubusercontent.com/71251920/148112975-73526fb8-4586-4cc9-863e-c3d314999398.png" alt="Backup_error_details"></p>
<p>上記のシナリオてに合致した場合、「復元」がエラーコード「OlrBackupFailed」となる理由は、仮想マシンに対して、「バックアップの停止」が行われているためである可能性が高いです。</p>
<h2 id="2-原因"><a href="#2-原因" class="headerlink" title="2. 原因"></a>2. 原因<a id="2"></a></h2><p>「構成の復元：既存を置換」で「復元」を実行した場合、復元の流れとして、復元ポイントからディスクが復元された後、「復元されたディスクに置換する前の仮想マシンの状態」に対するバックアップ（※）が実施されます。<br>「復元されたディスクに置換する前の仮想マシンの状態」に対するバックアップ（※）が成功した場合、復元されたディスクとの置換作業が実施されます。<br>「バックアップの停止」中の場合は、（※）のバックアップ処理が行えず「Status：Failed」となり、復元ジョブもエラーコード「OlrBackupFailed」となります。<br>仮想マシンに対するディスクの置換は行われず、指定した復元ポイント時点のディスクが復元され、Azure ポータル画面の「ディスク」一覧にて確認可能となります。</p>
<h2 id="3-「構成の復元：既存を置換」として復元したい場合の回避策"><a href="#3-「構成の復元：既存を置換」として復元したい場合の回避策" class="headerlink" title="3. 「構成の復元：既存を置換」として復元したい場合の回避策"></a>3. 「構成の復元：既存を置換」として復元したい場合の回避策<a id="3"></a></h2><p>下記の 2 種類の方法が考えられます。<br>１．対象の仮想マシンに対して、「バックアップの再開」をクリックし、バックアップを有効にした状態で、再度「VM の復元」-「構成の復元：既存を置換」を実施する。<br>これにより、復元時に自動トリガーされるバックアップ ジョブ（※）も正常に実施され、復元ジョブも成功します。<br><img src="https://user-images.githubusercontent.com/71251920/148112970-9689b050-a986-4de4-b752-274624c4a17e.gif" alt="VM_backup_resume"></p>
<p>２．対象の仮想マシンに対して、「バックアップの停止」を実施済の状態のまま、「VM の復元」-「構成の復元：既存を置換」を実施する。<br>この場合、前述の通り「Operation : Restore」「StatusCompleted with warnings」となりますが、ディスクとしては復元されます。<br>ディスクとして復元後、対象の仮想マシンを「停止済み (割り当て解除)」としている状態で、仮想マシンにアタッチされているディスクと、復元したディスクを手動でスワップすることで、復元ポイント時点の仮想マシンの状態に戻すことが可能です。</p>
<p>Azure Portal ＞  対象の仮想マシン ＞ 左ペインのディスク ＞ 「OSディスクのスワップ」にて復元されたディスクと現在のディスクをスワップします。<br><img src="https://user-images.githubusercontent.com/71251920/148112967-eaab9628-7f5e-4fd4-a11f-63faa6ad75b5.jpg" alt="Disk_Swap"></p>
<p>「既存を置換」にて「復元」を実行すると、「OlrBackupFailed」エラーが発生するという場合の対処法について、ご案内は以上となります。</p>

      
      
        <div class="article-disclaimer">
        
          <p>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>
        
        </div>
      
    </div>
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Azure-VM-Backup/" rel="tag">Azure VM Backup</a></li></ul>

        
        <a href="https://jpabrs-scem.github.io/blog/edit/main/articles/AzureVMBackup/VM_Restorefail_invalid_protection.md" class="article-github-edit-link" target="_blank" rel="noopener noreferrer">GitHub で編集</a>
        
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../HowToExtendVMRetentionPeriod/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">次の記事</strong>
      <div class="article-nav-title">
        
          Azure VM Backup で取得した復旧ポイントの保持期間の延長について
        
      </div>
    </a>
  
  
    <a href="../../SystemCenter/SCOM_2012R2_Uninstall-TroubleCase/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前の記事</strong>
      <div class="article-nav-title">SCOM 2012 R2 エージェントのアンインストール時のトラブル事例</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最近の投稿</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../Consistencies/">Azure VM Backupにおける整合性について</a>
          </li>
        
          <li>
            <a href="../Change_RSV_for_VM/">Azure VM BackupにおけるRecovery Services コンテナーの変更について</a>
          </li>
        
          <li>
            <a href="../../MARSBackup/MARS_Proxy_Setting/">プロキシを利用した MARS エージェントによるバックアップについて</a>
          </li>
        
          <li>
            <a href="../AV_ExcludeSetting/">Azure Backup におけるウイルス除外設定について</a>
          </li>
        
          <li>
            <a href="../HowToExtendVMRetentionPeriod/">Azure VM Backup で取得した復旧ポイントの保持期間の延長について</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">タグ</h3>
    <div class="widget">
      <!-- <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-Files-Backup/" rel="tag">Azure Files Backup</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-VM-Backup/" rel="tag">Azure VM Backup</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Information/" rel="tag">Information</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/MARS-Backup/" rel="tag">MARS Backup</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Recovery-Services-vaults/" rel="tag">Recovery Services vaults</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/System-Center/" rel="tag">System Center</a></li></ul>  -->
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-Files-Backup/">Azure Files Backup</a><span class="tag-list-count">1</span><ul></ul></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-VM-Backup/">Azure VM Backup</a><span class="tag-list-count">15</span><ul></ul></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/MARS-Backup/">MARS Backup</a><span class="tag-list-count">1</span><ul></ul></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Recovery-Services-vaults/">Recovery Services vaults</a><span class="tag-list-count">1</span><ul></ul></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/System-Center/">System Center</a><span class="tag-list-count">4</span><ul></ul></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Information/">Information</a><span class="tag-list-count">1</span><ul></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">アーカイブ</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/02/">2022 / 02</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/01/">2022 / 01</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2021/12/">2021 / 12</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2021/11/">2021 / 11</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2021/10/">2021 / 10</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2021/09/">2021 / 09</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">タグクラウド</h3>
    <div class="widget tagcloud">
      <a href="../../tags/Azure-Files-Backup/" style="font-size: 10px;">Azure Files Backup</a> <a href="../../tags/Azure-VM-Backup/" style="font-size: 20px;">Azure VM Backup</a> <a href="../../tags/Information/" style="font-size: 10px;">Information</a> <a href="../../tags/MARS-Backup/" style="font-size: 10px;">MARS Backup</a> <a href="../../tags/Recovery-Services-vaults/" style="font-size: 10px;">Recovery Services vaults</a> <a href="../../tags/System-Center/" style="font-size: 15px;">System Center</a>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Japan CSS ABRS &amp; SCEM Support Team<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="../../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../../archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<script src="../../js/script.js"></script>




  </div>
</body>
</html>