<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan CSS ABRS  Support Blog !!</title>
  
  <subtitle>Azure Backup , Azure Site Recovery , Azure Migrate に関するサポート情報を発信します。</subtitle>
  <link href="https://jpabrs-scem.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpabrs-scem.github.io/blog/"/>
  <updated>2023-06-08T00:08:47.307Z</updated>
  <id>https://jpabrs-scem.github.io/blog/</id>
  
  <author>
    <name>Japan CSS ABRS &amp; SCEM Support Team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>QL4L-5D8 クラシック アラートから Azure Monitor を使用した組み込みのアラートへの移行について</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureBackupGeneral/HowToMoveClassicAlert/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureBackupGeneral/HowToMoveClassicAlert/</id>
    <published>2023-04-10T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.307Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>こんにちは、Azure Backup サポートです。<br>今回は、2023 年 3 月末より弊社から発行されている、アラート追跡 ID 「QL4L-5D8」について説明いたします。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#Q1">Q1. 「QL4L-5D8」このアラートは何ですか？</a><br><a href="#Q2">Q2. どのRecovery Services コンテナーが「クラシック アラート設定」になっていますか？</a><br><a href="#Q3">Q3. クラシック アラートから Azure Monitor を使用した組み込みのアラートへと移行した場合のコストはどうなりますか？</a><br><a href="#Q4">Q4. クラシック アラートの「通知の構成」をしているかどうかは 1 つ 1 つの Recovery Services コンテナーを確認する必要がありますか？</a></p><hr><h2 id="Q1-「QL4L-5D8」このアラートは何ですか？"><a href="#Q1-「QL4L-5D8」このアラートは何ですか？" class="headerlink" title="Q1. 「QL4L-5D8」このアラートは何ですか？"></a><a id="Q1"></a>Q1. 「QL4L-5D8」このアラートは何ですか？</h2><p><strong>A1</strong> クラシック アラートから、Azure Monitor を使用した組み込みのアラートへと移行するよう、お知らせするためのものです。<br>Recovery Services コンテナーでは、クラシック アラートが<span style="color: red; ">既定</span>で存在しており、かつ、利用可能な状態となっております。<br>後述 「Q2. どのRecovery Services コンテナーが「クラシック アラート設定」になっていますか？」 をご参照いただき、クラシック アラートを利用した通知の設定有無をまずはご確認くださいますようお願いいたします。</p><h4 id="・クラシック-アラート機能用いて、現在メールへのアラート通知を構成している場合"><a href="#・クラシック-アラート機能用いて、現在メールへのアラート通知を構成している場合" class="headerlink" title="・クラシック アラート機能用いて、現在メールへのアラート通知を構成している場合"></a>・クラシック アラート機能用いて、現在メールへのアラート通知を構成している場合</h4><p>クラシック アラートは、2026 年 3 月 31 日をもって廃止する予定です。<br>監視設定を継続してご利用になられる場合は、お手数ではございますが、「Azure Monitor を使用した組み込みのアラート」への切り替えを事前にご検討くださいますようお願いいたします。</p><h4 id="・クラシック-アラート機能用いて、現在メールへのアラート通知を構成していないが、今後はバックアップ-ジョブ失敗時にメール通知などのアラートをご希望の場合"><a href="#・クラシック-アラート機能用いて、現在メールへのアラート通知を構成していないが、今後はバックアップ-ジョブ失敗時にメール通知などのアラートをご希望の場合" class="headerlink" title="・クラシック アラート機能用いて、現在メールへのアラート通知を構成していないが、今後はバックアップ ジョブ失敗時にメール通知などのアラートをご希望の場合"></a>・クラシック アラート機能用いて、現在メールへのアラート通知を構成していないが、今後はバックアップ ジョブ失敗時にメール通知などのアラートをご希望の場合</h4><p>クラシック アラートから、「Azure Monitor を使用した組み込みのアラート」へと切り替え設定することをご検討ください。</p><h4 id="・クラシック-アラート機能用いて、現在メールへのアラート通知を構成していない、かつ今後もバックアップ-ジョブ失敗時にメール通知などのアラートをご希望でない場合"><a href="#・クラシック-アラート機能用いて、現在メールへのアラート通知を構成していない、かつ今後もバックアップ-ジョブ失敗時にメール通知などのアラートをご希望でない場合" class="headerlink" title="・クラシック アラート機能用いて、現在メールへのアラート通知を構成していない、かつ今後もバックアップ ジョブ失敗時にメール通知などのアラートをご希望でない場合"></a>・クラシック アラート機能用いて、現在メールへのアラート通知を構成していない、かつ今後もバックアップ ジョブ失敗時にメール通知などのアラートをご希望でない場合</h4><p><span style="color: red; ">特段ユーザー様にて追加作業は不要です。</span></p><p>・監視とレポートのシナリオ<br>　<a href="https://learn.microsoft.com/ja-jp/azure/backup/monitoring-and-alerts-overview#monitoring-and-reporting-scenarios">https://learn.microsoft.com/ja-jp/azure/backup/monitoring-and-alerts-overview#monitoring-and-reporting-scenarios</a></p><p><img src="https://user-images.githubusercontent.com/96324317/230756428-28f8085a-16bf-49ab-aa50-8659f342b81e.png" alt="image01"></p><p><img src="https://user-images.githubusercontent.com/96324317/230756444-3a95a6b5-dd4d-47e0-b3d1-ea3ffe54fa49.png" alt="image02"></p><p><img src="https://user-images.githubusercontent.com/96324317/230756450-5d78ebd9-19e0-455b-9ba6-6f079f9cf65d.png" alt="image03"></p><h2 id="Q2-どの-Recovery-Services-コンテナーが「クラシック-アラート設定」になっていますか？"><a href="#Q2-どの-Recovery-Services-コンテナーが「クラシック-アラート設定」になっていますか？" class="headerlink" title="Q2.どの Recovery Services コンテナーが「クラシック アラート設定」になっていますか？"></a><a id="Q2"></a>Q2.どの Recovery Services コンテナーが「クラシック アラート設定」になっていますか？</h2><p><strong>A2</strong><br>・既定ですべての Recovery Services コンテナーにおいて、「Azure Monitor を使用した組み込みのアラート」へと移行していない Recovery Services コンテナーは、「クラシック アラート」が有効になっており、今回の正常性アラート対象となっております<br>・実際に「クラシック アラート」を用いてメールへの通知構成をしているかどうかは、ユーザー様の設定次第です</p><h4 id="【どの-Recovery-Services-コンテナーが「Azure-Monitor-を使用した組み込みのアラート」へと移行しておらず、クラシック-アラートが有効になっているのか-確認方法】"><a href="#【どの-Recovery-Services-コンテナーが「Azure-Monitor-を使用した組み込みのアラート」へと移行しておらず、クラシック-アラートが有効になっているのか-確認方法】" class="headerlink" title="【どの Recovery Services コンテナーが「Azure Monitor を使用した組み込みのアラート」へと移行しておらず、クラシック アラートが有効になっているのか　確認方法】"></a>【どの Recovery Services コンテナーが「Azure Monitor を使用した組み込みのアラート」へと移行しておらず、クラシック アラートが有効になっているのか　確認方法】</h4><p> [バックアップ センター] ブレードの[概要] タブより、”アクティブなアラート” 項目に[以前のアラート ソリューションであるクラシック アラートを使用しているコンテナーがxx 個あります。]<br>と表示されている場合、クラシック アラートが有効・利用可能となっているRecovery Services コンテナーが存在しています。</p><p>この記述がある場合は、後述される [アクションを起こすには、ここをクリック] をクリックします。</p><p><img src="https://user-images.githubusercontent.com/96324317/230756521-74ec97f7-1147-4799-aa66-59b789ab3f69.png" alt="image04"></p><p><img src="https://user-images.githubusercontent.com/96324317/230756529-fbb23335-c992-4b39-b4b9-071e280168f8.png" alt="image05"></p><p>[Azure Monitor アラートのみの使用をオプトイン] 画面にて、リストされているRecovery Services コンテナーを確認します。<br><img src="https://user-images.githubusercontent.com/96324317/230756537-0108ce69-1a21-4052-8984-cb5833ee69f6.png" alt="image06"></p><h4 id="【どの-Recovery-Services-コンテナーが、クラシック-アラートの「通知の構成」を行っているのか-確認方法】"><a href="#【どの-Recovery-Services-コンテナーが、クラシック-アラートの「通知の構成」を行っているのか-確認方法】" class="headerlink" title="【どの Recovery Services コンテナーが、クラシック アラートの「通知の構成」を行っているのか　確認方法】"></a>【どの Recovery Services コンテナーが、クラシック アラートの「通知の構成」を行っているのか　確認方法】</h4><p>リストされた Recovery Services コンテナーが実際に通知の構成をしているかどうかは、上記でリストされたRecovery Services コンテナー＞[バックアップ アラート] ＞ ”通知の構成” ＞「メールの通知：オン」となっているかどうかで確認可能です。<br><img src="https://user-images.githubusercontent.com/96324317/230756566-faba366c-1f68-4034-8f4e-bbc1f9e7bc2f.png" alt="image07"></p><p>通知の構成をしている Recovery Services コンテナーがある場合、[Azure Monitor アラートのみの使用をオプトイン] 画面にて、アラートの設定の更新を行います。<br>”通知の構成” ＞「メールの通知：オン」をしている Recovery Services コンテナーが無い場合、かつ、今後バックアップジョブの監視設定をする必要が無い場合は、下記対応は不要です。<br><img src="https://user-images.githubusercontent.com/96324317/230756596-d48ec392-d5c3-4a6b-9b84-73a7e7db4b49.png" alt="image08"></p><p>なお、[Azure Monitor アラートのみの使用をオプトイン] 画面より、アラート設定の更新をする場合、下記の赤枠に記載されているように、メールなどの通知が必要な場合は、別途設定していただく必要があります。</p><p>詳細は下記のドキュメントを参照いただければと存じます。<br>・クラシック アラートから組み込みのAzure Monitor アラートに移行する<br>　<a href="https://learn.microsoft.com/ja-jp/azure/backup/move-to-azure-monitor-alerts#migrate-from-classic-alerts-to-built-in-azure-monitor-alerts">https://learn.microsoft.com/ja-jp/azure/backup/move-to-azure-monitor-alerts#migrate-from-classic-alerts-to-built-in-azure-monitor-alerts</a></p><p><img src="https://user-images.githubusercontent.com/96324317/230756610-2254377b-37ea-4205-a6e2-f6b04e959ced.png" alt="image09"></p><h2 id="Q3-クラシック-アラートから-Azure-Monitor-を使用した組み込みのアラートへと移行した場合のコストはどうなりますか？"><a href="#Q3-クラシック-アラートから-Azure-Monitor-を使用した組み込みのアラートへと移行した場合のコストはどうなりますか？" class="headerlink" title="Q3.クラシック アラートから Azure Monitor を使用した組み込みのアラートへと移行した場合のコストはどうなりますか？"></a><a id="Q3"></a>Q3.クラシック アラートから Azure Monitor を使用した組み込みのアラートへと移行した場合のコストはどうなりますか？</h2><p><strong>A3</strong> 「Azure Monitor を使用した組み込みのアラートが生成されること」自体に料金は発生しません。<br>　　一方、メールなどへアラートを通知させる場合は、少額の料金が発生いたします。<br>　　詳細は下記ドキュメントよりご参照ください。</p><p>・クラシック アラートから組み込みの Azure Monitor アラートに移行する<br>　 <a href="https://learn.microsoft.com/ja-jp/azure/backup/move-to-azure-monitor-alerts#migrate-from-classic-alerts-to-built-in-azure-monitor-alerts">https://learn.microsoft.com/ja-jp/azure/backup/move-to-azure-monitor-alerts#migrate-from-classic-alerts-to-built-in-azure-monitor-alerts</a></p><p><img src="https://user-images.githubusercontent.com/96324317/230756632-22b2968e-d899-44f4-8472-c0c5db56f0c9.png" alt="image10"></p><p>Free レベル (1 か月あたり 1,000 メール) を超える通知に対しては、下記の料金が発生します。</p><p>・価格 - Azure Monitor | Microsoft Azure<br><a href="https://azure.microsoft.com/ja-jp/pricing/details/monitor/">https://azure.microsoft.com/ja-jp/pricing/details/monitor/</a><br>“メール            1 か月あたりメール 1,000 通         メール 100,000 通につき $2”<br><img src="https://user-images.githubusercontent.com/96324317/234444128-ca0d6690-a6a8-4bcf-9e9e-7e63cf44ce49.png" alt="image10-1"></p><h2 id="Q4-クラシック-アラートの「通知の構成」をしているかどうかは-1-つ-1-つの-Recovery-Services-コンテナーを確認する必要がありますか？"><a href="#Q4-クラシック-アラートの「通知の構成」をしているかどうかは-1-つ-1-つの-Recovery-Services-コンテナーを確認する必要がありますか？" class="headerlink" title="Q4.クラシック アラートの「通知の構成」をしているかどうかは 1 つ 1 つの Recovery Services コンテナーを確認する必要がありますか？"></a><a id="Q4"></a>Q4.クラシック アラートの「通知の構成」をしているかどうかは 1 つ 1 つの Recovery Services コンテナーを確認する必要がありますか？</h2><p><strong>A4</strong> 恐縮ながら、現状はクラシック アラートの「通知の構成」部分を照会するような Azure PowerShell ・Azure CLI コマンドのご用意が無いため、ユーザー様には Azure ポータル画面の Recovery Services コンテナーを 1 つ 1 つ確認いただく必要がございます。<br>※　前提としてクラシック アラートの「通知の構成」をされているのであれば、ユーザー様が設定されたメールアドレスの宛先へと、バックアップ ジョブ失敗時などに通知がなされています。</p><p>その他確認手段の 1 つとして、以下のような REST API を発行することで確認が可能ですので、参考として紹介いたします。<br>※　以下 REST API は、本ブログ発行時点で確認可能な手段であり、事前予告なく返却値が変わる可能性がありますこと、ご了承ください。<br>　　以下 REST API は、あくまで参考としてご連携するサンプル コマンドでございます。<br>　　コマンド実装をされる場合は貴社にて検証のうえ、実施いただきますようご留意ください。<br>　　また、Azure サポートでは主に Post Production の Break &amp; Fix を担当しており、スクリプトのコードレビューのサポートは承っておりませんので、ご理解をいただけますと幸いです。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">### クラシックアラートのメール通知が有効化されているかを確認する </span><br><span class="line">### ※ (前提) Connect-AzAccount コマンドにて、 Azure に接続可能な状態で実行すること</span><br><span class="line"></span><br><span class="line">$RSVList = Get-AzRecoveryServicesVault | Select-Object Name, ResourceGroupName, SubscriptionId</span><br><span class="line"></span><br><span class="line"># リクエスト ヘッダーを作成</span><br><span class="line">$headers = @&#123;</span><br><span class="line">    &#x27;Content-type&#x27;  = &#x27;application/json&#x27;</span><br><span class="line">    &#x27;Authorization&#x27; = &#x27;Bearer &#x27; + (Get-AzAccessToken).Token</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 結果出力先のオブジェクトを作成</span><br><span class="line">$results = @()</span><br><span class="line"></span><br><span class="line"># Recovery Services コンテナーごとに API へリクエストを送り、結果を取得する ※1</span><br><span class="line">foreach ( $rsv in $RSVList ) &#123;</span><br><span class="line">    $uri = &quot;https://management.azure.com/subscriptions/$($rsv.SubscriptionId)/resourceGroups/$($rsv.ResourceGroupName)/providers/Microsoft.RecoveryServices/vaults/$($rsv.Name)/monitoringConfigurations/notificationConfiguration?api-version=2017-07-01-preview&quot;</span><br><span class="line">    $response = (Invoke-RestMethod -Uri $uri -Method Get -Headers $headers).properties</span><br><span class="line">    $results += @([pscustomobject]@&#123;subscriptionID = $rsv.SubscriptionId; resourceGroupName = $rsv.ResourceGroupName; recoveryServicesContainerName = $rsv.Name; isClassicAlertNotificationEnabled = $response.areNotificationsEnabled; mailRecipients = $response.additionalRecipients -join &#x27;; &#x27; &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 全ての結果をコンソール出力</span><br><span class="line">$results | Sort-Object isClassicAlertNotificationEnabled -Descending | ForEach-Object &#123; Write-Output $_ | Format-Table &#125;</span><br></pre></td></tr></table></figure><p>上記 REST API を発行した場合、「isClassicAlertNotificationEnabled：True」となっている Recovery Services コンテナーが「通知の構成：オン」となっているものとなります。<br><img src="https://user-images.githubusercontent.com/96324317/230820217-777e48c3-f704-4e83-9aeb-1a5b107633af.png" alt="image11"></p><p><img src="https://user-images.githubusercontent.com/96324317/230820265-bcb0a6df-eae6-4946-b0f9-c1f905a539d4.png" alt="image12"></p><p><img src="https://user-images.githubusercontent.com/96324317/230820287-06940bef-a423-4202-a016-e3ec7bd79489.png" alt="image13"></p><p><img src="https://user-images.githubusercontent.com/96324317/230820315-3f9dc117-bfac-4e73-b0aa-d37a12503390.png" alt="image14"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;こんにちは、Azure Backup サポートです。&lt;br&gt;今回は、2023 年 3 月末より弊社から発行されている、アラート追跡 ID 「QL4L-5D8」について説明いたします。&lt;/p&gt;
&lt;h2 id=&quot;目次&quot;&gt;&lt;a hr</summary>
      
    
    
    
    
    <category term="Azure Backup General" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-Backup-General/"/>
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
  </entry>
  
  <entry>
    <title>Recovery Services コンテナーとバックアップ コンテナーについて</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureBackupGeneral/RSV_BV/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureBackupGeneral/RSV_BV/</id>
    <published>2023-03-23T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.307Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>こんにちは、Azure Backup サポートの山本です。<br>今回は、 Azure バックアップソリューションので利用する Recovery Services コンテナーとバックアップ コンテナーのバックアップ対象の違いについてご説明させていただきます。<br> Recovery Services コンテナーとバックアップ コンテナーはバックアップ対象(バックアップソリューション)の違いにより使い分ける必要がございます。<br> また、<strong>バックアップセンターは サブスクリプション内の Recovery Services コンテナーやバックアップ コンテナー (およびそれぞれのコンテナーでバックアップしているバックアップアイテム) を統合管理するための管理画面です。</strong></p><p><img src="https://user-images.githubusercontent.com/71251920/216895782-33a2539d-b199-466a-ba15-1184b2ad0552.png" alt=" Azure Backup 関連のリソース"></p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. バックアップソリューションとコンテナー、およびデータ保存先の比較表</a><br><a href="#2">2. コンテナーにバックアップデータが保存されないもの</a><br><a href="#2-1">2-1. Azure ファイル共有バックアップ</a><br><a href="#2-2">2-2. Azure Blob バックアップ</a><br><a href="#2-3">2-3. Azure ディスク バックアップ</a></p><hr><h3 id="1-バックアップソリューションとコンテナー、およびデータ保存先の比較表"><a href="#1-バックアップソリューションとコンテナー、およびデータ保存先の比較表" class="headerlink" title="1. バックアップソリューションとコンテナー、およびデータ保存先の比較表"></a><a id="1"></a>1. バックアップソリューションとコンテナー、およびデータ保存先の比較表</h3><p> 各 Azure バックアップのソリューションがどのコンテナーを利用するか、またデータの保存先についても下記の通りおまとめいたしました。<br> また、各ソリューションには各ソリューションの Docs へのリンクも付けております。</p><table><thead><tr><th align="left">#</th><th align="left">バックアップソリューション</th><th align="left">利用するコンテナー</th><th align="left">コンテナーにバックアップデータを保存するか</th></tr></thead><tbody><tr><td align="left">1</td><td align="left"><a href="https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-vms-introduction">Azure VM バックアップ</a></td><td align="left">Recovery Services コンテナー</td><td align="left">する</td></tr><tr><td align="left">2</td><td align="left"><a href="https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-about-mars">MARS バックアップ</a></td><td align="left">Recovery Services コンテナー</td><td align="left">する</td></tr><tr><td align="left">3</td><td align="left"><a href="https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-microsoft-azure-backup">MABS バックアップ</a></td><td align="left">Recovery Services コンテナー</td><td align="left">する</td></tr><tr><td align="left">4</td><td align="left"><a href="https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-sql-database">SQL in Azure VM バックアップ</a></td><td align="left">Recovery Services コンテナー</td><td align="left">する</td></tr><tr><td align="left">5</td><td align="left"><a href="https://learn.microsoft.com/ja-jp/azure/backup/sap-hana-database-about">SAP HANA DB in Azure VM バックアップ</a></td><td align="left">Recovery Services コンテナー</td><td align="left">する</td></tr><tr><td align="left">6</td><td align="left"><a href="https://learn.microsoft.com/ja-jp/azure/backup/azure-file-share-backup-overview">Azure ファイル共有バックアップ</a></td><td align="left">Recovery Services コンテナー</td><td align="left"><strong>しない(注1)</strong></td></tr><tr><td align="left">7</td><td align="left"><a href="https://learn.microsoft.com/ja-jp/azure/backup/blob-backup-overview">Azure Blob バックアップ</a></td><td align="left">バックアップ コンテナー</td><td align="left"><strong>しない(注2)</strong></td></tr><tr><td align="left">8</td><td align="left"><a href="https://learn.microsoft.com/ja-jp/azure/backup/disk-backup-overview">Azure ディスク バックアップ</a></td><td align="left">バックアップ コンテナー</td><td align="left"><strong>しない</strong></td></tr><tr><td align="left">9</td><td align="left"><a href="https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-database-postgresql-overview">Azure PosgreSQL バックアップ</a></td><td align="left">バックアップ コンテナー</td><td align="left">する</td></tr></tbody></table><ul><li><p><strong>(注1) 2023年3月現在  Azure ファイル共有バックアップ のコンテナー層へのBackup機能が Private Preview となりました。</strong><br>・Private Preview: Azure Backup enables vaulted backups for Azure Files for comprehensive data protection.<br><a href="https://azure.microsoft.com/ja-JP/updates/azurefilesvaultedbackups-2/">https://azure.microsoft.com/ja-JP/updates/azurefilesvaultedbackups-2/</a></p></li><li><p><strong>(注2) 2023年3月現在  Azure Blob バックアップのコンテナー層へのBackup機能が Public Preview となりました。</strong><br>・Public Preview: Azure Backup enables vaulted backups for Azure Blob for comprehensive data protection.<br><a href="https://azure.microsoft.com/ja-JP/updates/azureblobvaultedbackups/">https://azure.microsoft.com/ja-JP/updates/azureblobvaultedbackups/</a></p></li></ul><h3 id="2-コンテナーにバックアップデータが保存されないもの"><a href="#2-コンテナーにバックアップデータが保存されないもの" class="headerlink" title="2.コンテナーにバックアップデータが保存されないもの"></a><a id="2"></a>2.コンテナーにバックアップデータが保存されないもの</h3><p>上述のとおり、Azure ファイル共有バックアップ、Azure Blob バックアップ、Azure ディスク バックアップは各コンテナーにはバックアップデータは転送されません。<br>それぞれについて簡単にご説明させていただきます。<br>共通している点はそれぞれのソリューションはコアとなる別のソリューションをバックアップサービス側からトリガーし実現している点でございます。</p><h4 id="2-1-Azure-ファイル共有バックアップ"><a href="#2-1-Azure-ファイル共有バックアップ" class="headerlink" title="2-1. Azure ファイル共有バックアップ"></a><a id="2-1"></a>2-1. Azure ファイル共有バックアップ</h4><p>Azure ファイル共有 バックアップは Azure Files の共有スナップショットの機能をバックアップサービスと連携することによりスナップショット取得の自動化、スナップショットの削除の自動化を実現したバックアップソリューションです。</p><p>そのため、バックアップデータ (スナップショットデータ) の保存先はAzure Files の共有スナップショットと同じく、そのストレージ アカウント自身 (のスナップショット領域)となります。<br>そのため、 Recovery Services コンテナーには転送されません。<br>下記のように<strong>Azure ファイル共有のスナップショット リソースとしてよって、Azure ファイル共有バックアップにて取得されたスナップショットも確認可能です</strong>。(“発信側” が “AzureBackup” となっているものです)<br><img src="https://user-images.githubusercontent.com/71251920/198350606-969ef3b9-0c2a-4744-9940-87c41936cb09.png"></p><p>・バックアップ プロセスのしくみ - Azure ファイル共有のバックアップについて<br><a href="https://learn.microsoft.com/ja-jp/azure/backup/azure-file-share-backup-overview">https://learn.microsoft.com/ja-jp/azure/backup/azure-file-share-backup-overview</a></p><blockquote><p>抜粋：ファイル共有データは Backup サービスには転送されません。これは、Backup サービスでは、ストレージ アカウントの一部であるスナップショットの作成および管理が行われ、バックアップはコンテナーに転送されないからです。</p></blockquote><p>・Azure Files の共有スナップショット<br><a href="https://learn.microsoft.com/ja-jp/azure/storage/files/storage-snapshots-files">https://learn.microsoft.com/ja-jp/azure/storage/files/storage-snapshots-files</a></p><h4 id="2-2-Azure-Blob-バックアップ"><a href="#2-2-Azure-Blob-バックアップ" class="headerlink" title="2-2. Azure Blob バックアップ"></a><a id="2-2"></a>2-2. Azure Blob バックアップ</h4><p>Azure Blob バックアップ は Azure Blob のポイントインタイムリストアの機能をバックアップサービスと連携することにより実現したバックアップソリューションです。</p><p>そのため、バックアップデータ (リストアに必要なデータ) の保存先は Azure Blob のポイントインタイムリストアと同じく、そのストレージ アカウント自身となります。<br>そのため、バックアップ コンテナーには転送されません。</p><p>・運用バックアップのしくみ - Azure Blob の運用バックアップの概要<br><a href="https://learn.microsoft.com/ja-jp/azure/backup/blob-backup-overview">https://learn.microsoft.com/ja-jp/azure/backup/blob-backup-overview</a></p><blockquote><p>抜粋：BLOB の運用バックアップは、ローカル バックアップ ソリューションです。 そのため、バック アップデータはバックアップ コンテナーには転送されず、ソース ストレージ アカウント自体に格納されます。 ただし、バックアップ コンテナーは引き続きバックアップ管理の単位として機能します。 また、これは継続的バックアップ ソリューションです。つまり、バックアップをスケジュール設定する必要がなく、すべての変更内容が保持され、選択した時点の状態から復元できます。</p></blockquote><p>・ブロック BLOB のポイントインタイム リストア<br><a href="https://learn.microsoft.com/ja-jp/azure/storage/blobs/point-in-time-restore-overview">https://learn.microsoft.com/ja-jp/azure/storage/blobs/point-in-time-restore-overview</a></p><h4 id="2-3-Azure-ディスク-バックアップ"><a href="#2-3-Azure-ディスク-バックアップ" class="headerlink" title="2-3. Azure ディスク バックアップ"></a><a id="2-3"></a>2-3. Azure ディスク バックアップ</h4><p>Azure ディスク バックアップ は マネージドディスクの増分スナップショットの機能とバックアップサービスと連携することによりスナップショット取得の自動化、スナップショットの削除の自動化を実現したバックアップソリューションです。</p><p>そのため、バックアップデータ (スナップショット データ) の保存先は マネージドディスクのスナップショットと同じく、マネージドディスクのスナップショットの専用領域 (運用層) となります。そのため、 Recovery Services コンテナーには転送されません。<br>また、下記のように<strong>スナップショットリソースとして Azure ディスクのバックアップによって取得されたスナップショットも確認可能です</strong>。(タグが “CreatedBy：AzureBackup” となっているものです)<br><img src="https://user-images.githubusercontent.com/71251920/198349785-951e0497-fe17-46e5-9714-53f2daf30344.png"></p><p>・バックアップと復元のプロセスのしくみ - Azure ディスク バックアップの概要<br><a href="https://learn.microsoft.com/ja-jp/azure/backup/disk-backup-overview#how-the-backup-and-restore-process-works">https://learn.microsoft.com/ja-jp/azure/backup/disk-backup-overview#how-the-backup-and-restore-process-works</a></p><blockquote><p>抜粋： Azure ディスク バックアップでは、運用層のバックアップのみがサポートされています。 コンテナー ストレージ層へのバックアップのコピーはサポートされていません。</p></blockquote><p>・マネージド ディスクの増分スナップショットの作成<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/disks-incremental-snapshots?tabs=azure-cli">https://learn.microsoft.com/ja-jp/azure/virtual-machines/disks-incremental-snapshots?tabs=azure-cli</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;こんにちは、Azure Backup サポートの山本です。&lt;br&gt;今回は、 Azure バックアップソリューションので利用する Recovery Services コンテナーとバックアップ コンテナーのバックアップ対象の違いに</summary>
      
    
    
    
    
    <category term="Azure Backup General" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-Backup-General/"/>
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
  </entry>
  
  <entry>
    <title>ASR 自動更新に利用する Automation アカウントの Managed ID への移行方法について</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureSiteRecovery/HowToChangeAzureAutomationManagedId/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureSiteRecovery/HowToChangeAzureAutomationManagedId/</id>
    <published>2023-03-14T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.339Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>みなさんこんにちは、Azure Site Recovery サポートです。<br>今回は、Azure Site Recovery ( 以下、ASR ) にて使用される、マネージド ID の設定についてのご案内です。</p><p>ASR 自動更新には Azure Automation の実行アカウントが利用されますが、Azure Automation 実行アカウントは 2023 年 9 月 30 日に廃止されることが決まっており、マネージド ID へ移行する必要がございます。<br>2023/3/14 時点では ASR の自動更新に利用する Azure Automation を手動でマネージド ID へ移行する必要がございますので、その移行手順についてご案内いたします。</p><p>なお、今後は ASR 有効化時に自動でマネージド ID の Azure Automation が作成されるように開発部門と対応を継続しておりますので、進展がありましたら本ブログにて Update をお知らせいたします。</p><p>・マネージド ID への移行に関する公開情報<br>　<a href="https://learn.microsoft.com/ja-jp/azure/automation/migrate-run-as-accounts-managed-identity?tabs=sa-managed-identity">https://learn.microsoft.com/ja-jp/azure/automation/migrate-run-as-accounts-managed-identity?tabs=sa-managed-identity</a></p><h3 id="作業手順"><a href="#作業手順" class="headerlink" title="作業手順"></a>作業手順</h3><ol><li>Azure Portal から Recovery Services コンテナーに移動し、[概要] の JSON ビューをクリックし、ID の行に表示される /subscriptions/ から始まるリソース ID をメモします。<br>※ 手順 8 で利用します。</li></ol><p><img src="https://user-images.githubusercontent.com/96324317/224874128-5a6427e3-6899-4cf8-bfbd-024334f58aaf.png" alt="image1"></p><p><img src="https://user-images.githubusercontent.com/96324317/224874595-4ed973c2-4611-4548-8591-da9a1cb087e6.png" alt="image2"></p><ol start="2"><li>Recovery Services コンテナーの [Site Recovery インフラストラクチャ] - [拡張機能の更新の設定] 画面ご利用の Automation アカウント名をご確認ください。</li></ol><p><img src="https://user-images.githubusercontent.com/96324317/224874725-db03352c-829b-449a-ba34-88303a551f6d.png" alt="image3"></p><ol start="3"><li>手順 2 で確認した Automation アカウントに移動し、  JSON ビューをクリックし、ID の行に表示される /subscriptions/ から始まるリソース ID をメモします。<br>※ 手順 9 で利用します。</li></ol><p><img src="https://user-images.githubusercontent.com/96324317/224874882-b6ccc582-13c4-4553-9d1f-9b9e4425b6db.png" alt="image4"></p><p><img src="https://user-images.githubusercontent.com/96324317/224874916-5df9c1cb-92c0-4263-9f9c-16ece1912dd9.png" alt="image5"></p><ol start="4"><li>Automation アカウントの [ID] - [システム割り当て済み] 画面から状態が [オン] に選択されていない場合には、[オン] を選択し、[保存] をクリックします。</li></ol><p><img src="https://user-images.githubusercontent.com/96324317/224874986-a883cb50-8fe5-4f05-b0c4-4c72cdc8d2f4.png" alt="image6"></p><ol start="5"><li>Recovery Services コンテナーに戻り、[アクセス制御 (IAM)] から、Automation アカウントのマネージド ID に対して共同作成者ロールを付与します。</li></ol><p>・ロール : 共同作成者<br>・アクセスの割り当て先 : マネージド ID<br>・メンバー :Automation アカウント</p><p><img src="https://user-images.githubusercontent.com/96324317/224875166-74a13c8e-d825-4bf7-97a5-18dd1855a576.png" alt="image7"></p><p><img src="https://user-images.githubusercontent.com/96324317/224875187-021d493c-8ef9-4370-af8d-3aaedb04b611.png" alt="image8"></p><p><img src="https://user-images.githubusercontent.com/96324317/224875252-a24fbdc4-2e71-4c89-9890-7b75530eb754.png" alt="image9"></p><p><img src="https://user-images.githubusercontent.com/96324317/224875281-150ab88d-36b1-4b95-a9a2-c4a17cbc116b.png" alt="image10"></p><ol start="6"><li>Automation アカウントに戻り、[Runbook] - [Runbook の作成] から新しい Runbook を作成します。</li></ol><p><img src="https://user-images.githubusercontent.com/96324317/224875348-6f138351-c0af-43ac-bd3c-8ef25d3372f0.png" alt="image11"></p><p>・Runbook 名 : &lt;任意&gt;<br>・Runbook の種類 : PowerShell<br>・ランタイムのバージョン : 5.1</p><p><img src="https://user-images.githubusercontent.com/96324317/224875466-44010fb0-2420-4753-b804-7130434a902a.png" alt="image12"></p><ol start="7"><li>作成された Runbook に、下記 Github に公開されている UpdateAutomationAccount.ps1 の PowerShell スクリプトをコピーして貼り付け [保存] します。</li></ol><p>・PowerShell スクリプト<br>　<a href="https://github.com/AsrOneSdk/published-scripts/blob/master/automationAccount/UpdateAutomationAccount.ps1">https://github.com/AsrOneSdk/published-scripts/blob/master/automationAccount/UpdateAutomationAccount.ps1</a></p><p><img src="https://user-images.githubusercontent.com/96324317/224875619-9e10064b-923a-4fdc-a6d9-5d641a04f188.png" alt="image13"></p><ol start="8"><li>上部 [テスト ウィンドウ] からテスト画面に移動し、パラメーターを入力し [開始] をクリックします。</li></ol><p><img src="https://user-images.githubusercontent.com/96324317/224875673-cd3d487c-21bf-448c-9536-3cfecf19f2cb.png" alt="image14"></p><p>・VAULTRESOURCEID : 手順 1 で確認した Recovery Services コンテナーのリソース ID<br>・AUTOUPDATEACTION : Disabled<br>・AUTOMATIONACCOUNTARMID : 入力なし</p><p><img src="https://user-images.githubusercontent.com/96324317/224875714-04847fc0-45fc-4aae-9d61-584fbe1a9768.png" alt="image15"></p><p>完了と表示されるとテスト成功です。</p><p><img src="https://user-images.githubusercontent.com/96324317/224875759-fb94ba3e-061d-4ffe-b2b3-1407ad881b8d.png" alt="image16"></p><ol start="9"><li>パラメータ AUTOUPDATEACTION を Enabled に変更し、AUTOMATIONACCOUNTARMID にリソース ID を入力し、再度 [開始] をクリックします。</li></ol><p>・VAULTRESOURCEID : 手順 1 で確認した Recovery Services コンテナーのリソース ID<br>・AUTOUPDATEACTION : Enabled<br>・AUTOMATIONACCOUNTARMID : 手順 3 で確認した Automation アカウントのリソース ID</p><p><img src="https://user-images.githubusercontent.com/96324317/224875812-93a0ec82-db28-4b82-b5c5-dc930d084dde.png" alt="image17"></p><p>完了と表示されるとテスト成功です。</p><p><img src="https://user-images.githubusercontent.com/96324317/224875967-f561d126-42e6-4c70-9889-39f4e94793f8.png" alt="image"></p><ol start="10"><li>画面右上の [X] から画面を一度閉じ、Runbook に戻り [公開] をクリックします。</li></ol><p><img src="https://user-images.githubusercontent.com/96324317/224876010-8b07de47-3926-4233-8e3f-c188552281bc.png" alt="image"></p><ol start="11"><li>Runbook のステータスが “発行済み” になっていることを確認し、[スケジュールへのリンク] をクリックし、スケジュールを設定します。</li></ol><p><img src="https://user-images.githubusercontent.com/96324317/224876087-d5649f14-4b30-441b-8bb6-6e2b73c4b1cd.png" alt="image"></p><ol start="12"><li>[スケジュール] をクリックし、既存のスケジュールを利用するか新規スケジュールを作成します。<br>※ 既定では 0:00 に毎日ジョブが実行され、最新バージョンでない保護されたアイテムがある場合に ASR モビリティ サービス エージェントを更新する処理がトリガーされます。</li></ol><p><img src="https://user-images.githubusercontent.com/96324317/224876152-99f45670-ee44-4220-8127-a976ab9fe546.png" alt="image"></p><p>新規スケジュールを作成する場合には、任意のスケジュールを設定します。<br>例えば、日本時刻 0:00 に毎日ジョブを実行する場合、下記のように入力します。</p><p><img src="https://user-images.githubusercontent.com/96324317/224876230-77381459-a13e-45d2-a89f-16d85f54d8b8.png" alt="image"></p><ol start="13"><li>[パラメーターと実行設定] をクリックし、手順 9 で入力したパラメータを以下の通り再度入力し [OK] をクリックします。</li></ol><p>・VAULTRESOURCEID : 手順 1 で確認した Recovery Services コンテナーのリソース ID<br>・AUTOUPDATEACTION : Enabled<br>・AUTOMATIONACCOUNTARMID : 手順 3 で確認した Automation アカウントのリソース ID</p><p><img src="https://user-images.githubusercontent.com/96324317/224876291-5fab5687-0573-484c-b369-d26907b94b0d.png" alt="image"></p><p><img src="https://user-images.githubusercontent.com/96324317/224876315-d42595ed-2813-4fd4-99c0-163c6b9d4705.png" alt="image"></p><p>上記作業が完了したら、次のスケジュール日時からマネージド ID を使用した Runbook にて更新ジョブが実行されます。</p><p>ASR にて使用される、マネージド ID 設定の案内は、以上となります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;みなさんこんにちは、Azure Site Recovery サポートです。&lt;br&gt;今回は、Azure Site Recovery ( 以下、ASR ) にて使用される、マネージド ID の設定についてのご案内です。&lt;/p&gt;
&lt;</summary>
      
    
    
    
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
    <category term="Azure Site Recovery" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-Site-Recovery/"/>
    
  </entry>
  
  <entry>
    <title>Azure Disk Backup を意図的に失敗させる方法</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureDiskBackup/How_to_fail_Asure_Disk_backup/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureDiskBackup/How_to_fail_Asure_Disk_backup/</id>
    <published>2023-01-11T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.323Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは、Azure Backup サポートです。<br>アラートのテスト等のため “Azure Disk Backup を失敗させたい” というお問い合わせをよくいただきます。<br>今回は、Azure Disk Backup を意図的に失敗させる方法として、Azure Disk Backup 構成したディスクを削除して、バックアップ ジョブを失敗させる方法をご紹介いたします。</p><p>・Azure ディスク バックアップの概要<br>　<a href="https://learn.microsoft.com/ja-jp/azure/backup/disk-backup-overview">https://learn.microsoft.com/ja-jp/azure/backup/disk-backup-overview</a></p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. Azure Disk Backup を意図的に失敗させる方法</a><br><a href="#2">2. その他ブログで公開している Azure Backup の失敗方法</a></p><hr><h3 id="1-Azure-Disk-Backup-を意図的に失敗させる方法"><a href="#1-Azure-Disk-Backup-を意図的に失敗させる方法" class="headerlink" title=" 1. Azure Disk Backup を意図的に失敗させる方法"></a><a id="1"></a> 1. Azure Disk Backup を意図的に失敗させる方法</h3><p>(1) とある Azure Managed Disk に対して、Azure Disk Backup を構成し、バックアップ取得しておきます。</p><p>・Azure Managed Disks のバックアップ<br>　<a href="https://learn.microsoft.com/ja-jp/azure/backup/backup-managed-disks">https://learn.microsoft.com/ja-jp/azure/backup/backup-managed-disks</a></p><p>下図は例として、Azure Managed Disk「tmpDiskforAzureDiskBackup01」を Azure Disk Backup にてバックアップ構成している状態です。<br><img src="https://user-images.githubusercontent.com/96324317/211466707-79d9b00e-4aef-44ee-96be-a1b8a9c4fd4f.png" alt="バックアップ構成済"></p><p>アラートが生成されることを確認するため、今回は「Azure Monitor を使用した組み込みのアラート」を、「スコープ：Azure Disk Backup を構成しているバックアップ コンテナー」にて構成しています。</p><p>・Azure Backup の Azure Monitor アラート<br>　<a href="https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-monitoring-built-in-monitor?tabs=recovery-services-vaults#azure-monitor-alerts-for-azure-backup">https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-monitoring-built-in-monitor?tabs=recovery-services-vaults#azure-monitor-alerts-for-azure-backup</a></p><p>・「Azure Monitor を使用した組み込みのアラート」を利用したバックアップ ジョブ失敗のアラート通知作成例<br>　<a href="https://jpabrs-scem.github.io/blog/AzureBackupGeneral/How_to_set_Backup_Alert/">https://jpabrs-scem.github.io/blog/AzureBackupGeneral/How_to_set_Backup_Alert/</a></p><p><img src="https://user-images.githubusercontent.com/96324317/211467521-063fe1a2-4480-4191-b7cc-8caad114dbb8.png" alt="アラート 処理ルール"></p><p>(2) バックアップ構成した Azure Managed Disk リソースを削除します。<br><img src="https://user-images.githubusercontent.com/96324317/211467577-a01b51c5-a837-4816-b6d8-8a7625667485.png" alt="ディスク削除01"></p><p><img src="https://user-images.githubusercontent.com/96324317/211467614-9a5f9cc7-743b-4e08-8497-923fe41a6f09.png" alt="ディスク削除02"></p><p>(3) Azure Disk Backup の「今すぐバックアップ」を実行します。</p><p><img src="https://user-images.githubusercontent.com/96324317/211467662-9e0fa822-6330-4f9f-b078-c5acaf0ccefb.png" alt="今すぐバックアップ"></p><p>(4) 約 1 - 2 分後に、バックアップ ジョブが「UserErrorManagedDiskNotFound」エラーにて失敗します。<br><img src="https://user-images.githubusercontent.com/96324317/211467719-ddb8638a-3527-4c8f-bda2-20c97c37ade1.png" alt="バックアップ ジョブ01"></p><p><img src="https://user-images.githubusercontent.com/96324317/211467751-01b098ab-7af6-43bb-a1ed-c9c24838d0c2.png" alt="バックアップ ジョブ02"></p><p>(5) 「Azure Monitor を使用した組み込みのアラート」などのアラートにて、アラートを構成/メール通知構成をしていれば、下図のようなメールにてアラートが通知されます。<br><img src="https://user-images.githubusercontent.com/96324317/211467800-547d8351-3bd6-47f5-b0ca-7b475d0b7542.png" alt="アラート メール"></p><h3 id="2-その他ブログで公開している-Azure-Backup-の失敗方法"><a href="#2-その他ブログで公開している-Azure-Backup-の失敗方法" class="headerlink" title=" 2. その他ブログで公開している Azure Backup の失敗方法"></a><a id="2"></a> 2. その他ブログで公開している Azure Backup の失敗方法</h3><p>・Azure VM Backup を意図的に失敗させる方法<br>　<a href="https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_fail_VM_backup/">https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_fail_VM_backup/</a></p><p>・Azure VM Backup のデータ転送フェーズを意図的に失敗させる方法<br>　<a href="https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_fail_ttv/">https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_fail_ttv/</a></p><p>・MARS バックアップ を意図的に失敗させる方法<br>　<a href="https://jpabrs-scem.github.io/blog/MARSBackup/How_to_fail_MARS_backup/">https://jpabrs-scem.github.io/blog/MARSBackup/How_to_fail_MARS_backup/</a></p><p>・Azure Files Backup を意図的に失敗させる方法<br>　<a href="https://jpabrs-scem.github.io/blog/AzureFilesBackup/How_to_fail_AFS_backup/">https://jpabrs-scem.github.io/blog/AzureFilesBackup/How_to_fail_AFS_backup/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは、Azure Backup サポートです。&lt;br&gt;アラートのテスト等のため “Azure Disk Backup を失敗させたい” というお問い合わせをよくいただきます。&lt;br&gt;今回は、Azure Disk Ba</summary>
      
    
    
    
    
    <category term="Azure Disk Backup" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-Disk-Backup/"/>
    
  </entry>
  
  <entry>
    <title>Azure VM Backup のジョブ前後で任意の処理を行いたい</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureVMBackup/HowToConfigureOptionalProcess/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureVMBackup/HowToConfigureOptionalProcess/</id>
    <published>2023-01-11T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.339Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>こんにちは、Azure Backup サポートです。<br>今回は、よくお問い合わせをいただく、下記 2 種類をお客様要件で実現されたい場合について、ご説明します。<br>１．何らかの処理 (ジョブ・サービス) が終了したあとに ⇒ Azure VM Backup を開始させたいが、Azure Backup としてそのような機能の用意があるか？<br>２．Azure VM Backup のジョブが成功したあとに ⇒ 何らかの処理 (ジョブ・サービス) を開始させたいが、Azure Backup としてそのような機能の用意があるか？</p><p>結論から申し上げますと、上記１．２．どちらも実現できるようなものは、残念ながら Azure VM Backup としては特定の機能のご用意がございません。<br>考えられる案や考慮事項がありますので、詳しく説明します。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. 何らかの処理 (ジョブ・サービス) が終了したあとに ⇒ Azure VM Backup を開始させたいが、Azure Backup としてそのような機能の用意があるか？</a><br><a href="#2">2. バックアップ ポリシーに従って取得済の復元ポイントの中の、特定の復元ポイントのみの保持期間を延長して保持しておくことは可能か</a></p><hr><h2 id="1-何らかの処理-ジョブ・サービス-が終了したあとに-⇒-Azure-VM-Backup-を開始させたいが、Azure-Backup-としてそのような機能の用意があるか？"><a href="#1-何らかの処理-ジョブ・サービス-が終了したあとに-⇒-Azure-VM-Backup-を開始させたいが、Azure-Backup-としてそのような機能の用意があるか？" class="headerlink" title="1. 何らかの処理 (ジョブ・サービス) が終了したあとに ⇒ Azure VM Backup を開始させたいが、Azure Backup としてそのような機能の用意があるか？"></a>1. 何らかの処理 (ジョブ・サービス) が終了したあとに ⇒ Azure VM Backup を開始させたいが、Azure Backup としてそのような機能の用意があるか？<a id="1"></a></h2><h3 id="〈バックアップ対象が-Linux-OS-の-Azure-仮想マシンの場合〉"><a href="#〈バックアップ対象が-Linux-OS-の-Azure-仮想マシンの場合〉" class="headerlink" title="〈バックアップ対象が Linux OS の Azure 仮想マシンの場合〉"></a>〈バックアップ対象が Linux OS の Azure 仮想マシンの場合〉</h3><p>対象 Azure 仮想マシン内に、事前スクリプト・事後スクリプトを貴社にて構築させることによって可能です。<br>事前・事後スクリプトは、元々 Linux OS の仮想マシンを、アプリケーション整合性にて取得したい場合に組み込むものでございます。</p><h4 id="処理概要"><a href="#処理概要" class="headerlink" title="(処理概要)"></a>(処理概要)</h4><p>（０）事前準備として、事前/事後スクリプトを構成しておく<br>（１）バックアップ ポリシーに従ってAzure VM Backup (スケジュール バックアップ) を開始させる<br>（２）Azure VM Backup 処理内で事前スクリプトが起動<br>（３）事前スクリプト内にて、【★ご要件の何らかの処理 (ジョブ・サービス) 】が正常終了しているかどうかを確認する<br>（４）★が正常終了している場合は、事前スクリプトを終了させ、Azure VM Backup の処理 (スナップショット取得) を続ける<br>（５）スナップショット取得処理終了後、事後スクリプト開始・終了<br>（６）Azure VM Backup のジョブ自体がすべて終了</p><p>事前/事後スクリプト構成詳細は以下公開ドキュメントをご参考ください。<br>・Linux VM のアプリケーション整合性バックアップ - Azure Backup | Microsoft Docs<br>　<a href="https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-linux-app-consistent#steps-to-configure-pre-script-and-post-script">https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-linux-app-consistent#steps-to-configure-pre-script-and-post-script</a></p><h3 id="〈バックアップ対象が-Windows-OS-の-Azure-仮想マシンの場合〉"><a href="#〈バックアップ対象が-Windows-OS-の-Azure-仮想マシンの場合〉" class="headerlink" title="〈バックアップ対象が Windows OS の Azure 仮想マシンの場合〉"></a>〈バックアップ対象が Windows OS の Azure 仮想マシンの場合〉</h3><p>Azure Backup としては、残念ながら機能のご用意がございません。</p><h3 id="〈そのほかの案〉"><a href="#〈そのほかの案〉" class="headerlink" title="〈そのほかの案〉"></a>〈そのほかの案〉</h3><p>Linux / Winodws OS に関わらず、その他考えられる案としては下記が挙げられます。</p><h4 id="〈案-1-〉"><a href="#〈案-1-〉" class="headerlink" title="〈案 1 〉"></a>〈案 1 〉</h4><p>お客様にてスクリプトを構成し、スクリプト内部にて【★ご要件の何らかの処理 (ジョブ・サービス) 】が終了したことを確認後、Azure VM Backup をトリガーする。<br>(処理概要)<br>（１）【★ご要件の何らかの処理 (ジョブ・サービス) 】を開始・正常終了させる<br>（２）お客様にてスクリプトを構成し、スクリプト内にて、★が正常終了していることを確認する<br>（３）スクリプト内から Azure VM Backup を「オンデマンド バックアップ」としてトリガーさせる<br>　＋　バックアップ ポリシーにて、週に 1 回スケジュール バックアップを実行させるよう構成する。(※)<br>　＋　週に 1 度はスケジュール バックアップを実行させる。</p><p>コマンドラインからバックアップを実行する場合は必ず「オンデマンド バックアップ (今すぐバックアップ) 」というバックアップの種類となります。<br>Azure VM Backup では、Azure CLI ・Azure PowerShell コマンドなどを用いてオンデマンド バックアップをトリガーすることが可能です。</p><p>・クイックスタート - PowerShell で VM をバックアップする - Azure Backup | Microsoft Learn<br>　<a href="https://learn.microsoft.com/ja-jp/azure/backup/quick-backup-vm-powershell#start-a-backup-job">https://learn.microsoft.com/ja-jp/azure/backup/quick-backup-vm-powershell#start-a-backup-job</a></p><p>・クイックスタート - Azure CLI で VM をバックアップする - Azure Backup | Microsoft Learn<br>　<a href="https://learn.microsoft.com/ja-jp/azure/backup/quick-backup-vm-cli#start-a-backup-job">https://learn.microsoft.com/ja-jp/azure/backup/quick-backup-vm-cli#start-a-backup-job</a></p><p>(※) 以下ブログに記載の通り、スケジュールされたバックアップを週に 1 度は実行いただきたい理由がございますので、ブログ説明もご参照いただけますと幸いです。<br>・Azure VM バックアップを任意のタイミングのみで取得したい | Japan CSS ABRS &amp; SCEM Support Blog (jpabrs-scem.github.io)<br>　<a href="https://jpabrs-scem.github.io/blog/AzureVMBackup/invalid_schedule/">https://jpabrs-scem.github.io/blog/AzureVMBackup/invalid_schedule/</a></p><p>また、〈案 1 〉のスクリプト構成は、Azure Automation にて展開している Runbook の機能を使って構成することも可能です。<br>下記に、Runbook のスケジュール説明も含めた Azure Automation の参考ドキュメントがございますので、ご参考いただけますと幸いです。<br>・Azure Automation で Runbook を管理する | Microsoft Docs<br>　<a href="https://learn.microsoft.com/ja-jp/azure/automation/manage-runbooks">https://learn.microsoft.com/ja-jp/azure/automation/manage-runbooks</a></p><p>なお、 Azure Automation ならびに Runbook に関するご質問がございます場合には、弊社サポート サービスまでお問合せいただけますと幸いです。</p><h4 id="〈案-2-〉"><a href="#〈案-2-〉" class="headerlink" title="〈案 2 〉"></a>〈案 2 〉</h4><p>★が確実に終了している時間帯に、バックアップポリシーに従って、Azure VM Backup （スケジュール バックアップ）を 開始させるよう、バックアップ ポリシーの開始時間を設定しておく。<br>この場合、〈案 1 〉のブログに記載している「Garbage Collection」の問題は (必ずスケジュール バックアップを実行させているため) 回避できますが、★の成功・失敗に関わらず、バックアップ ポリシーに従って必ず Azure VM Backup が開始される、という懸念点がございます。</p><h2 id="2-Azure-VM-Backup-のジョブが成功したあとに-⇒-何らかの処理-ジョブ・サービス-を開始させたいが、Azure-Backup-としてそのような機能の用意があるか？"><a href="#2-Azure-VM-Backup-のジョブが成功したあとに-⇒-何らかの処理-ジョブ・サービス-を開始させたいが、Azure-Backup-としてそのような機能の用意があるか？" class="headerlink" title="2. Azure VM Backup のジョブが成功したあとに ⇒ 何らかの処理 (ジョブ・サービス) を開始させたいが、Azure Backup としてそのような機能の用意があるか？"></a>2. Azure VM Backup のジョブが成功したあとに ⇒ 何らかの処理 (ジョブ・サービス) を開始させたいが、Azure Backup としてそのような機能の用意があるか？<a id="2"></a></h2><p>残念ながら、Azure Backup サービスの単体としては機能のご用意がございませんこと、お伝えいたします。<br>そのうえで、考えられる案としては下記がございます。</p><h3 id="〈案-3-〉"><a href="#〈案-3-〉" class="headerlink" title="〈案 3 〉"></a>〈案 3 〉</h3><p>Azure VM Backup のバックアップ ジョブ ステータスを確認するコマンドにてバックアップ ジョブのステータスを確認後、【★ご要件の何らかの処理 (ジョブ・サービス) 】を開始させるるようなスクリプトをお客様にて構成する。</p><h4 id="処理概要-1"><a href="#処理概要-1" class="headerlink" title="(処理概要)"></a>(処理概要)</h4><p>（１）Azure VM Backup のスケジュール バックアップが開始<br>（２）お客様にて別途実装されたスクリプトを起動する<br>（３）スクリプト内で、バックアップ ジョブのステータスを確認するコマンドを実行し「Take Snapshot」フェーズが「Completed」となっているかどうか確認する<br>（４）スクリプト内で、「Take Snapshot : Completed」となっていることを確認したら、★を開始させる</p><p>Azure VM Backup のバックアップ ジョブには「Take Snapshot」フェーズと、「Transfer data to vault」フェーズという、2 つのフェーズで構成されています。<br>1 つ目の「Take Snapshot」フェーズが「完了 Completed」となれば、Azure 仮想マシンの再起動含めた その他★の作業を実施いただいて構いません。</p><p>・Azure VM Backup における Take Snapshot フェーズの確認方法 | Japan CSS ABRS Support Blog !! (jpabrs-scem.github.io)<br>　<a href="https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_check_VM_backup_Subtask/">https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_check_VM_backup_Subtask/</a></p><h3 id="Azure-VM-Backup-はバックアップ-ポリシー通りの時間に開始されるのか？"><a href="#Azure-VM-Backup-はバックアップ-ポリシー通りの時間に開始されるのか？" class="headerlink" title="Azure VM Backup はバックアップ ポリシー通りの時間に開始されるのか？"></a>Azure VM Backup はバックアップ ポリシー通りの時間に開始されるのか？</h3><p>通常、バックアップ ポリシーにて設定した時間のおよそ 5 分～ 20 分以内程でバックアップ ジョブが開始いたしますが、最大では 2 時間以内にバックアップ ジョブを開始するしくみとなっております。</p><p>・自分の VM バックアップ ポリシーで設定した、スケジュールされたバックアップ時刻からバックアップ開始時刻までの最大遅延時間はどれぐらいですか。<br>　<a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vm-backup-faq#----vm-----------------------------------------------------------------">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vm-backup-faq#----vm-----------------------------------------------------------------</a><br>　“スケジュールされたバックアップは、スケジュールされたバックアップ時刻から 2 時間以内にトリガーされます。”</p><h3 id="Azure-VM-Backup-は通常どれくらいの時間でバックアップ-ジョブが終了するのか？"><a href="#Azure-VM-Backup-は通常どれくらいの時間でバックアップ-ジョブが終了するのか？" class="headerlink" title="Azure VM Backup は通常どれくらいの時間でバックアップ ジョブが終了するのか？"></a>Azure VM Backup は通常どれくらいの時間でバックアップ ジョブが終了するのか？</h3><p>初回バックアップ以降の、毎回のバックアップ ジョブが完了するまでの時間は最大 24 時間以内となっております。<br>リストアやバックアップにかかる時間については、恐縮ながら弊社としては指標を出しておりません。<br>Azure サービスはマルチテナント サービスであるため、バックアップ アイテム (VM) のデータサイズのみではなく、他のリソース、他のユーザー様の稼働状況、帯域の状況などにも処理時間は左右されるためでございます。<br>一方、「Take Snapshot」フェーズのみについて言及しますと、こちらも「必ず〇分に終わる」というベンチマークなどは公開いたしておりませんが、基本的には 5 – 15 分程度で「Take Snapshot」フェーズは完了することが多くございます。</p><p>・初回バックアップの完了に時間がかかるのはなぜですか?<br>　<a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vm-backup-faq#-------------------------">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vm-backup-faq#-------------------------</a><br>　“増分バックアップの合計バックアップ時間は 24 時間未満ですが、初回バックアップではそうはならないことがあります。”</p><p>・Azure Backup での自動化 - Azure Backup | Microsoft Learn<br>　<a href="https://learn.microsoft.com/ja-jp/azure/backup/automation-backup">https://learn.microsoft.com/ja-jp/azure/backup/automation-backup</a></p><p>・Azure Backup の バックアップ / リストア 所要時間について<br>　<a href="https://jpabrs-scem.github.io/blog/AzureBackupGeneral/Backup_RecoveryTIme/">https://jpabrs-scem.github.io/blog/AzureBackupGeneral/Backup_RecoveryTIme/</a></p><h3 id="〈注意事項〉"><a href="#〈注意事項〉" class="headerlink" title="〈注意事項〉"></a>〈注意事項〉</h3><p>Linux OS に対する事前/事後スクリプトの実装や、スクリプトの構成についてはお客様の責任のもと、お客様に検証のうえ、実装いただきますようご留意くださいませ。<br>Azure サポートでは主に Post Production の Break &amp; Fix を担当しており、スクリプトのコードレビューのサポートは承っておりませんので、ご理解をいただけますと幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;こんにちは、Azure Backup サポートです。&lt;br&gt;今回は、よくお問い合わせをいただく、下記 2 種類をお客様要件で実現されたい場合について、ご説明します。&lt;br&gt;１．何らかの処理 (ジョブ・サービス) が終了したあと</summary>
      
    
    
    
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
    <category term="Azure VM Backup" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-VM-Backup/"/>
    
  </entry>
  
  <entry>
    <title>ドメインに参加しているVMのAzure VM Backupリストアについて</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureVMBackup/ActiveDirectory_backup/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureVMBackup/ActiveDirectory_backup/</id>
    <published>2022-11-28T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.339Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>みなさんこんにちは、Azure Backup サポートです。<br>今回は、Active Directory ( 以下、AD ) のドメインに参加している Azure 仮想マシンを、Azure VM Backup にて保護する場合に、よくお問い合わせいただく内容についてご案内いたします。</p><h4 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h4><p>Azure VM Backupにて保護することを前提とすると、「ドメインに参加している Azure 仮想マシンを、Azure VM Backup にてバックアップ・リストアする場合の考慮事項」というのは特にございません。<br>ただし、リストア (=復元) 後は Active Directory の観点で、環境に合わせた考慮事項が発生いたします。<br>Widnows OS 上の作業詳細についてご不明点がございます場合は、恐縮ながら Azure Backup チームではなく、 Active Directory を取り扱う部署にて対応いたしております。<br>Active Directory 観点でのサポートについては、お客様の契約次第ではオンプレミス チームでの有償対応が必要となることがございます。<br>また、お客様のご契約が Azure 製品のサポート契約のみの場合は、オンプレミス範囲のサポート契約がないために、詳細なサポート対応・調査が行えない可能性がございます。<br>お客様にてご契約内容をご確認の上で、「復元」ジョブ完了後の Active Directory 観点の考慮点・作業詳細については、Windows OS - Active Directory 向けへお問い合わせを起票いただきますよう、よろしくお願い申し上げます。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#Q1">Q1. ドメインに参加している Azure 仮想マシンを、Azure VM Backup にてバックアップ・リストアする場合の考慮事項はありますか？</a><br><a href="#Q2">Q2. 「復元」ジョブ完了後は、ドメインの再参加は必要ですか？</a><br><a href="#Q3">Q3. ドメインに参加している Azure 仮想マシンを、Azure VM Backup にてバックアップ・リストアする場合、「復元」後は ドメイン ID は変わってしまいますか？</a><br><a href="#Q4">Q4. ドメインコントローラー ( = DC ) 自体の Azure VM Backup におけるバックアップ・復元について詳細を教えてください</a><br><a href="#Q5">Q5. ドメイン内のひとつの ドメインコントローラーを復元する場合、何らかの考慮が必要になりますか？</a><br><a href="#Q6">Q6. ドメイン内のすべての ドメインコントローラーを復元する場合、何らかの考慮が必要になりますか？</a><br><a href="#Q7">Q7. Azure AD Connect (=AADC) をインストールして使用している Azure 仮想マシンがあります。AADC の復旧手順を教えてください。</a></p><hr><h2 id="Q1-ドメインに参加している-Azure-仮想マシンを、Azure-VM-Backup-にてバックアップ・リストアする場合の考慮事項はありますか？"><a href="#Q1-ドメインに参加している-Azure-仮想マシンを、Azure-VM-Backup-にてバックアップ・リストアする場合の考慮事項はありますか？" class="headerlink" title="Q1. ドメインに参加している Azure 仮想マシンを、Azure VM Backup にてバックアップ・リストアする場合の考慮事項はありますか？"></a><a id="Q1"></a>Q1. ドメインに参加している Azure 仮想マシンを、Azure VM Backup にてバックアップ・リストアする場合の考慮事項はありますか？</h2><h4 id="「構成の復元：新規作成」「構成の復元：既存を置換」など、どの復元オプションで復元すべきですか？"><a href="#「構成の復元：新規作成」「構成の復元：既存を置換」など、どの復元オプションで復元すべきですか？" class="headerlink" title="「構成の復元：新規作成」「構成の復元：既存を置換」など、どの復元オプションで復元すべきですか？"></a>「構成の復元：新規作成」「構成の復元：既存を置換」など、どの復元オプションで復元すべきですか？</h4><p><strong>A1</strong> Azure VM Backupにて保護することを前提とすると、「バックアップ取得する際」「復元時」について、Azure Backup 観点では特に注意点、考慮事項はございません。<br>復元オプションには以下いずれかを選択いただいて構いませんので、お客様のご要件に従って決定ください。<br>（復元オプション）<br>・「構成の復元：新規作成」「復元の種類：新しい仮想マシンの作成」<br>・「構成の復元：新規作成」「復元の種類：ディスクの復元」<br>・「構成の復元：既存を置換」「復元の種類：ディスクの置換」</p><p>・Azure portal で Azure VM データを復元する方法<br>　<a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-arm-restore-vms#restore-vms-with-special-configurations">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-arm-restore-vms#restore-vms-with-special-configurations</a></p><p>ただし、〈前提〉に記載の通り、「復元」ジョブ完了後の Windows OS 上での作業詳細や考慮事項については、Azure サポートではなく、Windows OS - Active Directory 向けへお問い合わせを起票いただきますよう、よろしくお願い申し上げます。</p><h5 id="「復元の種類：新しい仮想マシンの作成」にて復元する場合の考慮点"><a href="#「復元の種類：新しい仮想マシンの作成」にて復元する場合の考慮点" class="headerlink" title="「復元の種類：新しい仮想マシンの作成」にて復元する場合の考慮点"></a>「復元の種類：新しい仮想マシンの作成」にて復元する場合の考慮点</h5><p>この場合、復元される Azure 仮想マシンのホスト名や、SID識別子は復元もとと同一となります。<br>SID 識別子やユーザ固有の情報が重複する為、同一のネットワーク上に「復元の種類：新しい仮想マシンの作成」での復元を行った場合、なんらかの問題が起こる可能性、懸念が考えられます。<br>そのため、復元もとの Azure 仮想マシンが破損などにより起動できない状態などでの復元シナリオでは、重複トラブルは避けられますが、それ以外の目的で復元する場合は、この状態を避けるため、通常は一般化の上利用いただく必要がございます。</p><p>一般化に関しては下記ブログ記事をご覧のうえ、下記の詳細については、新規サービスリクエストを起票の上、Azure VM 担当部署までご相談いただくようお願いいたします。<br>・VM 複製方法について part.1/3 2 つの方法の紹介<br>　<a href="https://jpaztech.github.io/blog/vm/vm-replica-1/">https://jpaztech.github.io/blog/vm/vm-replica-1/</a></p><p>また、「復元の種類：新しい仮想マシンの作成」にて復元した場合は、デフォルトで NIC が新たに作成される点に関するブログ記事を公開しておりますので、下記ご参考になれば幸いです。<br>・Azure VM のリストアの際 NIC の設定が消えてしまう | Japan CSS ABRS &amp; SCEM Support Blog (jpabrs-scem.github.io)<br>　<a href="https://jpabrs-scem.github.io/blog/AzureVMBackup/VMRestoring_NIC_Configuration/">https://jpabrs-scem.github.io/blog/AzureVMBackup/VMRestoring_NIC_Configuration/</a></p><h5 id="「復元の種類：新しい仮想マシンの作成」かつ、復元した-Azure-仮想マシンはネットワーク的に元の環境と疎通がとれる場合"><a href="#「復元の種類：新しい仮想マシンの作成」かつ、復元した-Azure-仮想マシンはネットワーク的に元の環境と疎通がとれる場合" class="headerlink" title="「復元の種類：新しい仮想マシンの作成」かつ、復元した Azure 仮想マシンはネットワーク的に元の環境と疎通がとれる場合"></a>「復元の種類：新しい仮想マシンの作成」かつ、復元した Azure 仮想マシンはネットワーク的に元の環境と疎通がとれる場合</h5><p>「復元」指示時に、Azure 仮想マシン名を復元もと とは異なる名前にしていても、ホスト名・SID は復元もと と同一ですので、既存ドメインのドメインアカウントを有した状態で、ドメイン上に戻されることとなります。<br>仮に復元時、復元もとの Azure 仮想マシンも「実行中」の状態で、「復元」してしまうと、ドメイン上に戻される＆同一のホスト/ SID 名のマシンがドメインネットワーク内に 2 つ存在することとなるため、予期せぬトラブルを招く恐れがあるかと存じます。<br>同一のドメインネットワーク上に「復元」を希望される場合は、一度 ネットワーク 的に分離された環境でリストアしていただき、一般化  ( AD 観点では少なくともホスト名の変更 ) を した上で元のネットワークに参加させる、もとのVM を停止した状態にするなどの方法が考えられます。</p><h5 id="「復元の種類：新しい仮想マシンの作成」にて復元、かつ、復元した-Azure-仮想マシンはネットワーク的に元の環境と疎通ができない場合"><a href="#「復元の種類：新しい仮想マシンの作成」にて復元、かつ、復元した-Azure-仮想マシンはネットワーク的に元の環境と疎通ができない場合" class="headerlink" title="「復元の種類：新しい仮想マシンの作成」にて復元、かつ、復元した Azure 仮想マシンはネットワーク的に元の環境と疎通ができない場合"></a>「復元の種類：新しい仮想マシンの作成」にて復元、かつ、復元した Azure 仮想マシンはネットワーク的に元の環境と疎通ができない場合</h5><p>既存ドメインのドメインアカウントを有した状態にて復元されますが、ネットワークが異なることによってドメイン コントローラーとの疎通ができないため、同じドメイン上には戻されません。</p><h5 id="「復元の種類：ディスクの置換」の場合"><a href="#「復元の種類：ディスクの置換」の場合" class="headerlink" title="「復元の種類：ディスクの置換」の場合"></a>「復元の種類：ディスクの置換」の場合</h5><p>IP アドレスや NSG の設定は、「復元」ジョブ指示前と同じものを利用できます。<br>また、可用性セットを設定していた場合も、再び可用性セットの構成を利用することが可能です。</p><h2 id="Q2-「復元」ジョブ完了後は、ドメインの再参加は必要ですか？"><a href="#Q2-「復元」ジョブ完了後は、ドメインの再参加は必要ですか？" class="headerlink" title="Q2. 「復元」ジョブ完了後は、ドメインの再参加は必要ですか？"></a><a id="Q2"></a>Q2. 「復元」ジョブ完了後は、ドメインの再参加は必要ですか？</h2><p><strong>A2</strong>  下記ドキュメントの通り、復元によってセキュア チャネルが破損する可能性もございますので、基本的には再度ドメイン参加を実施ください。<br>・ドメインにログオンできない ～ セキュア チャネルの破損 ～ | Microsoft Docs<br>　<a href="https://docs.microsoft.com/en-us/archive/blogs/jpntsblog/256">https://docs.microsoft.com/en-us/archive/blogs/jpntsblog/256</a></p><h2 id="Q3-ドメインに参加している-Azure-仮想マシンを、Azure-VM-Backup-にてバックアップ・リストアする場合、「復元」後は-ドメイン-ID-は変わってしまいますか？"><a href="#Q3-ドメインに参加している-Azure-仮想マシンを、Azure-VM-Backup-にてバックアップ・リストアする場合、「復元」後は-ドメイン-ID-は変わってしまいますか？" class="headerlink" title="Q3. ドメインに参加している Azure 仮想マシンを、Azure VM Backup にてバックアップ・リストアする場合、「復元」後は ドメイン ID は変わってしまいますか？"></a><a id="Q3"></a>Q3. ドメインに参加している Azure 仮想マシンを、Azure VM Backup にてバックアップ・リストアする場合、「復元」後は ドメイン ID は変わってしまいますか？</h2><p><strong>A3</strong> 「復元」を指示する際に、ユーザーにて選択した「復元ポイント」時点のドメイン ID にて復元されます。<br><img src="https://user-images.githubusercontent.com/96324317/204124178-ccfee87e-1cf2-4de9-8cb9-4a1053847bf9.png" alt="RestoreVM"></p><h2 id="Q4-ドメインコントローラー-DC-自体の-Azure-VM-Backup-におけるバックアップ・復元について詳細を教えてください"><a href="#Q4-ドメインコントローラー-DC-自体の-Azure-VM-Backup-におけるバックアップ・復元について詳細を教えてください" class="headerlink" title="Q4. ドメインコントローラー ( = DC ) 自体の Azure VM Backup におけるバックアップ・復元について詳細を教えてください"></a><a id="Q4"></a>Q4. ドメインコントローラー ( = DC ) 自体の Azure VM Backup におけるバックアップ・復元について詳細を教えてください</h2><p><strong>A4</strong> 詳細は下記公開ドキュメントに取りまとめていますので、こちらをご参照ください。<br>・Active Directory ドメイン コントローラーのバックアップおよび復元<br>　<a href="https://learn.microsoft.com/ja-jp/azure/backup/active-directory-backup-restore">https://learn.microsoft.com/ja-jp/azure/backup/active-directory-backup-restore</a></p><h2 id="Q5-ドメイン内のひとつの-ドメインコントローラーを復元する場合、何らかの考慮が必要になりますか？"><a href="#Q5-ドメイン内のひとつの-ドメインコントローラーを復元する場合、何らかの考慮が必要になりますか？" class="headerlink" title="Q5. ドメイン内のひとつの ドメインコントローラーを復元する場合、何らかの考慮が必要になりますか？"></a><a id="Q5"></a>Q5. ドメイン内のひとつの ドメインコントローラーを復元する場合、何らかの考慮が必要になりますか？</h2><p><strong>A5</strong> ドメイン内に生存している DC が存在している場合、ひとつの DC を復元する方法に配慮は不要です。<br>例えば同一ドメイン内に DC が 2 台存在する構成の場合には、片方の DC だけ障害が発生する分には Azure Portal からの復元を実施できます。</p><h2 id="Q6-ドメイン内のすべての-ドメインコントローラーを復元する場合、何らかの考慮が必要になりますか？"><a href="#Q6-ドメイン内のすべての-ドメインコントローラーを復元する場合、何らかの考慮が必要になりますか？" class="headerlink" title="Q6. ドメイン内のすべての ドメインコントローラーを復元する場合、何らかの考慮が必要になりますか？"></a><a id="Q6"></a>Q6. ドメイン内のすべての ドメインコントローラーを復元する場合、何らかの考慮が必要になりますか？</h2><p><strong>A6</strong> 考慮が必要です。<br>下記は必要な作業として記載しておりますが、その他に必要な作業は、お客様の環境によって異なってまいりますので、お手数をおかけしますが Azure サポートではなく、Windows OS - Active Directory 向けへお問い合わせを起票いただきますよう、よろしくお願い申し上げます。<br>===<br>すべての DC を復元する場合、グループ ポリシー オブジェクトに関する情報が格納されている SYSVOL 共有の複製において、SYSVOL 共有の　“親” を定義する必要がございます。<br>生存した DC が存在する場合は、生存した DC が自動的に “親” となりますが、すべての DC を復元した場合は、すべての DC が “子” として復元されるため、明示的に “親” を定義する作業が必要になります。<br>簡単ではございますが、手順を作成いたしましたので、ご案内させていただきます。</p><h5 id="留意事項"><a href="#留意事項" class="headerlink" title="留意事項"></a>留意事項</h5><p>最初の DC を Azure VM Backup から復元した後に、SYSVOL を複製しているオブジェクトを<br>編集することによって、SYSVOL のマスターを定義する必要があります。<br>なお、SYSVOL 複製方式は、一般的である DFSR を使用していることを前提とします。</p><h5 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h5><ol><li>1 台目のドメイン コントローラーをバックアップから復元します。</li><li>1 台目のドメイン コントローラー上で DFSR の Authoritative Restore を実施します。</li><li>2 台目以降のドメイン コントローラーをバックアップから復元します。<br>ここで、上記の手順 2) の DFSR の Authoritative Restore に関しては、具体的に下記のような手順を実施します。</li></ol><h5 id="DFSR-の-Authoritative-Restore"><a href="#DFSR-の-Authoritative-Restore" class="headerlink" title="DFSR の Authoritative Restore"></a>DFSR の Authoritative Restore</h5><ol><li>対象のドメイン コントローラーに、管理者権限を持つユーザーでログオンします。</li><li>[ファイル名を指定して実行] から dsa.msc を実行します。</li><li>[表示] メニューの [コンテナーとしてのユーザー、連絡先、グループ、コンピューター] および [拡張機能] をオンにします。</li><li>左ペインのツリーを [Active Directory ユーザーとコンピューター] - [&lt;ドメイン名&gt;] - [Domain Controllers] – [&lt;リストアを実施したドメイン コントローラー&gt;] - [DFSR-LocalSettings] - [Domain System Volume] の順に展開します。</li><li>右ペインの [SYSVOL Subscriptions] を右クリックし、[プロパティ] をクリックします。</li><li>[属性エディター] タブの [属性] 列が [msDFSR-Options] となっている行をダブルクリックします。</li><li>[値] に 1 と入力し、[OK] をクリックします。</li><li>[OK] をクリックします。</li><li>[管理者として実行] からコマンド プロンプトを起動します。</li><li>下記のコマンドを実行し、DFS Replication サービスを再起動します。<br>net stop dfsr &amp;&amp; net start dfsr</li></ol><p>・AD フォレストの回復-DFSR によってレプリケートされた SYSVOL の権限のある同期を実行する<br>　<a href="https://docs.microsoft.com/ja-jp/windows-server/identity/ad-ds/manage/ad-forest-recovery-authoritative-recovery-sysvol">https://docs.microsoft.com/ja-jp/windows-server/identity/ad-ds/manage/ad-forest-recovery-authoritative-recovery-sysvol</a></p><h2 id="Q7-Azure-AD-Connect-AADC-をインストールして使用している-Azure-仮想マシンがあります。AADC-の復旧手順を教えてください。"><a href="#Q7-Azure-AD-Connect-AADC-をインストールして使用している-Azure-仮想マシンがあります。AADC-の復旧手順を教えてください。" class="headerlink" title="Q7. Azure AD Connect (=AADC) をインストールして使用している Azure 仮想マシンがあります。AADC の復旧手順を教えてください。"></a><a id="Q7"></a>Q7. Azure AD Connect (=AADC) をインストールして使用している Azure 仮想マシンがあります。AADC の復旧手順を教えてください。</h2><p><strong>A7</strong> AADC に対しては、「Azure VM Backup」機能を利用したバックアップ・リストアではなく、AADC における Export/Import での再構築が必要となります。<br>AADC に対するバックアップ運用については、下記をご参照ください。</p><p>・Azure AD Connect 設定の Export / Import | Japan Azure Identity Support Blog (jpazureid.github.io)<br>　<a href="https://jpazureid.github.io/blog/azure-active-directory-connect/aadc-import-export-config/">https://jpazureid.github.io/blog/azure-active-directory-connect/aadc-import-export-config/</a></p><p>なお、AADC に対するバックアップ/復旧手順について詳細を確認なされたい場合は、Azure Identity 宛へお問い合わせを起票いただきますよう、よろしくお願い申し上げます。<br>（補足）<br>Azure AD Connect をドメイン コントローラー上にインストールすることは推奨しておりません。</p><p>・Azure AD Connect インストール前の確認事項 | Japan Azure Identity Support Blog (jpazureid.github.io)<br>　<a href="https://jpazureid.github.io/blog/azure-active-directory-connect/checklist-before-installing-aad-connect/#Q-amp-A">https://jpazureid.github.io/blog/azure-active-directory-connect/checklist-before-installing-aad-connect/#Q-amp-A</a><br>　“Q. Azure AD Connect をドメイン コントローラー上にインストールして問題ないか ?<br>　  A. 弊社としては推奨していません。”</p><p>AD 関連の Azure VM Backup について、よくお問い合わせいただく内容の案内としては、以上となります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;みなさんこんにちは、Azure Backup サポートです。&lt;br&gt;今回は、Active Directory ( 以下、AD ) のドメインに参加している Azure 仮想マシンを、Azure VM Backup にて保護する</summary>
      
    
    
    
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
    <category term="Azure VM Backup" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-VM-Backup/"/>
    
  </entry>
  
  <entry>
    <title>Azure VM Backup における Take Snapshot フェーズの確認方法</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_check_VM_backup_Subtask/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_check_VM_backup_Subtask/</id>
    <published>2022-11-21T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.339Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは。Azure Backup サポートの山本です。<br>今回はお問い合わせをいただくことが多い、 <strong>“Azure VM Backup における Take Snapshot フェーズの確認方法”</strong>  について解説させていただきます。<br>Azure VM Backup では  <strong>Take Snapshot フェーズ が終わっていれば VM の再起動などを実施いただいても影響がなく、スナップショットからのリストアが可能 (インスタントリストア) が可能になる</strong>ため、<strong>Take Snapshot フェーズのステータス確認を確認したい、かかった時間を知りたい</strong>、というお問い合わせをよくいただきます。</p><p>まず、はじめに前提知識として Azure VM Backup ではバックアップを取得する際に下記 2 つのサブタスクがございます。<br>1.Take Snapshot (スナップショットの取得)<br>2.Transfer data to vault (Recovery Services コンテナーへの転送)<br><img src="https://user-images.githubusercontent.com/96324317/202889060-48865029-ab86-4ac5-aa2f-0c85ed6ee901.png" alt="Azure VM Backupの 2 つのサブタスク"></p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. サブタスク (Take Snapshot フェーズ) 確認方法</a><br> <a href="#1-notice"> (注意)コマンド実行環境に関する注意</a><br> <a href="#1-1">1-1. Azure Portal を用いたサブタスク (Take Snapshot フェーズ) 確認方法</a><br> <a href="#1-2">1-2. Azure CLI を用いたサブタスク (Take Snapshot フェーズ) 確認方法</a><br> <a href="#1-3">1-3. Azure PowerShell を用いたサブタスク (Take Snapshot フェーズ) 確認方法</a><br><a href="#2">2. サブタスク (Take Snapshot フェーズ) にかかった時間を確認する方法</a><br> <a href="#2-1"> フィードバックご協力のお願い</a></p><hr><h2 id="1-サブタスク-Take-Snapshot-フェーズ-確認方法"><a href="#1-サブタスク-Take-Snapshot-フェーズ-確認方法" class="headerlink" title="1. サブタスク (Take Snapshot フェーズ) 確認方法"></a>1. サブタスク (Take Snapshot フェーズ) 確認方法<a id="1"></a></h2><p>サブタスク確認方法は <strong>Azure Portal で確認する方法</strong>、および、 <strong>Azure CLI や Azure PowerShell といった CLI を用いた方法</strong>がございます。<br>今回弊社検証環境で確認結果も添えてお伝えさせていただきます。<br>また Recovery Services コンテナーのことを RSV と略して表記している部分がございます。</p><h3 id="コマンド実行環境に関する注意"><a href="#コマンド実行環境に関する注意" class="headerlink" title="コマンド実行環境に関する注意"></a>コマンド実行環境に関する注意<a id="1-notice"></a></h3><p>本記事の実行環境は Azure CLI も Azure PowerShell もインターフェースを PowerShell を用いて今回実施しております。<br>そのため、bat ファイル (コマンドプロンプト) などで記述される際には call コマンドを付けていただく必要があるなど、ご利用のインターフェースに応じた対応、記述が必要となることがございます。</p><h3 id="1-1-Azure-Portal-を用いたサブタスク-Take-Snapshot-フェーズ-確認方法"><a href="#1-1-Azure-Portal-を用いたサブタスク-Take-Snapshot-フェーズ-確認方法" class="headerlink" title="1-1. Azure Portal を用いたサブタスク (Take Snapshot フェーズ) 確認方法"></a>1-1. Azure Portal を用いたサブタスク (Take Snapshot フェーズ) 確認方法<a id="1-1"></a></h3><p>[対象の Recovery Services コンテナー] → 左ペインの [バックアップ ジョブ] → 対象のバックアップ ジョブの [View details] → [サブ タスク] の手順で確認いただくことが可能です。<br><img src="https://user-images.githubusercontent.com/96324317/202889187-6a0f9005-1a2e-45f4-8738-d629b0aad991.png" alt="Check_Subtask"></p><h3 id="1-2-Azure-CLI-を用いたサブタスク-Take-Snapshot-フェーズ-確認方法"><a href="#1-2-Azure-CLI-を用いたサブタスク-Take-Snapshot-フェーズ-確認方法" class="headerlink" title="1-2. Azure CLI を用いたサブタスク (Take Snapshot フェーズ) 確認方法"></a>1-2. Azure CLI を用いたサブタスク (Take Snapshot フェーズ) 確認方法<a id="1-2"></a></h3><ul><li>検証環境情報<br>まず、はじめに今回の検証環境の情報です。<blockquote><p>VM名：VM-Win10<br>リソースグループ：RG-alwaysONVM<br>Recovery Services コンテナー：RSV-JPE-LRS<br>リソースグループ：RG-NormalTest<br>コマンド実行ターミナル：PowerShell</p></blockquote></li></ul><p>今回は Windows の PowerShell を用いて Azure CLI を実行します。</p><h4 id="0-事前準備"><a href="#0-事前準備" class="headerlink" title="0.事前準備"></a>0.事前準備</h4><p>　 Azure へログインします。ログインしている環境であれば不要です。</p><blockquote><p>コマンド：<code> </code> <code>az login</code> <code> </code></p></blockquote><h4 id="1-バックアップ-ジョブのステータス確認-Name-値-の取得"><a href="#1-バックアップ-ジョブのステータス確認-Name-値-の取得" class="headerlink" title="1.バックアップ ジョブのステータス確認 (.Name 値 の取得)"></a>1.バックアップ ジョブのステータス確認 (.Name 値 の取得)</h4><blockquote><p>コマンド：<code> </code> <code>az backup job list --resource-group &lt; RSV リソースグループ名&gt; --vault-name &lt; RSV 名&gt; --status InProgress -o table</code> <code> </code><br>コマンド例：<code> </code> <code>az backup job list --resource-group RG-NormalTest --vault-name RSV-JPE-LRS --status InProgress -o table</code> <code> </code></p></blockquote><p>上記コマンドを実行いただくと実行中のバックアップ ジョブの name 値が取得できます。<br> 出力結果を Azure VM Backup の実行中のバックアップ ジョブに限定する場合は下記のオプションを付けることで可能です。</p><blockquote><p>コマンド： <code> </code> <code>--backup-management-type AzureIaasVM</code> <code> </code> </p></blockquote><p>　下記例 “name” : “2a8c96f8-c282-4f62-9286-fda08088047e”<br><img src="https://user-images.githubusercontent.com/71251920/142236195-c47b1fe8-73b0-401e-a050-43be7c4a35d6.png" alt="Check_name_value"></p><h4 id="2-サブタスク-Take-Snapshot-フェーズ-のステータス確認"><a href="#2-サブタスク-Take-Snapshot-フェーズ-のステータス確認" class="headerlink" title="2.サブタスク (Take Snapshot フェーズ) のステータス確認"></a>2.サブタスク (Take Snapshot フェーズ) のステータス確認</h4><p>name 値 を用いて下記のコマンドを実行することでサブタスクのステータスが確認できます。<br>下記例では Take Snapshot のステータスが Completed 、Transfer data to vault のステータスが InProgress 、となっており、スナップショットの取得が終わり、 Recovery Services コンテナーへの転送中であることが分かります。</p><blockquote><p>コマンド：<code> </code> <code>az backup job show --name &lt;name値&gt; --resource-group  &lt; RSV リソースグループ名&gt; --vault-name  &lt; RSV 名&gt; --query properties.extendedInfo.tasksList -o table</code> <code> </code></p></blockquote><blockquote><p>コマンド例 :<code> </code> <code>az backup job show --name 2a8c96f8-c282-4f62-9286-fda08088047e --resource-group  RG-NormalTest --vault-name RSV-JPE-LRS --query properties.extendedInfo.tasksList -o table</code> <code> </code></p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/142236727-60dfeae5-4960-4f91-a96e-c9d223acaff2.png" alt="Check_Subtask_Azure_CLI_1"></p><p>–query オプションを付けない場合は下記の部分から確認できます。</p><blockquote><p>コマンド：<code> </code> <code>az backup job show --name &lt; name 値&gt; --resource-group  &lt; RSV リソースグループ名&gt; --vault-name  &lt; RSV 名&gt;</code> <code> </code><br>コマンド例：<code> </code> <code>az backup job show --name 2a8c96f8-c282-4f62-9286-fda08088047e --resource-group  RG-NormalTest --vault-name RSV-JPE-LRS</code> <code> </code></p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/142236740-9817d4cf-13a9-480b-816c-ba09e252aea6.png" alt="Check_Subtask_Azure_CLI_2"></p><p>また、サブタスクのステータスだけを抜き出して確認したい場合は下記で可能です。</p><h5 id="Take-Snapshot"><a href="#Take-Snapshot" class="headerlink" title="Take Snapshot"></a>Take Snapshot</h5><blockquote><p>コマンド：<code> </code> <code>az backup job show --name &lt;name値&gt; --resource-group  &lt; RSV リソースグループ名&gt; --vault-name  &lt; RSV 名&gt; --query properties.extendedInfo..tasksList[0].status`` </code> </p></blockquote><blockquote><p>コマンド例 :<code> </code> <code>az backup job show --name 2a8c96f8-c282-4f62-9286-fda08088047e --resource-group  RG-NormalTest --vault-name RSV-JPE-LRS --query properties.extendedInfo.tasksList[0].status</code> <code> </code><br><img src="https://user-images.githubusercontent.com/71251920/185892018-c1278aee-66d5-4217-8701-274be03606d8.png"></p></blockquote><h5 id="Transfer-data-to-vault"><a href="#Transfer-data-to-vault" class="headerlink" title="Transfer data to vault"></a>Transfer data to vault</h5><blockquote><p>コマンド：<code> </code> <code>az backup job show --name &lt;name値&gt; --resource-group  &lt; RSV リソースグループ名&gt; --vault-name  &lt; RSV 名&gt; --query properties.extendedInfo..tasksList[1].status`` </code> </p></blockquote><blockquote><p>コマンド例 :<code> </code> <code>az backup job show --name 2a8c96f8-c282-4f62-9286-fda08088047e --resource-group  RG-NormalTest --vault-name RSV-JPE-LRS --query properties.extendedInfo.tasksList[1].status</code> <code> </code><br><img src="https://user-images.githubusercontent.com/71251920/185892022-197514a7-92b6-4160-9bbb-b03a3b40a76e.png"></p></blockquote><ul><li>参考：<br>・Azure CLI を使用した Azure での仮想マシンのバックアップ - バックアップ ジョブを監視する<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/quick-backup-vm-cli#monitor-the-backup-job">https://docs.microsoft.com/ja-jp/azure/backup/quick-backup-vm-cli#monitor-the-backup-job</a><br>・az backup job - az backup job list<br><a href="https://docs.microsoft.com/ja-jp/cli/azure/backup/job?view=azure-cli-latest#az_backup_job_list">https://docs.microsoft.com/ja-jp/cli/azure/backup/job?view=azure-cli-latest#az_backup_job_list</a><br>・JMESPath クエリを使用して Azure CLI コマンドの出力に対してクエリを実行する方法 - 辞書のプロパティを取得する(–query オプションに関する参考情報)<br><a href="https://docs.microsoft.com/ja-jp/cli/azure/query-azure-cli#get-properties-in-a-dictionary">https://docs.microsoft.com/ja-jp/cli/azure/query-azure-cli#get-properties-in-a-dictionary</a><br>・配列内のプロパティを取得する<br><a href="https://docs.microsoft.com/ja-jp/cli/azure/query-azure-cli?tabs=concepts,powershell#get-properties-in-an-array">https://docs.microsoft.com/ja-jp/cli/azure/query-azure-cli?tabs=concepts%2Cpowershell#get-properties-in-an-array</a></li></ul><h3 id="1-3-Azure-PowerShell-を用いたサブタスク-Take-Snapshot-フェーズ-確認方法"><a href="#1-3-Azure-PowerShell-を用いたサブタスク-Take-Snapshot-フェーズ-確認方法" class="headerlink" title="1-3. Azure PowerShell を用いたサブタスク (Take Snapshot フェーズ) 確認方法"></a>1-3. Azure PowerShell を用いたサブタスク (Take Snapshot フェーズ) 確認方法<a id="1-3"></a></h3><p>今回は Windows の PowerShell を用いて Azure PowerShell を実行します。</p><h4 id="0-事前準備-1"><a href="#0-事前準備-1" class="headerlink" title="0.事前準備"></a>0.事前準備</h4><p>　 Azure へログインします。ログインしている環境であれば不要です。</p><blockquote><p>コマンド：<code> </code> <code>Connect-AzAccount</code> <code> </code>　　</p></blockquote><h4 id="1-定数を設定します。"><a href="#1-定数を設定します。" class="headerlink" title="1.定数を設定します。"></a>1.定数を設定します。</h4><blockquote><p>コマンド：<code> </code> <code>$Vault = Get-AzRecoveryServicesVault -Name &quot;&lt; RSV 名&gt;&quot;</code> <code> </code><br>コマンド例：<code> </code> <code>$Vault = Get-AzRecoveryServicesVault -Name &quot;RSV-JPE-LRS&quot;</code> <code> </code></p></blockquote><blockquote><p>コマンド：<code> </code> <code>$VMName = &quot;&lt; VM 名&gt;&quot;</code> <code> </code><br>コマンド例：<code> </code> <code>$VMName = &quot;VM-Win10&quot;</code> <code> </code></p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/142237893-8c25f4e9-4db1-4da5-b27b-7f33160e893a.png" alt="configure_const"></p><h4 id="2-バックアップ-ジョブのステータス確認"><a href="#2-バックアップ-ジョブのステータス確認" class="headerlink" title="2.バックアップ ジョブのステータス確認"></a>2.バックアップ ジョブのステータス確認<a id="a"></a></h4><p>下記コマンドを実行することで、指定した VM の実行中のバックアップ ジョブの一覧が確認できます。<br>下記例では1つしかないため、$Jobs[0] に実行中のバックアップ ジョブの情報が格納されます。<br>複数ある場合は直近に実行されたものから若い番号に格納されます。</p><blockquote><p>コマンド：<br><code> </code> <code>$Jobs = (Get-AzRecoveryservicesBackupJob -Status &quot;InProgress&quot; -VaultId $Vault.id | ? &#123;$_.WorkloadName -eq $vmName&#125;)</code> <code> </code><br><code> </code> <code>$Jobs</code> <code> </code></p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/142238480-a33273d9-7e95-43e0-b23a-451b947fd4f3.png" alt="Check_job_status_ps_1"></p><blockquote><p>コマンド：<code> </code> <code>$Jobs[0]</code> <code> </code></p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/142238471-c9927a38-86e5-4a5d-9140-dee620472a93.png" alt="Check_job_status_ps_2"></p><h4 id="3．実行中のバックアップ-ジョブのサブタスクを取得・表示"><a href="#3．実行中のバックアップ-ジョブのサブタスクを取得・表示" class="headerlink" title="3．実行中のバックアップ ジョブのサブタスクを取得・表示"></a>3．実行中のバックアップ ジョブのサブタスクを取得・表示</h4><p>下記コマンドを実行することでサブタスクのステータスが確認できます。<br>下記例では、Take Snapshot は Completed、Transfer data to vault は InProgress 、となっており、スナップショットの取得が終わり、 Recovery Services コンテナーへの転送中であることが分かります。</p><blockquote><p>コマンド：<br><code> </code> <code>$SubTasks = Get-AzRecoveryServicesBackupJobDetail -Job $Jobs[0]  -VaultId $Vault.id</code> <code> </code><br><code> </code> <code>$SubTasks.subtasks</code> <code> </code></p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/142249583-ef423e62-9bef-4352-bc34-6a87edf18b4a.png" alt="Check_sub_task_ps_1"></p><p>上記警告については、現在使用可能な ”Get-AzRecoveryServicesBackupJobDetail” のエイリアス ”Get-AzRecoveryServicesBackupJobDetails” が将来的に廃止されていることを示しますが、上記のコマンドであれば使用していないので無視していただいて構いません。</p><p>また下記コマンドを実行していただくことで警告を表示させないことが可能です。</p><blockquote><p>コマンド：<code> </code> <code>Set-Item Env:\SuppressAzurePowerShellBreakingChangeWarnings &quot;true&quot;</code> <code> </code></p></blockquote><p>上記のコマンドを実行したところ警告が出ていないことが分かります。</p><p><img src="https://user-images.githubusercontent.com/71251920/142249588-14b3aca1-3e4d-4948-81a9-b874ec1b5dc1.png" alt="Check_sub_task_ps_2"></p><p>・How do I get rid of the warnings? (警告の非表示について)<br><a href="https://github.com/Azure/azure-powershell/blob/main/documentation/breaking-changes/breaking-changes-messages-help.md#how-do-i-get-rid-of-the-warnings">https://github.com/Azure/azure-powershell/blob/main/documentation/breaking-changes/breaking-changes-messages-help.md#how-do-i-get-rid-of-the-warnings</a></p><h4 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h4><p>なお、<a href="#a">2.バックアップ ジョブのステータス確認</a> で下記のように　VM 名を指定しない場合、その他の実行中のバックアップ ジョブも表示されます。(実行中のその他の VM がある場合)</p><blockquote><p>コマンド：<br><code> </code> <code>$Jobs = Get-AzRecoveryservicesBackupJob -Status &quot;InProgress&quot; -VaultId $Vault.id</code> <code> </code><br><code> </code> <code>$Jobs</code> <code> </code></p></blockquote><p>その際の $Jobs[0]、$Jobs[1] の値は次のようになります。<br><img src="https://user-images.githubusercontent.com/71251920/142242086-55eda1c2-5509-4bac-9c5c-c7d1b64c3401.png" alt="Check_job_status_ps_3"></p><ul><li>参考：<br>・APowerShell を使用して Azure VM をバックアップおよび復元する - バックアップ ジョブの監視<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-automation#monitoring-a-backup-job">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-automation#monitoring-a-backup-job</a><br>・Get-AzRecoveryServicesBackupJob<br><a href="https://docs.microsoft.com/ja-jp/powershell/module/az.recoveryservices/get-azrecoveryservicesbackupjob?view=azps-6.6.0">https://docs.microsoft.com/ja-jp/powershell/module/az.recoveryservices/get-azrecoveryservicesbackupjob?view=azps-6.6.0</a></li></ul><h2 id="2-サブタスク-Take-Snapshot-フェーズ-にかかった時間を確認する方法"><a href="#2-サブタスク-Take-Snapshot-フェーズ-にかかった時間を確認する方法" class="headerlink" title="2. サブタスク (Take Snapshot フェーズ) にかかった時間を確認する方法 "></a>2. サブタスク (Take Snapshot フェーズ) にかかった時間を確認する方法 <a id="2"></a></h2><p>2022/11 月現在、Azure Portal 上より、各フェーズの所要時間を確認可能でございます。<br>もしくは、お問い合わせいただくことで弊社にてお客様環境の実績値をお調べしお伝えすることが可能です。<br>その際には下記情報を添えてお問い合わせいただきますようお願いいたします。<br>　・サブスクリプション ID<br>　・VM 名およびそのリソースグループ名<br>　・Recovery Services コンテナー 名およびそのリソースグループ名</p><p>また、今後のバックアップ ジョブであれば、<a href="#1">1. サブタスク (Take Snapshot フェーズ) 確認方法</a>を参考にしていただくことでおおよそ可能かと存じます。<br>具体的には、実行中のバックアップ ジョブを検知し、ループを回して定期的に対象のサブタスク (Take Snapshot フェーズ等) のステータスを確認し、Inprogress である間の時間を計測していただくことでおおよその時間を測定いただければと存じます。<br>なお、具体的な実装につきましては、恐縮ながら Azure サポートサービスの範囲外であるためお客様ご自身でご実装いただきますようお願いいたします。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは。Azure Backup サポートの山本です。&lt;br&gt;今回はお問い合わせをいただくことが多い、 &lt;strong&gt;“Azure VM Backup における Take Snapshot フェーズの確認方法”&lt;/s</summary>
      
    
    
    
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
    <category term="Azure VM Backup" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-VM-Backup/"/>
    
  </entry>
  
  <entry>
    <title>空き領域があるのに、ID 58「ディスクに十分な空き領域がありません」のエラーでバックアップジョブが失敗する場合の対処方法</title>
    <link href="https://jpabrs-scem.github.io/blog/DPM&amp;MABS/Error_58_NoDiskSpace/"/>
    <id>https://jpabrs-scem.github.io/blog/DPM&amp;MABS/Error_58_NoDiskSpace/</id>
    <published>2022-11-21T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.391Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは、Microsoft Azure Backup ＆ Recovery Services サポートです。<br>DPM (Data Protection Manager) や MABS (Microsoft Azure Backup Server) を使用し、ファイルサーバーなどサイズの大きい保護対象をバックアップすることはよくあることです。<br>今回は、データサイズが 16 TB 前後の保護対象をバックアップした際に、ID 58「ディスクに十分な空き領域がありません」のエラーでバックアップジョブが失敗する事象が発生する場合の、その原因と対処方法についてお伝えします。 </p><p>&lt;エラーの抜粋&gt;<br><img src="https://user-images.githubusercontent.com/96324317/202888559-f4e44492-53ff-4b2c-930b-a2af9c15480e.png" alt="エラーの抜粋"></p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. 【原因】</a><br><a href="#2">2. 【対処方法】</a></p><hr><h2 id="1-【原因】"><a href="#1-【原因】" class="headerlink" title="1. 【原因】"></a>1. 【原因】<a id="1"></a></h2><p>データ保存先のディスク記憶域ボリュームの空き領域を確認したところ、十分な「未使用領域」があるのに、なぜ ID 58 にて「ディスクに十分な空き領域がありません」のエラーが発生することがあるのでしょうか。<br><img src="https://user-images.githubusercontent.com/96324317/202888596-0a507b94-2a66-4956-b6b2-cbe7dd2e0a0b.png" alt="画面サンプル"></p><p>【原因】<br>原因として、DPM/MABS が作成するレプリカのサイズは、デフォルトで 16 TB までしか拡張することができないためです。<br>保護対象のデータサイズが約 16 TB に達すると、DPM/MABS はバックアップするためにレプリカのサイズを 16 TB 以上に拡張します。<br>しかし、NTFS ファイルシステムのデフォルトのレプリカクラスターサイズは 4 K 、サポートされる最大ボリュームのサイズは 16 TB となっています。<br>そのため拡張が失敗し、「ディスクに十分な空き領域がありません」のエラーでバックアップ失敗します。 </p><p>＜NTFSのクラスター サイズと最大ボリューム一覧表＞<br><a href="https://docs.microsoft.com/ja-jp/windows-server/storage/file-server/ntfs-overview#support-for-large-volumes">https://docs.microsoft.com/ja-jp/windows-server/storage/file-server/ntfs-overview#support-for-large-volumes</a></p><p>上記エラーを解消するためには、まず下記をお試しください。</p><h2 id="2-【対処方法】"><a href="#2-【対処方法】" class="headerlink" title="2. 【対処方法】"></a>2. 【対処方法】<a id="2"></a></h2><p>保護グループを作成する前に、保護対象のサイズが将来的に 16 TB を超える可能性がある場合、あらかじめ下記の方法でデフォルトのレプリカクラスターサイズを変更してから、保護グループを作成することを強く推奨します。 </p><h5 id="デフォルトのレプリカクラスターサイズを変更する方法"><a href="#デフォルトのレプリカクラスターサイズを変更する方法" class="headerlink" title="デフォルトのレプリカクラスターサイズを変更する方法"></a>デフォルトのレプリカクラスターサイズを変更する方法</h5><p>DPMサーバーにて、下記レジストリエントリを追加します。 </p><blockquote><p>Computer\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft Data Protection Manager\Configuration\DiskStorage<br>ReplicaVolumeClusterSize REG_DWORD<br>REG_DWORD<br>0x00004000(16384) </p></blockquote><p>＜設定サンプル＞<br><img src="https://user-images.githubusercontent.com/96324317/202888754-c88a83bf-1fda-4461-b249-a06e58be7792.png" alt="設定サンプル"></p><p>0x00002000 (8192) に設定する場合、最大ボリュームのサイズ上限は 32 TB になります。<br>0x00004000 (16384) に設定する場合、最大ボリュームのサイズ上限は 64 TB になります。 </p><p>もし、すでにデフォルトのレプリカクラスターサイズが 4 K の環境で、保護グループを作成している場合、レプリカのサイズを 16 TB 以上に拡張するためには、下記手順で保護グループをいったん削除してから、再作成していただく必要があります。 </p><p>１．問題が発生したバックアップの保護グループを削除する (バックアップ データも削除)<br>２．DPM サーバーにて、デフォルトのレプリカクラスターサイズを変更<br>３．新しい保護グループを作成し、バックアップ実施する </p><p>ご案内は以上です。<br>上記アクションを実施後でも事象が改善されない場合、問い合わせを起票していただけますと幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは、Microsoft Azure Backup ＆ Recovery Services サポートです。&lt;br&gt;DPM (Data Protection Manager) や MABS (Microsoft Azu</summary>
      
    
    
    
    
    <category term="TROUBLE SHOOTING" scheme="https://jpabrs-scem.github.io/blog/tags/TROUBLE-SHOOTING/"/>
    
    <category term="DPM / MABS" scheme="https://jpabrs-scem.github.io/blog/tags/DPM-MABS/"/>
    
  </entry>
  
  <entry>
    <title>Azure VM Backup でリストアする際に利用するステージングの場所として利用するストレージ アカウントについて</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureVMBackup/RestoreStagingStorageAccount/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureVMBackup/RestoreStagingStorageAccount/</id>
    <published>2022-10-28T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.339Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>こんにちは、Azure Backup サポートの山本です。<br>今回は、Azure VM Backup でリストアする際に利用するステージングの場所として利用するストレージ アカウントについて、下記の通りお伝えします。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. 公開情報 (Docs)</a><br><a href="#2">2. 利用できるストレージ アカウント</a><br><a href="#3">3. リストアされた後にストレージ アカウントに残るファイルについて</a><br><a href="#4">4. 参考画面ショット</a></p><hr><h3 id="1-公開情報-Docs"><a href="#1-公開情報-Docs" class="headerlink" title="1. 公開情報 (Docs)"></a><a id="1"></a>1. 公開情報 (Docs)</h3><p>まず最初に、本件に関する Docs は下記でございます。<br>・ストレージ アカウント- Azure portal で Azure VM データを復元する方法<br><a href="https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-arm-restore-vms#storage-accounts">https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-arm-restore-vms#storage-accounts</a></p><blockquote><p>抜粋:”Vault-Standard 復元ポイントからマネージド VM のディスクを復元するときに、マネージド ディスクと Azure Resource Manager (ARM) テンプレートが、ステージング場所にあるディスクの VHD ファイルと共に復元されます。 インスタント復元ポイントからディスクを復元する場合、マネージド ディスクと ARM テンプレートのみが復元されます。”</p></blockquote><blockquote><p>抜粋:リージョン間復元では、 ステージング場所 (ストレージ アカウントの場所) は、Recovery Services コンテナーが セカンダリ リージョンとして扱うリージョンに存在する必要があります。 たとえば、Recovery Services コンテナーは米国東部 2 リージョンにあります (geo 冗長性とリージョン間復元が有効になっています)。 これは、セカンダリ リージョンは米国中部であることを意味します。 そのため、VM のリージョン間復元を行なうには、米国中部でストレージ アカウントを作成する必要があります。<br><a href="https://learn.microsoft.com/ja-jp/azure/availability-zones/cross-region-replication-azure">すべての地域の Azure リージョン間レプリケーションのペアリングに関する記事</a>をご覧ください。</p></blockquote><h3 id="2-利用できるストレージ-アカウント"><a href="#2-利用できるストレージ-アカウント" class="headerlink" title="2. 利用できるストレージ アカウント"></a><a id="2"></a>2. 利用できるストレージ アカウント</h3><p>選択できるストレージ アカウントは下記の条件を満たすものです。<br>・リストア先 (=ターゲット) のサブスクリプション内およびコンテナーと同じリージョンにある<br>・ZRS 以外の冗長性(LRS・GRS)<br>・Premium Storage アカウントではない</p><h3 id="3-リストアされた後にストレージ-アカウントに残るファイルについて"><a href="#3-リストアされた後にストレージ-アカウントに残るファイルについて" class="headerlink" title="3.リストアされた後にストレージ アカウントに残るファイルについて"></a><a id="3"></a>3.リストアされた後にストレージ アカウントに残るファイルについて</h3><p>マネージドディスクの Azure VM の復元が完了しますと対象のストレージ アカウントの中に下記のファイルが残ります。<br>下記の通り、ストレージ アカウントにファイルが残るかおよび、どのファイルが残るかはリストア シナリオによって異なります。</p><table><thead><tr><th align="left">#</th><th align="left"></th><th align="left">リストアシナリオ</th><th align="left">ステージングのストレージ アカウントに残るファイル</th></tr></thead><tbody><tr><td align="left"></td><td align="left"></td><td align="left"><strong>Recovery Services コンテナー (vault-standrd) 層からのリストア</strong></td><td align="left"></td></tr><tr><td align="left">1</td><td align="left"></td><td align="left">新規 VM 作成</td><td align="left">無し</td></tr><tr><td align="left">2</td><td align="left"></td><td align="left">ディスクの復元</td><td align="left">VHD ファイルと json ファイル</td></tr><tr><td align="left">3</td><td align="left"></td><td align="left">既存の置換え</td><td align="left">VHD ファイル</td></tr><tr><td align="left"></td><td align="left"></td><td align="left"><strong>スナップショット 層からのリストア(インスタントリストア)</strong></td><td align="left"></td></tr><tr><td align="left">4</td><td align="left"></td><td align="left">新規 VM 作成</td><td align="left">無し</td></tr><tr><td align="left">5</td><td align="left"></td><td align="left">ディスクの復元</td><td align="left">json ファイル</td></tr><tr><td align="left">6</td><td align="left"></td><td align="left">既存の置換え</td><td align="left">無し</td></tr><tr><td align="left"></td><td align="left"></td><td align="left"><strong>クロスリージョン リストア</strong></td><td align="left"></td></tr><tr><td align="left">7</td><td align="left"></td><td align="left">新規 VM 作成</td><td align="left">無し</td></tr><tr><td align="left">8</td><td align="left"></td><td align="left">ディスクの復元</td><td align="left">VHD ファイルと json ファイル</td></tr></tbody></table><p>これらのファイルはリストア後自動では削除されませんが、手動で削除することが可能です。</p><h3 id="4-参考画面ショット"><a href="#4-参考画面ショット" class="headerlink" title="4.参考画面ショット"></a><a id="4"></a>4.参考画面ショット</h3><p> VM 名：VM-RHEL-PE という Azure VM (OS ディスク 1 つ、データディスク 2 つ) を (2) の既存の置換えにてリストアしたあとのストレージ アカウントです。</p><p> <img src="https://user-images.githubusercontent.com/71251920/198330594-30a09f02-cb39-41c8-ae39-1ab9a21779ac.png"></p><blockquote><p>コンテナー名：<br> vmrhelpe-51f2bd236a2e479a95cfc2bdd53b986c<br> 上記の通り、Azure VM 名にランダムな文字列のコンテナー名のコンテナーが作成されます。</p></blockquote><blockquote><p>VHD：<br> vmrhelpe-datadisk-000-20220319-233028.vhd<br> vmrhelpe-datadisk-001-20220319-233028.vhd<br> vmrhelpe-osdisk-20220319-233028.vhd<br> 上記の通り、Azure VM 名にディスク種別および LUN 番号リストア日時 (UTC表記) が付加された vhd ファイルが作成されます。</p></blockquote><blockquote><p>json：<br> azuredeployf08911fe-654a-49e1-9baa-41ca15cbb272.json<br> config-sqlvm13-f08911fe-654a-49e1-9baa-41ca15cbb272.json<br> parameterf08911fe-654a-49e1-9baa-41ca15cbb272.json<br> 上記の通り、<br> 「azuredeploy&lt;リストア ジョブで使用されるJob ID&gt;」<br> 「config-&lt;VM 名&gt;-&lt;リストア ジョブで使用されるJob ID&gt;」<br> 「parameter&lt;リストア ジョブで使用されるJob ID&gt;」の名前から始まるファイルが 3 つ作成されます。</p></blockquote><p>「Job ID」は、コマンドからの確認や、Recovery Services コンテナー &gt; バックアップ ジョブ &gt; 「ジョブのエクスポート」より確認ができます。</p><p>・ジョブをエクスポートする<br>　<a href="https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-manage-windows-server#export-jobs">https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-manage-windows-server#export-jobs</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;こんにちは、Azure Backup サポートの山本です。&lt;br&gt;今回は、Azure VM Backup でリストアする際に利用するステージングの場所として利用するストレージ アカウントについて、下記の通りお伝えします。&lt;/p</summary>
      
    
    
    
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
    <category term="Azure VM Backup" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-VM-Backup/"/>
    
  </entry>
  
  <entry>
    <title>Azure Backup の 保持期間について</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureBackupGeneral/Backup_RetentionPeriod/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureBackupGeneral/Backup_RetentionPeriod/</id>
    <published>2022-10-27T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.307Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは。Azure Backup サポートです。<br>今回は、よくお問い合わせをうける「保持期限」について、取りまとめてお伝えします。<br>公開ドキュメント上では、下記のように「最大保有期間：バックアップ頻度次第」と記載が書かれており、実際に「毎日」「毎週」のバックアップを構成した場合の最大保有期間は、ポリシー作成画面で確認するのみとなっております。</p><p>・保有の制限<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-support-matrix#retention-limits">https://docs.microsoft.com/ja-jp/azure/backup/backup-support-matrix#retention-limits</a></p><p><img src="https://user-images.githubusercontent.com/96324317/197381027-dcf0c231-950e-4b50-a14f-4f2d991c9616.png"></p><p>（図例：Azure VM Backup の場合）<br><img src="https://user-images.githubusercontent.com/96324317/197453814-73c643d9-ad3f-458c-b729-4fb7a409aab6.png"></p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. Azure VM Backup の場合</a><br><a href="#2">2. Azure ファイル共有に対する Azure Backup の場合</a><br><a href="#3">3. SQL Server DB に対する Azure Backup の場合</a><br><a href="#4">4. SAP HANA DB に対する Azure Backup の場合</a><br><a href="#5">5. Microsoft Azure Recovery Services (MARS) の場合</a></p><hr><h2 id="1-Azure-VM-Backup-の場合"><a href="#1-Azure-VM-Backup-の場合" class="headerlink" title=" 1. Azure VM Backup の場合"></a><a id="1"></a> 1. Azure VM Backup の場合</h2><table><thead><tr><th>Azure VM に対するバックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>インスタント回復スナップショットの保有期間</td><td>1 日</td><td>ポリシーのサブタイプ：Standard の場合： 5<br>ポリシーのサブタイプ：Enhanced の場合： 30 日</td></tr><tr><td>毎日</td><td>7 日</td><td>9999 日</td></tr><tr><td>毎週</td><td>1 週</td><td>5163 週</td></tr><tr><td>毎月</td><td>1 ヶ月</td><td>1188 ヶ月</td></tr><tr><td>毎年</td><td>1 年</td><td>99 年</td></tr></tbody></table><p>（補足）オンデマンド バックアップの場合、最大 99 年まで保持期間を指定可能です。<br><img src="https://user-images.githubusercontent.com/96324317/197448093-5b532557-b4e6-44de-b837-01993756862a.png"></p><h2 id="2-Azure-ファイル共有に対する-Azure-Backup-の場合"><a href="#2-Azure-ファイル共有に対する-Azure-Backup-の場合" class="headerlink" title=" 2. Azure ファイル共有に対する Azure Backup の場合"></a><a id="2"></a> 2. Azure ファイル共有に対する Azure Backup の場合</h2><table><thead><tr><th>Azure ファイル共有 に対するバックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎日</td><td>1 日</td><td>200 日</td></tr><tr><td>毎週</td><td>1 週</td><td>200 週</td></tr><tr><td>毎月</td><td>1 ヶ月</td><td>120 ヶ月</td></tr><tr><td>毎年</td><td>1 年</td><td>10 年</td></tr></tbody></table><h2 id="3-SQL-Server-DB-に対する-Azure-Backup-の場合"><a href="#3-SQL-Server-DB-に対する-Azure-Backup-の場合" class="headerlink" title=" 3. SQL Server DB に対する Azure Backup の場合"></a><a id="3"></a> 3. SQL Server DB に対する Azure Backup の場合</h2><table><thead><tr><th>完全バックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎日</td><td>7 日</td><td>9999 日</td></tr><tr><td>毎週</td><td>1 週</td><td>5163 週</td></tr><tr><td>毎月</td><td>1 ヶ月</td><td>1188 ヶ月</td></tr><tr><td>毎年</td><td>1 年</td><td>99 年</td></tr></tbody></table><table><thead><tr><th>差分バックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎週</td><td>7 日</td><td>180 日</td></tr></tbody></table><table><thead><tr><th>ログバックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎分/毎時</td><td>7 日</td><td>35 日</td></tr></tbody></table><h2 id="4-SAP-HANA-DB-に対する-Azure-Backup-の場合"><a href="#4-SAP-HANA-DB-に対する-Azure-Backup-の場合" class="headerlink" title=" 4. SAP HANA DB に対する Azure Backup の場合"></a><a id="4"></a> 4. SAP HANA DB に対する Azure Backup の場合</h2><table><thead><tr><th>完全バックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎日</td><td>7 日</td><td>9999 日</td></tr><tr><td>毎週</td><td>1 週</td><td>5163 週</td></tr><tr><td>毎月</td><td>1 ヶ月</td><td>1188 ヶ月</td></tr><tr><td>毎年</td><td>1 年</td><td>99 年</td></tr></tbody></table><table><thead><tr><th>差分バックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎週</td><td>7 日</td><td>180 日</td></tr></tbody></table><table><thead><tr><th>増分バックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎週</td><td>7 日</td><td>180 日</td></tr></tbody></table><table><thead><tr><th>ログバックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎分/毎時</td><td>7 日</td><td>35 日</td></tr></tbody></table><h2 id="5-Microsoft-Azure-Recovery-Services-MARS-の場合"><a href="#5-Microsoft-Azure-Recovery-Services-MARS-の場合" class="headerlink" title=" 5. Microsoft Azure Recovery Services (MARS) の場合"></a><a id="5"></a> 5. Microsoft Azure Recovery Services (MARS) の場合</h2><table><thead><tr><th>MARS バックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎日</td><td>7 日</td><td>9999 日</td></tr><tr><td>毎週</td><td>4 週</td><td>5163 週</td></tr><tr><td>毎月</td><td>3 ヶ月</td><td>1316 ヶ月</td></tr><tr><td>毎年</td><td>1 年</td><td>100 年</td></tr></tbody></table><p>Azure Backup における保有期間について、以上となります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは。Azure Backup サポートです。&lt;br&gt;今回は、よくお問い合わせをうける「保持期限」について、取りまとめてお伝えします。&lt;br&gt;公開ドキュメント上では、下記のように「最大保有期間：バックアップ頻度次第」</summary>
      
    
    
    
    
    <category term="Azure Backup General" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-Backup-General/"/>
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
  </entry>
  
  <entry>
    <title>SQL Server DB に対する Azure Backupを、Proxy Serverをバイパスして PE 経由でバックアップする場合の設定</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureSQLBackup/How_to_PE_SQL_backup_bypass_proxy/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureSQLBackup/How_to_PE_SQL_backup_bypass_proxy/</id>
    <published>2022-10-27T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.339Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは、Azure Backup サポートです。<br>今回は、SQL Server DB に対する Azure Backupを、Proxy Serverをパイパスして PE 経由でバックアップする場合の設定方法についてお伝えします。</p><h4 id="ポイント"><a href="#ポイント" class="headerlink" title="ポイント"></a>ポイント</h4><h5 id="ポイントその-1"><a href="#ポイントその-1" class="headerlink" title="( ポイントその 1 )"></a>( ポイントその 1 )</h5><p>Poxyを経由させてSQL Server DB に対する Azure Backupを行いたい場合は、下記2種類のアカウントに対して、クライアントOS上でProxy設定を行う必要があります。<br>　１つ目：Local System アカウント<br>　２つ目：NT Service\AzureWLBackupPluginSvcアカウント</p><p>そのため、Proxyは経由せず（＝「Proxyをバイパスする」）、バックアップを取得したい場合は、上記 ２ つのアカウントに対してバイパス設定を行う必要があります。<br>※もともと２つのアカウントに対してProxy Server 設定を行っていないのであれば、SQL Server DB に対する Azure BackupにおいてProxyを経由してバックアップすることはありません。</p><p>上記２つのアカウントに対してProxyを設定している、かつ　Proxy を経由せずに、プライベート エンドポイント（PE）経由でSQL Backupをさせたい場合、下記をバイパスさせる必要があります。<br>（例外リスト/バイパスリスト）<br>    　LocalHost 、Wire Server （168.63.129.16）、169.254.169.254、以下ドキュメント記載のAzure Backup、Azure Storage、Azure Active Directory</p><p>・プライベート エンドポイントを使用して Recovery Services コンテナー用のプロキシ サーバーを設定する<br>　<a href="https://docs.microsoft.com/ja-jp/azure/backup/private-endpoints#set-up-proxy-server-for-recovery-services-vault-with-private-endpoint">https://docs.microsoft.com/ja-jp/azure/backup/private-endpoints#set-up-proxy-server-for-recovery-services-vault-with-private-endpoint</a> </p><h5 id="ポイントその-2"><a href="#ポイントその-2" class="headerlink" title="( ポイントその 2 )"></a>( ポイントその 2 )</h5><p>本ブログ記事作成時点 (2022/10) では、Azure Active Directory ( =AAD ) はプライベート エンドポイントに対応していませんので、AAD は PE 以外の疎通ルートを確立させる必要があります。</p><h2 id="目次-手順概略"><a href="#目次-手順概略" class="headerlink" title="目次 - 手順概略"></a>目次 - 手順概略</h2><hr><p><a href="#1">1. Recovery Services コンテナー上にプライベート エンドポイントを作成</a><br><a href="#2">2．バックアップ対象の SQL Server DB が存在する Azure 仮想マシン上で、Local System アカウントに対して、SQL Server DB に対する Azure Backup サービスがバイパスされるよう、設定</a><br><a href="#3">3. 「データベースの検出」「バックアップの有効化」</a><br><a href="#4">4. バックアップ対象の SQL Server DB が存在する Azure 仮想マシン上で、サービスアカウント ( NT Service\AzureWLBackupPluginSvc ) に対して、 SQL Server DB に対する Azure Backup サービスがバイパスされるよう、設定</a><br><a href="#5">5. SQL Server DB に対する Azure Backup「今すぐバックアップ」を実行</a></p><hr><h2 id="1-Recovery-Services-コンテナー上にプライベート-エンドポイントを作成"><a href="#1-Recovery-Services-コンテナー上にプライベート-エンドポイントを作成" class="headerlink" title=" 1. Recovery Services コンテナー上にプライベート エンドポイントを作成"></a><a id="1"></a> 1. Recovery Services コンテナー上にプライベート エンドポイントを作成</h2><p>こちらは 弊社公開ドキュメントに詳細手順を公開しておりますので、下記をご参考に作成ください。<br>・Azure Backup のプライベート エンドポイントの作成と使用<br>　<a href="https://docs.microsoft.com/ja-jp/azure/backup/private-endpoints">https://docs.microsoft.com/ja-jp/azure/backup/private-endpoints</a> </p><h2 id="2．バックアップ対象の-SQL-Server-DB-が存在する-Azure-仮想マシン上で、Local-System-アカウントに対して、SQL-Server-DB-に対する-Azure-Backup-サービスがバイパスされるよう、設定"><a href="#2．バックアップ対象の-SQL-Server-DB-が存在する-Azure-仮想マシン上で、Local-System-アカウントに対して、SQL-Server-DB-に対する-Azure-Backup-サービスがバイパスされるよう、設定" class="headerlink" title=" 2．バックアップ対象の SQL Server DB が存在する Azure 仮想マシン上で、Local System アカウントに対して、SQL Server DB に対する Azure Backup サービスがバイパスされるよう、設定"></a><a id="2"></a> 2．バックアップ対象の SQL Server DB が存在する Azure 仮想マシン上で、Local System アカウントに対して、SQL Server DB に対する Azure Backup サービスがバイパスされるよう、設定</h2><h5 id="Local-System-アカウント-に対する-Proxy-Server-バイパス設定-手順詳細"><a href="#Local-System-アカウント-に対する-Proxy-Server-バイパス設定-手順詳細" class="headerlink" title="Local System アカウント に対する Proxy Server バイパス設定 手順詳細"></a>Local System アカウント に対する Proxy Server バイパス設定 手順詳細</h5><p>以下より PsExec をダウンロードします。​<br>​　・PsExec v2.2<br>　　<a href="https://docs.microsoft.com/ja-jp/sysinternals/downloads/psexec">https://docs.microsoft.com/ja-jp/sysinternals/downloads/psexec</a> </p><p>管理者特権のプロンプトから ダウンロードしたファイルを解凍したフォルダに移動し 、次のコマンドを実行して Internet Explorer を開きます。​<br>（実行コマンド）</p><blockquote><p>psexec -i -s “c:\Program Files\Internet Explorer\iexplore.exe”​</p></blockquote><p>Internet Explorer で、[ツール] &gt; [インターネット オプション] &gt; [接続] &gt; [LAN の設定] の順に移動します。​<br>システム アカウントの Proxy 設定を確認します。<br>Proxy の IP アドレスとポートを設定します。​</p><p>・下図例では、Proxy Server の IP アドレスが「10.2.0.16」である前提の画面スクリーンショットとなっています。<br>・下図中央の「Local Area Network (LAN) Settings」ウィンドウ ＞ 「Byspass proxy server for local addresses」チェックボックスを ON とします。<br>　これは、下記公開ドキュメント「VM 内の localhost 通信のプロキシを無効にします。」と記載している設定に該当しています。<br>　・トラフィックをルーティングするために HTTP プロキシ サーバーを使用する<br>　　<a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-sql-server-database-azure-vms#use-an-http-proxy-server-to-route-traffic">https://docs.microsoft.com/ja-jp/azure/backup/backup-sql-server-database-azure-vms#use-an-http-proxy-server-to-route-traffic</a></p><p>・下図一番右側の「Proxy Settings」ウィンドウ ＞ 「Exceptions」欄に記入すべきものが、SQL Server DB に対する Azure Backup 実行時 (= Local Sysytem アカウントが利用される際) に、Proxy Server を経由させずに通信したい場合のアドレスを入力する欄です。<br>　ここに、以下を記入することで、SQL Server DB に対する Azure Backup 実行時はプロキシをバイパスさせることができます。<br>　LocalHost 、Wire Server （168.63.129.16）、169.254.169.254、上記ドキュメント記載のAzure Backup、Azure Storage、AAD</p><p>(実際の入力値)<br>localhost;168.63.129.16;169.254.169.254;<em>.backup.windowsazure.com;</em>.queue.core.windows.net;<em>.blob.core.windows.net;<br><em>.blob.storage.azure.net;</em>.msftidentity.com;</em>.msidentity.com;account.activedirectory.windowsazure.com;<br>accounts.accesscontrol.windows.net;adminwebservice.microsoftonline.com;api.passwordreset.microsoftonline.com;<br>autologon.microsoftazuread-sso.com;becws.microsoftonline.com;clientconfig.microsoftonline-p.net;<br>companymanager.microsoftonline.com;device.login.microsoftonline.com;graph.microsoft.com;graph.windows.net;<br>login.microsoft.com;login.microsoftonline.com;login.microsoftonline-p.com;login.windows.net;<br>logincert.microsoftonline.com;loginex.microsoftonline.com;login-us.microsoftonline.com;nexus.microsoftonline-p.com;<br>passwordreset.microsoftonline.com;provisioningapi.microsoftonline.com;20.190.128.<em>;40.126.</em>;<em>.hip.live.com;<br><em>.microsoftonline.com;</em>.microsoftonline-p.com;</em>.msauth.net;<em>.msauthimages.net;</em>.msecnd.net;*.msftauth.net;<br><em>.msftauthimages.net;</em>.phonefactor.net;enterpriseregistration.windows.net;management.azure.com;policykeyservice.dc.ad.msft.net</p><p><img src="https://user-images.githubusercontent.com/96324317/197693453-7e4e98b9-a52b-4965-bd0a-f5751bfd4c90.png"></p><h2 id="3．「データベースの検出」「バックアップの有効化」"><a href="#3．「データベースの検出」「バックアップの有効化」" class="headerlink" title=" 3．「データベースの検出」「バックアップの有効化」"></a><a id="3"></a> 3．「データベースの検出」「バックアップの有効化」</h2><p>Azure ポータル画面上から、対象の SQL Server DB に対して「データベースの検出」「バックアップの有効化」を行います。</p><p>・コンテナーから複数の SQL Server VM をバックアップする - Azure Backup | Microsoft Docs<br>　<a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-sql-server-database-azure-vms#discover-sql-server-databases">https://docs.microsoft.com/ja-jp/azure/backup/backup-sql-server-database-azure-vms#discover-sql-server-databases</a> </p><h2 id="4．バックアップ対象の-SQL-Server-DB-が存在する-Azure-仮想マシン上で、サービスアカウント-NT-Service-AzureWLBackupPluginSvc-に対して、-SQL-Server-DB-に対する-Azure-Backup-サービスがバイパスされるよう、設定"><a href="#4．バックアップ対象の-SQL-Server-DB-が存在する-Azure-仮想マシン上で、サービスアカウント-NT-Service-AzureWLBackupPluginSvc-に対して、-SQL-Server-DB-に対する-Azure-Backup-サービスがバイパスされるよう、設定" class="headerlink" title=" 4．バックアップ対象の SQL Server DB が存在する Azure 仮想マシン上で、サービスアカウント ( NT Service\AzureWLBackupPluginSvc ) に対して、 SQL Server DB に対する Azure Backup サービスがバイパスされるよう、設定"></a><a id="4"></a> 4．バックアップ対象の SQL Server DB が存在する Azure 仮想マシン上で、サービスアカウント ( NT Service\AzureWLBackupPluginSvc ) に対して、 SQL Server DB に対する Azure Backup サービスがバイパスされるよう、設定</h2><p>「バックアップの有効化」が成功後、Azure Backup サービスによって対象マシン上に生成済の「NT Service\AzureWLBackupPluginSvc」アカウントに対する、Proxy Server のバイパス設定を行います。<br>バイパスリストは  Local Sysytem アカウントに対して設定した内容と同一です。<br>下記に、「NT Service\AzureWLBackupPluginSvc」アカウントへの設定手順の一例を記載します。<br>一例としては、カレントユーザーに対して行ったProxy設定を、コマンド実行によって「NT Service\AzureWLBackupPluginSvc」アカウントに対して引き継ぐ手順です。<br>そのため、一時的にまずはカレントユーザーに対しても、Proxy Server のバイパス設定を行います。</p><h5 id="一例-「NT-Service-AzureWLBackupPluginSvc」アカウントに対する-Proxy-バイパス設定-手順詳細"><a href="#一例-「NT-Service-AzureWLBackupPluginSvc」アカウントに対する-Proxy-バイパス設定-手順詳細" class="headerlink" title="(一例) 「NT Service\AzureWLBackupPluginSvc」アカウントに対する Proxy バイパス設定 手順詳細"></a>(一例) 「NT Service\AzureWLBackupPluginSvc」アカウントに対する Proxy バイパス設定 手順詳細</h5><p>まずは「NT Service\AzureWLBackupPluginSvc」アカウントが存在しているかを、念のため確認します。<br>対象マシン上で、スタートボタンを右クリック ＞ ファイル名を指定して実行 ＞ 「regedit」を入力し「OK」をクリックします。<br><img src="https://user-images.githubusercontent.com/96324317/197693696-1df4ae35-e8c8-4afc-b4ff-cf21ab2f912d.png"></p><p><img src="https://user-images.githubusercontent.com/96324317/197693727-6c4cef17-55b3-4865-be4d-660435ad3b4a.png"></p><p>レジストリ エディターが開きますので、以下パスへ遷移します。<br>（対象パス）<br>        HKEY_USERS\S-1-5-80-1631947889-4033244730-3205203906-53534054-4184208151</p><p>上記レジストリキー (フォルダー)「S-1-5-80-1631947889-4033244730-3205203906-53534054-4184208151」が、「NT Service\AzureWLBackupPluginSvc」アカウントを表しています。<br>この時点で存在していない場合、「データベースの検出」「バックアップの有効化」もしくは「再登録」が正常完了していない可能性がありますので、「データベースの検出」「バックアップの有効化」「再登録」が成功しているかどうかを再度確認・再実行願います。<br><img src="https://user-images.githubusercontent.com/96324317/197693875-49891f05-2b67-4040-9641-1f99ca7b271a.png"></p><p>レジストリ エディター上でレジストリキー (フォルダー)「S-1-5-80-1631947889-4033244730-3205203906-53534054-4184208151」が存在していることを確認出来たら、一時的に カレントユーザーに対して Proxy Server の設定を行います。</p><p>・設定内容は、Local System アカウント に対する Proxy Server バイパス設定と同一です<br>・下図例 では、Proxy Server の IP アドレスが「10.2.0.16」である前提の画面スクリーンショットとなっています。<br>・下図中央の「Don’t use the proxy server for local (intranet) addresses」チェックボックスを ON とします。<br>　これは、下記公開ドキュメント「VM 内の localhost 通信のプロキシを無効にします。」と記載している設定に該当しています。<br>　・トラフィックをルーティングするために HTTP プロキシ サーバーを使用する<br>　　<a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-sql-server-database-azure-vms#use-an-http-proxy-server-to-route-traffic">https://docs.microsoft.com/ja-jp/azure/backup/backup-sql-server-database-azure-vms#use-an-http-proxy-server-to-route-traffic</a></p><p>・下図一番右側 黄色罫線箇所が、Proxy Server を経由させずに通信したい場合のアドレスを入力する欄です。<br>　ここに、以下を記入することで、SQL Server DB に対する Azure Backup 実行時はプロキシをバイパスさせることができます。<br>　LocalHost 、Wire Server （168.63.129.16）、169.254.169.254、上記ドキュメント記載のAzure Backup、Azure Storage、AAD</p><p>(実際の入力値)<br>localhost;168.63.129.16;169.254.169.254;<em>.backup.windowsazure.com;</em>.queue.core.windows.net;<em>.blob.core.windows.net;<br><em>.blob.storage.azure.net;</em>.msftidentity.com;</em>.msidentity.com;account.activedirectory.windowsazure.com;<br>accounts.accesscontrol.windows.net;adminwebservice.microsoftonline.com;api.passwordreset.microsoftonline.com;<br>autologon.microsoftazuread-sso.com;becws.microsoftonline.com;clientconfig.microsoftonline-p.net;<br>companymanager.microsoftonline.com;device.login.microsoftonline.com;graph.microsoft.com;graph.windows.net;<br>login.microsoft.com;login.microsoftonline.com;login.microsoftonline-p.com;login.windows.net;<br>logincert.microsoftonline.com;loginex.microsoftonline.com;login-us.microsoftonline.com;nexus.microsoftonline-p.com;<br>passwordreset.microsoftonline.com;provisioningapi.microsoftonline.com;20.190.128.<em>;40.126.</em>;<em>.hip.live.com;<br><em>.microsoftonline.com;</em>.microsoftonline-p.com;</em>.msauth.net;<em>.msauthimages.net;</em>.msecnd.net;*.msftauth.net;<br><em>.msftauthimages.net;</em>.phonefactor.net;enterpriseregistration.windows.net;management.azure.com;policykeyservice.dc.ad.msft.net</p><p><img src="https://user-images.githubusercontent.com/96324317/197693971-4fcf367e-2685-4284-b0f4-4e8c0c457e38.png"></p><p>カレントユーザーに対して、Proxy Server のバイパス設定を保存した後に、PowerShell を立ち上げ、以下コマンドを実行します。<br>下記コマンドを実行することで、カレントユーザーに対して行った設定が、「NT Service\AzureWLBackupPluginSvc」アカウントへ引き継がれます。</p><p>（実行コマンド）</p><blockquote><p>$obj = Get-ItemProperty -Path Registry::”HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections”<br>Set-ItemProperty -Path Registry::”HKEY_USERS\S-1-5-80-1631947889-4033244730-3205203906-53534054-4184208151\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections” -Name DefaultConnectionSettings -Value $obj.DefaultConnectionSettings<br>Set-ItemProperty -Path Registry::”HKEY_USERS\S-1-5-80-1631947889-4033244730-3205203906-53534054-4184208151\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections” -Name SavedLegacySettings -Value $obj.SavedLegacySettings<br>$obj = Get-ItemProperty -Path Registry::”HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings”<br>Set-ItemProperty -Path Registry::”HKEY_USERS\S-1-5-80-1631947889-4033244730-3205203906-53534054-4184208151\Software\Microsoft\Windows\CurrentVersion\Internet Settings” -Name ProxyEnable -Value $obj.ProxyEnable<br>Set-ItemProperty -Path Registry::”HKEY_USERS\S-1-5-80-1631947889-4033244730-3205203906-53534054-4184208151\Software\Microsoft\Windows\CurrentVersion\Internet Settings” -Name Proxyserver -Value $obj.Proxyserver<br>Set-ItemProperty -Path Registry::”HKEY_USERS\S-1-5-80-1631947889-4033244730-3205203906-53534054-4184208151\Software\Microsoft\Windows\CurrentVersion\Internet Settings” -Name ProxyOverride -Value $obj.ProxyOverride</p></blockquote><p><img src="https://user-images.githubusercontent.com/96324317/197694217-0ac20679-c842-419b-a6f4-a68bf609eccb.png"></p><p>上記コマンド実行後、カレントユーザーに対する Proxy Server 設定を、元の状態に戻します。<br>念のため、以下スクリプトを実行いただき、Local System アカウントとNT Service\AzureWLBackupPluginSvcアカウントに対して、Proxy Server バイパス設定が正しく設定されているかを確認します。</p><h5 id="１．下記ドキュメント上の「Azure-Backup-接続テスト-スクリプト-AzureBackupConnectivityTestScriptsForWindows-zip-」を対象-Azure-仮想マシン上にダウンロードし、-zip-ファイルを展開します。"><a href="#１．下記ドキュメント上の「Azure-Backup-接続テスト-スクリプト-AzureBackupConnectivityTestScriptsForWindows-zip-」を対象-Azure-仮想マシン上にダウンロードし、-zip-ファイルを展開します。" class="headerlink" title="１．下記ドキュメント上の「Azure Backup 接続テスト スクリプト (AzureBackupConnectivityTestScriptsForWindows.zip) 」を対象 Azure 仮想マシン上にダウンロードし、 zip ファイルを展開します。"></a>１．下記ドキュメント上の「Azure Backup 接続テスト スクリプト (AzureBackupConnectivityTestScriptsForWindows.zip) 」を対象 Azure 仮想マシン上にダウンロードし、 zip ファイルを展開します。</h5><p>・ネットワーク接続を確立する<br>　<a href="https://learn.microsoft.com/ja-jp/azure/backup/backup-sql-server-database-azure-vms#establish-network-connectivity">https://learn.microsoft.com/ja-jp/azure/backup/backup-sql-server-database-azure-vms#establish-network-connectivity</a></p><h5 id="２．展開した-zip-ファイル内の「Start-ConnectivityTests-ps1」を、対象-Azure-仮想マシン上で実行します。"><a href="#２．展開した-zip-ファイル内の「Start-ConnectivityTests-ps1」を、対象-Azure-仮想マシン上で実行します。" class="headerlink" title="２．展開した zip ファイル内の「Start-ConnectivityTests.ps1」を、対象 Azure 仮想マシン上で実行します。"></a>２．展開した zip ファイル内の「Start-ConnectivityTests.ps1」を、対象 Azure 仮想マシン上で実行します。</h5><p>今回は、Azure Backup サービスと Azure Storage サービスに対しては、プライベート エンドポイント経由で通信するため、引数に「-IsPrivateEndpointEnabled」を追加して実行します。<br>（実行コマンド 例）</p><blockquote><p>.\Start-ConnectivityTests.ps1 -IsPrivateEndpointEnabled</p></blockquote><p><img src="https://user-images.githubusercontent.com/96324317/197697047-3663b672-184f-499b-b405-e95770135b27.png"></p><p><img src="https://user-images.githubusercontent.com/96324317/197704009-4d226d75-3057-4439-88ae-b2a42af0f7e5.png"></p><p>「Start-ConnectivityTests.ps1」スクリプトを実行後、ターミナル上に結果が返却されます。</p><h5 id="「Start-ConnectivityTests-ps1」実行結果の期待値"><a href="#「Start-ConnectivityTests-ps1」実行結果の期待値" class="headerlink" title="「Start-ConnectivityTests.ps1」実行結果の期待値"></a>「Start-ConnectivityTests.ps1」実行結果の期待値</h5><p>(1)<br>WinInet settings for NT Authority\System (used by Azure Workload Backup Coordinator service)<br>ProxyEnable: <span style="color: red; ">1</span><br>となっていること。(=プロキシ設定 ON を表す)</p><p>(2)<br>WinInet settings for NT Authority\System (used by Azure Workload Backup Coordinator service)<br>「ProxyOverride:」以降が、設定した例外リスト/バイパスリストの内容となっていること</p><p>(3)<br>WinInet settings for NT Service\AzureWLBackupPluginSvc (used by Azure Workload Backup Plugin service)<br>ProxyEnable: <span style="color: red; ">1</span><br>となっていること。(=プロキシ設定 ON を表す)</p><p>(4)<br>WinInet settings for NT Service\AzureWLBackupPluginSv (used by Azure Workload Backup Plugin service)<br>「ProxyOverride:」以降が、設定した例外リスト/バイパスリストの内容となっていること<br><img src="https://user-images.githubusercontent.com/96324317/197704402-d3ac2ec2-6778-4bfa-bf48-356c975f8d4a.png"></p><h2 id="5．SQL-Server-DB-に対する-Azure-Backup「今すぐバックアップ」を実行"><a href="#5．SQL-Server-DB-に対する-Azure-Backup「今すぐバックアップ」を実行" class="headerlink" title=" 5．SQL Server DB に対する Azure Backup「今すぐバックアップ」を実行"></a><a id="5"></a> 5．SQL Server DB に対する Azure Backup「今すぐバックアップ」を実行</h2><p>Azure ポータル画面上で設定した、バックアップ ポリシーに従った次回の スケジュールバックアップが成功することを確認いただく、もしくは「今すぐバックアップ」を実行してオンデマンド バックアップが成功することをご確認ください。</p><p>・オンデマンド バックアップを実行する<br>　<a href="https://docs.microsoft.com/ja-jp/azure/backup/tutorial-sql-backup#run-an-on-demand-backup">https://docs.microsoft.com/ja-jp/azure/backup/tutorial-sql-backup#run-an-on-demand-backup</a></p><p>SQL Server DB に対する Azure Backupを、Proxy Serverをパイパスして PE 経由でバックアップする場合の設定方法は以上となります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは、Azure Backup サポートです。&lt;br&gt;今回は、SQL Server DB に対する Azure Backupを、Proxy Serverをパイパスして PE 経由でバックアップする場合の設定方法につい</summary>
      
    
    
    
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
    <category term="Azure SQL Backup" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-SQL-Backup/"/>
    
  </entry>
  
  <entry>
    <title>Azure VM Backup [既存を置換] リストア について</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureVMBackup/restore_swapdsik/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureVMBackup/restore_swapdsik/</id>
    <published>2022-09-26T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.391Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは。Azure Backup サポートの山本です。<br>今回は、Azure VM Backup で　[既存を置換] を用いる場合にいただくご質問について下記の通りご案内いたします。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. [既存を置換]の際、元のディスクはどうなるのか</a><br><a href="#2">2. [既存を置換]の際、 バックアップが走る件について</a><br><a href="#2-1">2.1. バックアップを走らせたくない場合の代替案 </a></p><hr><h2 id="1-既存を置換-の際、元のディスクはどうなるのか"><a href="#1-既存を置換-の際、元のディスクはどうなるのか" class="headerlink" title=" 1. [既存を置換]の際、元のディスクはどうなるのか"></a><a id="1"></a> 1. [既存を置換]の際、元のディスクはどうなるのか</h2><p>結論から申し上げますと削除されずに残ります。<br>Azure VM Backup のリストアの [既存を置換] はバックアップ データよりディスクを復元し、 Azure VM のディスクを置き換えるまでを行います。<br>そのため、元の古いディスクは削除されずにディスク リソースとして残り続けます (課金も行われます)。そのため、不要な場合は手動で削除いただく必要がございます。</p><p>なお、リストアによって復元されるディスクの命名規則に関しては下記をご覧ください。<br>・Azure VM Backupでリストアされるディスク名に関して<br><a href="https://jpabrs-scem.github.io/blog/AzureVMBackup/About_Restored_Disk/">https://jpabrs-scem.github.io/blog/AzureVMBackup/About_Restored_Disk/</a></p><p>下記公開情報にも記載されております。<br>・既存のものを置き換える - 復元オプション- Azure portal で Azure VM データを復元する方法<br><a href="https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-arm-restore-vms">https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-arm-restore-vms</a></p><blockquote><p>ディスクの交換操作の後、元のディスクはリソース グループに保持されます。 元のディスクが必要ない場合は、それを手動で削除することを選択できます。</p></blockquote><h2 id="2-既存を置換-の際、-バックアップが走る件について"><a href="#2-既存を置換-の際、-バックアップが走る件について" class="headerlink" title=" 2. [既存を置換]の際、 バックアップが走る件について"></a><a id="2"></a> 2. [既存を置換]の際、 バックアップが走る件について</h2><p>現在の仕様として[既存を置換] のリストアを行う際にディスクを置き換える前の状態のバックアップを取得するために自動でリストアジョブと並行してバックアップ ジョブも実施されます。<br>このバックアップ ジョブを実施させない方法はございません。<br>またそのため、バックアップを無効にしている場合はバックアップ ジョブが失敗するためリストア ジョブも正常に完了しません。</p><p>詳細については下記をご覧ください<br>・Azure VM のリストア (既存を置換) が失敗する<br><a href="https://jpabrs-scem.github.io/blog/AzureVMBackup/VM_Restorefail_invalid_protection/">https://jpabrs-scem.github.io/blog/AzureVMBackup/VM_Restorefail_invalid_protection/</a></p><h2 id="2-1-バックアップを走らせたくない場合の代替案"><a href="#2-1-バックアップを走らせたくない場合の代替案" class="headerlink" title=" 2.1. バックアップを走らせたくない場合の代替案"></a><a id="2-1"></a> 2.1. バックアップを走らせたくない場合の代替案</h2><p>なお、上記の自動で走るバックアップ ジョブを走らせたくない場合は [既存を置換] ではなく、[ディスクの復元] を実施いただき、復元したディスクを手動で Azure VM に対してスワップしていただくことが可能です。</p><p>Azure Portal ＞ 対象の仮想マシン ＞ 左ペインのディスク からディスクのスワップ、デタッチ＆アタッチ が可能です。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは。Azure Backup サポートの山本です。&lt;br&gt;今回は、Azure VM Backup で　[既存を置換] を用いる場合にいただくご質問について下記の通りご案内いたします。&lt;/p&gt;
&lt;h2 id=&quot;目次&quot;</summary>
      
    
    
    
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
    <category term="Azure VM Backup" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-VM-Backup/"/>
    
  </entry>
  
  <entry>
    <title>Azure Migrate で PE プロジェクトに ova からデプロイしたアプライアンスを登録する手順</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureMigrate/RegisterApplianceFromOVA/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureMigrate/RegisterApplianceFromOVA/</id>
    <published>2022-08-11T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.327Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>こんにちは! ABRS チームの 朴 です。<br>今回は VMware VM を Azure に移行する (エージェントレス型方式) 際、既にパブリック エンドポイントを利用する Azure Migrate プロジェクトに登録されている<br>Azure Migrate アプライアンスをプライベート エンドポイント接続を利用する他の Azure Migrate プロジェクトに再登録する方法についてご説明させていただきます。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. 接続方法ごとの Azure Migrate アプライアンスのデプロイ方法について</a><br>   <a href="#1-1">  1.1 パブリック エンドポイントを使用する Azure Migrate を使用する時 (V2A エージェントレス型方式) の Azure Migrate アプライアンスのデプロイ方法</a><br>   <a href="#1-2">  1.2 プライベート エンドポイントを使用する Azure Migrate を使用する時 (V2A エージェントレス型方式) の Azure Migrate アプライアンスのデプロイ方法</a><br><a href="#2">2. OVA ファイルから Azure Migrate アプライアンスをデプロイした後、プライベート エンドポイント接続を利用する他の Azure Migrate プロジェクトに再登録する手順</a></p><hr><h2 id="1-接続方法ごとの-Azure-Migrate-アプライアンスのデプロイ方法について"><a href="#1-接続方法ごとの-Azure-Migrate-アプライアンスのデプロイ方法について" class="headerlink" title=" 1. 接続方法ごとの Azure Migrate アプライアンスのデプロイ方法について"></a><a id="1"></a> 1. 接続方法ごとの Azure Migrate アプライアンスのデプロイ方法について</h2><h3 id="1-1-パブリック-エンドポイントを使用する-Azure-Migrate-を使用する時-V2A-エージェントレス型方式-の-Azure-Migrate-アプライアンスのデプロイ方法"><a href="#1-1-パブリック-エンドポイントを使用する-Azure-Migrate-を使用する時-V2A-エージェントレス型方式-の-Azure-Migrate-アプライアンスのデプロイ方法" class="headerlink" title=" 1-1 パブリック エンドポイントを使用する Azure Migrate を使用する時 (V2A エージェントレス型方式) の Azure Migrate アプライアンスのデプロイ方法"></a><a id="1-1"></a> 1-1 パブリック エンドポイントを使用する Azure Migrate を使用する時 (V2A エージェントレス型方式) の Azure Migrate アプライアンスのデプロイ方法</h3><p> パブリック エンドポイントを使用する Azure Migrate を使用する時 (V2A エージェントレス型方式) :<br> この場合は、Azure Portal から OVA ファイル および ZIP ファイルがダウンロードできます。</p><p><img src="https://user-images.githubusercontent.com/71251920/183872769-21b6ce08-c80e-46b1-836b-229f2b7b4c4b.png"></p><h3 id="1-2-プライベート-エンドポイントを使用する-Azure-Migrate-を使用する時-V2A-エージェントレス型方式-の-Azure-Migrate-アプライアンスのデプロイ方法"><a href="#1-2-プライベート-エンドポイントを使用する-Azure-Migrate-を使用する時-V2A-エージェントレス型方式-の-Azure-Migrate-アプライアンスのデプロイ方法" class="headerlink" title="1-2 プライベート エンドポイントを使用する Azure Migrate を使用する時 (V2A エージェントレス型方式) の Azure Migrate アプライアンスのデプロイ方法"></a><a id="1-2"></a>1-2 プライベート エンドポイントを使用する Azure Migrate を使用する時 (V2A エージェントレス型方式) の Azure Migrate アプライアンスのデプロイ方法</h3><p> プライベート エンドポイントを使用する Azure Migrate を使用する時 (V2A エージェントレス型方式) : この際は、Azure Portal から Zip ファイルのみがダウンロードできます。</p><p><img src="https://user-images.githubusercontent.com/71251920/183872774-607827ea-0021-4727-b0bf-3eb4fd74b0ef.png"></p><p>Azure Migrate アプライアンスのデプロイ方法については、公開情報をご参照いただければ幸いです。<br><a href="https://docs.microsoft.com/ja-jp/azure/migrate/migrate-appliance">https://docs.microsoft.com/ja-jp/azure/migrate/migrate-appliance</a></p><p>上記の画面によりますと、ダウンロードするファイル (OVA ファイルと ZIP ファイル) が異なるため、パブリック エンドポイントを使用する Azure Migrate プロジェクトに登録した Azure Migrate アプライアンスは、<br>プライベート エンドポイントを使用する Azure Migrate プロジェクトに再登録できないのではないかと読み取れますが、実際そうではありません。<br><a href="#2">2. の手順</a> にて Azure Migrate アプライアンスを切り替えて登録する方法を紹介します。　</p><h2 id="2-OVA-ファイルから-Azure-Migrate-アプライアンスをデプロイした後、プライベート-エンドポイント接続を利用する他の-Azure-Migrate-プロジェクトに再登録する手順"><a href="#2-OVA-ファイルから-Azure-Migrate-アプライアンスをデプロイした後、プライベート-エンドポイント接続を利用する他の-Azure-Migrate-プロジェクトに再登録する手順" class="headerlink" title=" 2. OVA ファイルから Azure Migrate アプライアンスをデプロイした後、プライベート エンドポイント接続を利用する他の Azure Migrate プロジェクトに再登録する手順"></a><a id="2"></a> 2. OVA ファイルから Azure Migrate アプライアンスをデプロイした後、プライベート エンドポイント接続を利用する他の Azure Migrate プロジェクトに再登録する手順</h2><blockquote><p>(注: <strong>既に Azure Migrate アプライアンスが存在するサーバーで実施する場合、既存の構成がクリーンアップされますのでご注意ください。</strong>)</p></blockquote><h3 id="2-1-Azure-Migrate-Project-を-2-つ作成します。"><a href="#2-1-Azure-Migrate-Project-を-2-つ作成します。" class="headerlink" title=" 2-1. Azure Migrate Project を 2 つ作成します。"></a><a id="2-1"></a> 2-1. Azure Migrate Project を 2 つ作成します。</h3><p>  a. Azure Migrate Project 1 : (プロジェクト名 : PublicEndpoint, V2A エージェントレス、パブリックエンドポイント接続)<br>  b. Azure Migrate Project 2 : (プロジェクト名 : PrivateEP, V2A エージェントレス、プライベートエンドポイント接続)                                </p><p><img src="https://user-images.githubusercontent.com/71251920/183872777-8eed04ff-cb7a-4b48-9467-8d23de5b0192.png"></p><p><img src="https://user-images.githubusercontent.com/71251920/183872782-439979cc-d4b9-4a1f-8b3c-f3d00a28927f.png"></p><h3 id="2-2-Azure-Migrate-Project-1-PublicEndpoint-から-OVA-ファイルをダウンロードし、Azure-Migrate-アプライアンスをデプロイします。"><a href="#2-2-Azure-Migrate-Project-1-PublicEndpoint-から-OVA-ファイルをダウンロードし、Azure-Migrate-アプライアンスをデプロイします。" class="headerlink" title=" 2-2. Azure Migrate Project 1 (PublicEndpoint) から OVA ファイルをダウンロードし、Azure Migrate アプライアンスをデプロイします。"></a><a id="2-2"></a> 2-2. Azure Migrate Project 1 (PublicEndpoint) から OVA ファイルをダウンロードし、Azure Migrate アプライアンスをデプロイします。</h3><p>a. ova ファイルは、Azure Portal もしくは 公開情報からダウンロードいただいても問題ございません。<br>・アプライアンス - Vmware  - Azure Migrate アプライアンス<br><a href="https://docs.microsoft.com/ja-jp/azure/migrate/migrate-appliance#appliance---vmware">https://docs.microsoft.com/ja-jp/azure/migrate/migrate-appliance#appliance---vmware</a>                        </p><p><img src="https://user-images.githubusercontent.com/71251920/183872732-3d2fc9ec-812f-4d86-a2e5-0587ece25875.png"><br><img src="https://user-images.githubusercontent.com/71251920/183872742-e1eb0069-9776-42e9-9dcb-d884ba943019.png"></p><h3 id="2-3-検証環境は、ova-ファイルからデプロイした-Azure-Migrate-アプライアンスを-Azure-Migrate-Project-1-PublicEndpoint-に登録している状態を前提としています。"><a href="#2-3-検証環境は、ova-ファイルからデプロイした-Azure-Migrate-アプライアンスを-Azure-Migrate-Project-1-PublicEndpoint-に登録している状態を前提としています。" class="headerlink" title=" 2-3. 検証環境は、ova ファイルからデプロイした Azure Migrate アプライアンスを Azure Migrate Project 1 (PublicEndpoint) に登録している状態を前提としています。"></a><a id="2-3"></a> 2-3. 検証環境は、ova ファイルからデプロイした Azure Migrate アプライアンスを Azure Migrate Project 1 (PublicEndpoint) に登録している状態を前提としています。</h3><p>ova ファイルからデプロイした Azure Migrate アプライアンスを Azure Migrate Project 1 (PublicEndpoint) に登録する手順は、割愛させていただきます。                </p><h3 id="2-4-アプライアンスをホストするサーバー上のフォルダーに-インストーラー-スクリプトを含んだ-ZIP-ファイル-AzureMigrateInstaller-zip-を抽出します。"><a href="#2-4-アプライアンスをホストするサーバー上のフォルダーに-インストーラー-スクリプトを含んだ-ZIP-ファイル-AzureMigrateInstaller-zip-を抽出します。" class="headerlink" title=" 2-4. アプライアンスをホストするサーバー上のフォルダーに インストーラー スクリプトを含んだ ZIP ファイル (AzureMigrateInstaller.zip) を抽出します。"></a><a id="2-4"></a> 2-4. アプライアンスをホストするサーバー上のフォルダーに インストーラー スクリプトを含んだ ZIP ファイル (AzureMigrateInstaller.zip) を抽出します。</h3><p>a. インストーラー スクリプトを含んだ ZIP ファイル (AzureMigrateInstaller.zip) 、Azure Portal もしくは公開情報からダウンロードいただいても問題ございません。<br>・スクリプトを使用してアプライアンスを設定する<br><a href="https://docs.microsoft.com/ja-jp/azure/migrate/deploy-appliance-script?msclkid=1eb571a2a5ca11eca56137c5033e85e4">https://docs.microsoft.com/ja-jp/azure/migrate/deploy-appliance-script?msclkid=1eb571a2a5ca11eca56137c5033e85e4</a></p><p><img src="https://user-images.githubusercontent.com/71251920/183872748-7feab4d1-4067-48de-9a70-16a336a8fa3d.png"></p><h3 id="2-5-PowerShell-スクリプトファイルを実行するため、下記のコマンドを実行します。"><a href="#2-5-PowerShell-スクリプトファイルを実行するため、下記のコマンドを実行します。" class="headerlink" title=" 2-5. PowerShell スクリプトファイルを実行するため、下記のコマンドを実行します。"></a><a id="2-5"></a> 2-5. PowerShell スクリプトファイルを実行するため、下記のコマンドを実行します。</h3><pre><code> # Set-Executionpolicy Allsigned</code></pre><p><img src="https://user-images.githubusercontent.com/71251920/183872749-267f9bc4-15fb-45aa-aca0-03405074d0a9.png"></p><h3 id="2-6-PowerShell-ディレクトリを、ダウンロードした-ZIP-ファイルの内容が抽出されたフォルダーに変更し、下記のコマンドを実行します。"><a href="#2-6-PowerShell-ディレクトリを、ダウンロードした-ZIP-ファイルの内容が抽出されたフォルダーに変更し、下記のコマンドを実行します。" class="headerlink" title=" 2-6. PowerShell ディレクトリを、ダウンロードした ZIP ファイルの内容が抽出されたフォルダーに変更し、下記のコマンドを実行します。"></a><a id="2-6"></a> 2-6. PowerShell ディレクトリを、ダウンロードした ZIP ファイルの内容が抽出されたフォルダーに変更し、下記のコマンドを実行します。</h3><pre><code># PS C:\Users\administrator\Desktop\AzureMigrateInstaller&gt; .\AzureMigrateInstaller.ps1    </code></pre><p> a. 下記の公開情報の技術の通り、Azure Migrate アプライアンスがすでに設定されているサーバーでスクリプト実行する場合、既存の構成がクリーンアップし、必要な構成の新しいアプライアンスが設定される仕組みとなっています。</p><p><img src="https://user-images.githubusercontent.com/71251920/183872751-ddc0bf98-e560-4dfc-b745-67a3076a9f12.png"></p><p><img src="https://user-images.githubusercontent.com/71251920/183872756-d446ea96-38e5-4fec-abbe-ee2acb833e76.png"></p><h3 id="2-7-ova-ファイルをデプロイした時と同様に、ApplianceConfigurationManager-が自動に起動されます。"><a href="#2-7-ova-ファイルをデプロイした時と同様に、ApplianceConfigurationManager-が自動に起動されます。" class="headerlink" title=" 2-7. ova ファイルをデプロイした時と同様に、ApplianceConfigurationManager が自動に起動されます。"></a><a id="2-7"></a> 2-7. ova ファイルをデプロイした時と同様に、ApplianceConfigurationManager が自動に起動されます。</h3><p><img src="https://user-images.githubusercontent.com/71251920/183872760-e94e88e6-7f75-4db3-808b-545a0459194f.png"></p><h3 id="2-8-ApplianceConfigurationManager-が起動されたら、お客様の環境に合わせて-Azure-Migrate-アプライアンスを-Azure-Migrate-Project-2-PrivateEndpoint-に登録して頂ければと思います。"><a href="#2-8-ApplianceConfigurationManager-が起動されたら、お客様の環境に合わせて-Azure-Migrate-アプライアンスを-Azure-Migrate-Project-2-PrivateEndpoint-に登録して頂ければと思います。" class="headerlink" title=" 2-8. ApplianceConfigurationManager が起動されたら、お客様の環境に合わせて Azure Migrate アプライアンスを Azure Migrate Project 2 (PrivateEndpoint) に登録して頂ければと思います。"></a><a id="2-8"></a> 2-8. ApplianceConfigurationManager が起動されたら、お客様の環境に合わせて Azure Migrate アプライアンスを Azure Migrate Project 2 (PrivateEndpoint) に登録して頂ければと思います。</h3><p>a. Azure Migrate アプライアンスは、インターネットに接続する必要がありますので Azure Migrate アプライアンスのサーバーに Proxy が設定されている場合は、<br>下記の設定を改めてご確認頂ければと思います。</p><p><img src="https://user-images.githubusercontent.com/71251920/183872762-5fd9e062-2f81-4938-b83c-da04eec2fd72.png"></p><p>b. ソース環境からプライベート エンドポイントのプライベート IP アドレスを解決するために、追加の DNS 設定が必要になる場合があります。<br>プライベート IP アドレスが使用できるよう、Azure Migrate プロジェクトの評価ツールのプロパティーから DNS 設定をダウンロードして頂き、<br>ダウンロードした DNS 設定をオンプレミスの DNS サーバーもしくはアプライアンスの Hosts ファイルへ設定し、プライベート エンドポイントの FQDN の名前解決できるように設定する必要があります。</p><p><img src="https://user-images.githubusercontent.com/71251920/183872766-4e725e3d-2d74-4de0-975b-0e3d6a089ce8.png"></p><p>c. VM Ware から Azure へ移行する際、エージェント レスやエージェント ベースの方式に関係なく、vCenter Server のアクセス許可が必要となります。</p><p>d. プライベート エンドポイントを使用した Azure Migrate の設定手順は下記の公開情報をご参照ください。<br>・サポート要件と考慮事項 - プライベート エンドポイントで Azure Migrate を使用する<br><a href="https://docs.microsoft.com/ja-jp/azure/migrate/how-to-use-azure-migrate-with-private-endpoints">https://docs.microsoft.com/ja-jp/azure/migrate/how-to-use-azure-migrate-with-private-endpoints</a><br>・パブリック エンドポイント接続を使用して Azure Migrate プロジェクトのデータを ExpressRoute 経由でレプリケートする<br><a href="https://docs.microsoft.com/ja-jp/azure/migrate/replicate-using-expressroute">https://docs.microsoft.com/ja-jp/azure/migrate/replicate-using-expressroute</a><br>・ネットワーク接続に関する問題のトラブルシューティング - Azure Migrate<br><a href="https://docs.microsoft.com/ja-jp/azure/migrate/troubleshoot-network-connectivity#possible-causes-1">https://docs.microsoft.com/ja-jp/azure/migrate/troubleshoot-network-connectivity#possible-causes-1</a></p><h3 id="2-9-下記の画面になると、登録完了を意味します。"><a href="#2-9-下記の画面になると、登録完了を意味します。" class="headerlink" title=" 2-9. 下記の画面になると、登録完了を意味します。"></a><a id="2-9"></a> 2-9. 下記の画面になると、登録完了を意味します。</h3><p><img src="https://user-images.githubusercontent.com/71251920/183872768-06315655-ce47-432d-b3e7-9aa08fe683bf.png"></p><p>本記事の内容は以上となります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;こんにちは! ABRS チームの 朴 です。&lt;br&gt;今回は VMware VM を Azure に移行する (エージェントレス型方式) 際、既にパブリック エンドポイントを利用する Azure Migrate プロジェクトに登</summary>
      
    
    
    
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
    <category term="Azure Migrate" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-Migrate/"/>
    
  </entry>
  
  <entry>
    <title>MARS エージェントの再インストール手順</title>
    <link href="https://jpabrs-scem.github.io/blog/MARSBackup/How_to_re-install/"/>
    <id>https://jpabrs-scem.github.io/blog/MARSBackup/How_to_re-install/</id>
    <published>2022-08-11T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.391Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは、Azure Backup サポートの 山本 です。<br>今回は MARS エージェントの再インストール手順をお伝えさせていただきます。</p><p>なお、なんらかの不具合が発生している場合の MARS エージェントの再インストールは <strong>上書きインストールではなく、必ず 一度アンインストールした上</strong>で実施いただくようお願いいたします。<br>例えば、ネットワーク構成などを変えていないのに、MARS コンソールが立ち上がらなくなった (正常に動作しなくなった) 場合やバックアップ が失敗するようになった等の場合は再インストールが有効な対処策であることが多くございます。</p><p>特に証明書関連のエラーの場合再インストールの前後で証明書に変化があったかご確認いただけますと幸いです。<br>その際は下記記事を参考にして作業前後で証明書をご確認ください。<br> ・4.4 各種証明書の確認証跡 - 4. MARS Backup エージェントを利用したバックアップ の障害調査に必要なログ<br><a href="https://jpabrs-scem.github.io/blog/AzureBackupGeneral/RequestForInvestigating/#4-4">https://jpabrs-scem.github.io/blog/AzureBackupGeneral/RequestForInvestigating/#4-4</a></p><blockquote><p>【注意】MARS エージェントの再インストール後も以前のスケジュールバックアップ設定や復元ポイントを利用可能ですが、その際には以前 MARS エージェントのサーバー登録時に利用したパスフレーズが必要となりますので、再インストール時は <strong>パスフレーズがお手元にあることを確認の上</strong>、作業を実行してください。</p></blockquote><hr><p><a href="#1">1. MARS エージェントのアンインストール</a><br><a href="#2">2. MARS エージェントの(再)インストール</a><br><a href="#3">3. サーバーの登録</a><br><a href="#4">4. 関連公開情報</a></p><hr><h2 id="1-MARS-エージェントのアンインストール"><a href="#1-MARS-エージェントのアンインストール" class="headerlink" title=" 1.MARS エージェントのアンインストール"></a><a id="1"></a> 1.MARS エージェントのアンインストール</h2><h3 id="1-1-MARSバックアップ対象のマシンにログインします"><a href="#1-1-MARSバックアップ対象のマシンにログインします" class="headerlink" title=" 1-1. MARSバックアップ対象のマシンにログインします"></a><a id="1-1"></a> 1-1. MARSバックアップ対象のマシンにログインします</h3><p> 下記のフォルダーをコピーして任意の別の場所に退避しておきます。<br> 正常に再インストールが完了した際にはこの退避したフォルダは不要です。</p><blockquote><p>（対象パス）C:\Program Files<br>（コピーする対象のフォルダー）Microsoft Azure Recovery Services Agent</p></blockquote><h3 id="1-2-windows-ボタン-r-を押し、”appwiz-cpl”-と入力し、「OK」＞「プログラムのアンインストールまたは変更」画面を開きます"><a href="#1-2-windows-ボタン-r-を押し、”appwiz-cpl”-と入力し、「OK」＞「プログラムのアンインストールまたは変更」画面を開きます" class="headerlink" title=" 1-2. windows ボタン + r を押し、”appwiz.cpl” と入力し、「OK」＞「プログラムのアンインストールまたは変更」画面を開きます"></a><a id="1-2"></a> 1-2. windows ボタン + r を押し、”appwiz.cpl” と入力し、「OK」＞「プログラムのアンインストールまたは変更」画面を開きます</h3><p><img src="https://user-images.githubusercontent.com/71251920/183884809-a24326c5-9e6c-4650-98df-f354c90bb8e6.gif"></p><h3 id="1-3-「Microsoft-Azure-Recovery-Services-Agent」を右クリックし、「アンインストールと変更」をクリックします"><a href="#1-3-「Microsoft-Azure-Recovery-Services-Agent」を右クリックし、「アンインストールと変更」をクリックします" class="headerlink" title=" 1-3.「Microsoft Azure Recovery Services Agent」を右クリックし、「アンインストールと変更」をクリックします"></a><a id="1-3"></a> 1-3.「Microsoft Azure Recovery Services Agent」を右クリックし、「アンインストールと変更」をクリックします</h3><p><img src="https://user-images.githubusercontent.com/71251920/183884818-da800c52-0679-4bcd-9c28-ccce17395789.gif"></p><h3 id="1-4-MARSアプリケーション-のアンインストール-ウィザードが開くため、「アンインストール」をクリックします"><a href="#1-4-MARSアプリケーション-のアンインストール-ウィザードが開くため、「アンインストール」をクリックします" class="headerlink" title=" 1-4. MARSアプリケーション のアンインストール ウィザードが開くため、「アンインストール」をクリックします"></a><a id="1-4"></a> 1-4. MARSアプリケーション のアンインストール ウィザードが開くため、「アンインストール」をクリックします</h3><p><img src="https://user-images.githubusercontent.com/71251920/183884819-28da14c8-ab0b-40c3-834a-904022cc5b29.gif"></p><h3 id="1-5-アンインストールされたことを確認してください。"><a href="#1-5-アンインストールされたことを確認してください。" class="headerlink" title=" 1-5. アンインストールされたことを確認してください。"></a><a id="1-5"></a> 1-5. アンインストールされたことを確認してください。</h3><p><img src="https://user-images.githubusercontent.com/71251920/183884823-5425bdb1-c90c-462e-b0a3-00d6c4501677.gif"></p><h2 id="2-MARS-エージェントの-再-インストール"><a href="#2-MARS-エージェントの-再-インストール" class="headerlink" title=" 2. MARS エージェントの(再)インストール"></a><a id="2"></a> 2. MARS エージェントの(再)インストール</h2><h3 id="2-1-Azure-Portal-gt-該当のRecovery-Services-コンテナー-gt-設定-–-バックアップ-より以下を選択し、”インフラストラクチャの準備”-をクリックしてください。"><a href="#2-1-Azure-Portal-gt-該当のRecovery-Services-コンテナー-gt-設定-–-バックアップ-より以下を選択し、”インフラストラクチャの準備”-をクリックしてください。" class="headerlink" title=" 2-1. Azure Portal &gt; 該当のRecovery Services コンテナー &gt; 設定 – バックアップ より以下を選択し、”インフラストラクチャの準備” をクリックしてください。"></a><a id="2-1"></a> 2-1. Azure Portal &gt; 該当のRecovery Services コンテナー &gt; 設定 – バックアップ より以下を選択し、”インフラストラクチャの準備” をクリックしてください。</h3><blockquote><p>ワークロードはどこで実行されていますか？：オンプレミス<br>何をバックアップしますか？：ファイルとフォルダー</p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/183884826-21eb4c46-5e1e-411f-897b-40d044239f08.png"></p><h3 id="2-2-“Windows-Server-または-Windows-クライアント用エージェントのダウンロード”-をクリックしてください。"><a href="#2-2-“Windows-Server-または-Windows-クライアント用エージェントのダウンロード”-をクリックしてください。" class="headerlink" title=" 2-2. “Windows Server または Windows クライアント用エージェントのダウンロード” をクリックしてください。"></a><a id="2-2"></a> 2-2. “Windows Server または Windows クライアント用エージェントのダウンロード” をクリックしてください。</h3><p>  *最新版のMARS エージェントインストーラーがダウンロードされます。</p><p><img src="https://user-images.githubusercontent.com/71251920/183884831-69713e5d-6082-447b-8538-5a19a93f2b8c.png"></p><h3 id="2-3-ダウンロードしたインストーラーを該当のサーバーにて実行してください。"><a href="#2-3-ダウンロードしたインストーラーを該当のサーバーにて実行してください。" class="headerlink" title=" 2-3. ダウンロードしたインストーラーを該当のサーバーにて実行してください。"></a><a id="2-3"></a> 2-3. ダウンロードしたインストーラーを該当のサーバーにて実行してください。</h3><p><img src="https://user-images.githubusercontent.com/71251920/183884834-9ed43c8f-220e-4d78-97f0-cb35513ffa7b.png"></p><h3 id="2-4-セットアップ-ウィザードが開きますので、ウィザードの案内に従い、MARS-エージェントをインストールしてください。"><a href="#2-4-セットアップ-ウィザードが開きますので、ウィザードの案内に従い、MARS-エージェントをインストールしてください。" class="headerlink" title=" 2-4. セットアップ ウィザードが開きますので、ウィザードの案内に従い、MARS エージェントをインストールしてください。"></a><a id="2-4"></a> 2-4. セットアップ ウィザードが開きますので、ウィザードの案内に従い、MARS エージェントをインストールしてください。</h3><p><img src="https://user-images.githubusercontent.com/71251920/183884835-58440b1a-3878-417c-8d96-9549f16569ed.png"></p><h3 id="2-5-インストール完了後、”登録処理を続行”-をクリックしてください。"><a href="#2-5-インストール完了後、”登録処理を続行”-をクリックしてください。" class="headerlink" title=" 2-5. インストール完了後、”登録処理を続行” をクリックしてください。"></a><a id="2-5"></a> 2-5. インストール完了後、”登録処理を続行” をクリックしてください。</h3><p><img src="https://user-images.githubusercontent.com/71251920/183884838-494e0293-35f4-4a8d-b3e8-00397d7fcb07.png"></p><h3 id="2-6-サーバーの登録ウィザードが開きますので、次の手順に進んでください。"><a href="#2-6-サーバーの登録ウィザードが開きますので、次の手順に進んでください。" class="headerlink" title=" 2-6. サーバーの登録ウィザードが開きますので、次の手順に進んでください。"></a><a id="2-6"></a> 2-6. サーバーの登録ウィザードが開きますので、次の手順に進んでください。</h3><p><img src="https://user-images.githubusercontent.com/71251920/183884839-22e5fb59-1277-489d-8562-d8a44f44806b.png"></p><h2 id="3-サーバーの登録"><a href="#3-サーバーの登録" class="headerlink" title=" 3. サーバーの登録"></a><a id="3"></a> 3. サーバーの登録</h2><h3 id="3-1-手順-2-2-の画面にて-”最新のRecovery-Services-Agent-を既にダウンロードしたか、使用している”-にチェックし、ダウンロードをクリックしてください。"><a href="#3-1-手順-2-2-の画面にて-”最新のRecovery-Services-Agent-を既にダウンロードしたか、使用している”-にチェックし、ダウンロードをクリックしてください。" class="headerlink" title=" 3-1. 手順 2-2 の画面にて ”最新のRecovery Services Agent を既にダウンロードしたか、使用している” にチェックし、ダウンロードをクリックしてください。"></a><a id="3-1"></a> 3-1. 手順 2-2 の画面にて ”最新のRecovery Services Agent を既にダウンロードしたか、使用している” にチェックし、ダウンロードをクリックしてください。</h3><p>*Recovery Services コンテナーの資格情報がダウンロードされます。</p><p><img src="https://user-images.githubusercontent.com/71251920/183884840-b8b63d4d-a62c-46fc-8540-f1b6d74175ad.png"></p><h3 id="3-2-ダウンロードした資格情報を該当のサーバーに配置してください。"><a href="#3-2-ダウンロードした資格情報を該当のサーバーに配置してください。" class="headerlink" title="3-2. ダウンロードした資格情報を該当のサーバーに配置してください。"></a><a id="3-2"></a>3-2. ダウンロードした資格情報を該当のサーバーに配置してください。</h3><p><img src="https://user-images.githubusercontent.com/71251920/183884842-e0613cd2-97fa-4fc9-85fe-02c9077d400e.png"></p><h3 id="3-3-手順2-6の画面にて手順3-2でダウンロードした資格情報を選択し、”次へ”-をクリックしてください。"><a href="#3-3-手順2-6の画面にて手順3-2でダウンロードした資格情報を選択し、”次へ”-をクリックしてください。" class="headerlink" title="3-3. 手順2-6の画面にて手順3-2でダウンロードした資格情報を選択し、”次へ” をクリックしてください。"></a><a id="3-3"></a>3-3. 手順2-6の画面にて手順3-2でダウンロードした資格情報を選択し、”次へ” をクリックしてください。</h3><p><img src="https://user-images.githubusercontent.com/71251920/183884843-f63375af-7ca7-48d7-a69b-3f63078a5882.png"></p><h3 id="3-4-以前登録したパスフレーズを入力し、パスフレーズを保存する任意の場所を選択して、”登録”-をクリックして登録を完了してください。"><a href="#3-4-以前登録したパスフレーズを入力し、パスフレーズを保存する任意の場所を選択して、”登録”-をクリックして登録を完了してください。" class="headerlink" title="3-4. 以前登録したパスフレーズを入力し、パスフレーズを保存する任意の場所を選択して、”登録” をクリックして登録を完了してください。"></a><a id="3-4"></a>3-4. 以前登録したパスフレーズを入力し、パスフレーズを保存する任意の場所を選択して、”登録” をクリックして登録を完了してください。</h3><p><img src="https://user-images.githubusercontent.com/71251920/183884846-073e873b-b194-4efa-9ab0-7cbbcd6a33a9.png"></p><h2 id="4-関連公開情報"><a href="#4-関連公開情報" class="headerlink" title="4. 関連公開情報"></a><a id="4"></a>4. 関連公開情報</h2><p>・MARS エージェントのダウンロード<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/install-mars-agent#download-the-mars-agent">https://docs.microsoft.com/ja-jp/azure/backup/install-mars-agent#download-the-mars-agent</a></p><p>・サーバーにインストールされている MARS エージェントの更新<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/upgrade-mars-agent#update-the-mars-agent-installation-on-the-server">https://docs.microsoft.com/ja-jp/azure/backup/upgrade-mars-agent#update-the-mars-agent-installation-on-the-server</a></p><p>・パスフレーズを忘れた場合、復旧できますか?<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-file-folder-backup-faq#%E5%BE%A9%E5%85%83">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-file-folder-backup-faq#%E5%BE%A9%E5%85%83</a></p><p>本記事の内容は以上となります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは、Azure Backup サポートの 山本 です。&lt;br&gt;今回は MARS エージェントの再インストール手順をお伝えさせていただきます。&lt;/p&gt;
&lt;p&gt;なお、なんらかの不具合が発生している場合の MARS エー</summary>
      
    
    
    
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
    <category term="MARS Backup" scheme="https://jpabrs-scem.github.io/blog/tags/MARS-Backup/"/>
    
  </entry>
  
  <entry>
    <title>Azure VM Backup と Azure Site Recovery による DR 要件について</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureBackupGeneral/DR_ASR_or_VMBackup/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureBackupGeneral/DR_ASR_or_VMBackup/</id>
    <published>2022-08-08T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.307Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>こんにちは。Azure VM 、Azure Site Recovery 担当です。<br>今回は Azure のリージョン障害などを想定した Azure VM の Disaster Recovery (DR) 対策を検討中のお客様よりお問合せをいただきます「Azure VM Backup と Azure Site Recovery どちらを利用すればいいのか？」について解説させていただきます。</p><p>結論としては、お客様の DR 要件である RTO, RPO をクリアにしていただく必要があり、ここがクリアになれば Azure VM Backup と Azure Site Recovery どちらを選択すればいいか判断できるようになると存じます。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. DR, RTO, RPO について</a><br>   <a href="#1-1">  1.1 Disaster Recovery (DR)</a><br>   <a href="#1-2">  1.2 Recovery Time Objective (RTO)</a><br>   <a href="#1-3">  1.3 Recovery Point Objective (RPO)</a><br><a href="#2">2. Azure VM Backup と Azure Site Recovery の比較</a><br><a href="#2">3. 参考情報 : DR 大作のための Azure VM のディスクの冗長構成は非推奨</a></p><hr><h2 id="1-DR-RTO-RPO-について"><a href="#1-DR-RTO-RPO-について" class="headerlink" title=" 1. DR, RTO, RPO について"></a><a id="1"></a> 1. DR, RTO, RPO について</h2><p>まずは前提知識について DR, RTO, RPO について簡単に説明いたします。</p><h3 id="Disaster-Recovery-DR"><a href="#Disaster-Recovery-DR" class="headerlink" title=" Disaster Recovery (DR)"></a><a id="1-1"></a> Disaster Recovery (DR)</h3><p>大規模災害などの影響によりシステムやデータセンターが障害を受けた際に、利用できなくなったシステムを素早く復旧するための計画やそのような状態を未然に防ぐことを指します。<br>事業者様によって整備されている、BCP (事業継続計画) をご確認いただくことで後の RTO, RPO の指標が明確になるかと存じます。</p><h3 id="Recovery-Time-Objective-RTO"><a href="#Recovery-Time-Objective-RTO" class="headerlink" title=" Recovery Time Objective (RTO)"></a><a id="1-2"></a> Recovery Time Objective (RTO)</h3><p>「目標復旧時間」のことで、大規模災害などの影響によりシステムやデータセンターが障害を受けシステムが停止した時に、その時点から復旧までにかかる時間のことを指します。どのくらいの時間がダウンタイムとして許容できるかをご確認いただくのが良いかと存じます。</p><ul><li>ダウンタイムの許容時間は最大 24 時間。など</li></ul><h3 id="Recovery-Point-Objective-RPO"><a href="#Recovery-Point-Objective-RPO" class="headerlink" title=" Recovery Point Objective (RPO)"></a><a id="1-3"></a> Recovery Point Objective (RPO)</h3><p>「目標復旧時点」のことで、大規模災害などの影響によりシステムやデータセンターが障害を受けシステムが停止した時に、過去のどの時点のデータまでを復旧できるかを指します。障害時点から復旧ポイントまでの間の時間のデータは復旧できないことになるため、データ復旧ができなくても許容できる時間をご確認いただくのが良いかと存じます。</p><ul><li>データ損失の許容時間は直前 12 時間以内。など</li></ul><h2 id="2-Azure-VM-Backup-と-Azure-Site-Recovery-の比較"><a href="#2-Azure-VM-Backup-と-Azure-Site-Recovery-の比較" class="headerlink" title=" 2. Azure VM Backup と Azure Site Recovery の比較"></a><a id="2"></a> 2. Azure VM Backup と Azure Site Recovery の比較</h2><p>以下は Azure VM Backup と Azure Site Recovery の比較表です。<br>2 時間以上のダウンタイム (RTO) が許容されない場合や、24 時間以上のデータ損失が許容されない場合など Azure VM Backup で対応できない場合には Azure Site Recovery の採用をご検討いただければと存じます。</p><table><thead><tr><th align="left">#</th><th align="left">Azure VM Backup</th><th align="left">Azure Site Recovery</th></tr></thead><tbody><tr><td align="left">機能</td><td align="left">Azure VM のバックアップを取得します。<br>Recovery Services コンテナーを GRS (または RA-GRS) にすることで、ペア リージョンへのバックアップ データのレプリケーションが行われペア リージョンでの復元ができるようになります。<br>[ご参考] ・ Azure VM Backup における CRR (クロスリージョン リストア) について<br><a href="https://jpabrs-scem.github.io/blog/AzureVMBackup/CRR/">https://jpabrs-scem.github.io/blog/AzureVMBackup/CRR/</a></td><td align="left">Azure VM のデータをターゲット リージョンのディスクへレプリケーションします。</td></tr><tr><td align="left">復旧ポイントの保持期間</td><td align="left">最大 99 年保持することができます。</td><td align="left">Unmanaged Disk では最大 72 時間 (3 日) 保持することができます。<br>Managed Disk では最大 15 日保持することができます。</td></tr><tr><td align="left">RTO に関する SLA</td><td align="left">RTO について SLA はありません。</td><td align="left">SLA で 2 時間以内の RTO を保証します。<br> [ご参考] ・Azure Site Recovery の SLA<br><a href="https://azure.microsoft.com/ja-jp/support/legal/sla/site-recovery/v1_2/">https://azure.microsoft.com/ja-jp/support/legal/sla/site-recovery/v1_2/</a><br>&gt;オンプレミスと Azure 間の計画上および計画外のフェールオーバー用に構成された保護された各インスタンスにつき、マイクロソフトは、2 時間の目標復旧時間を保証します。</td></tr><tr><td align="left">Recovery Time Objective (RTO)</td><td align="left">24時間以内に完了する仕様となっております。<br> <strong>大容量の VM では復元に 24 時間以上かかる場合がございます。</strong><br>[ご参考] ・1.1 Azure VM Backup のバックアップ時間について<br>Azure Backup の バックアップ / リストア 所要時間について　<br><a href="https://jpabrs-scem.github.io/blog/AzureBackupGeneral/Backup_RecoveryTIme/#1-1">https://jpabrs-scem.github.io/blog/AzureBackupGeneral/Backup_RecoveryTIme/#1-1</a></td><td align="left">2 時間以内の RTO を提供します。</td></tr><tr><td align="left">Recovery Point Objective (RPO)</td><td align="left">スタンダードポリシーをご利用の場合、バックアップのスケジュールは 1 日 1 回となります。<br>その場合、最短の復元ポイント時点が 24 時間以上前となる場合がございます。<br>エンハンスド ポリシー(拡張ポリシー)をご利用の場合、バックアップのスケジュールは再頻 4 時間おきのバックアップが可能です。<br> [ご参考] ・拡張ポリシーを使用して Azure VM をバックアップする<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-enhanced-policy">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-enhanced-policy</a></td><td align="left">クラッシュ整合性復旧ポイントは 5 分ごとに取得されます。<br>アプリ整合性復旧ポイントは、レプリケーション ポリシーにて設定でき最短で 1 時間ごとにスケジュールできます。</td></tr></tbody></table><h2 id="3-参考情報-DR-対策のための-Azure-VM-のディスクの冗長構成は非推奨"><a href="#3-参考情報-DR-対策のための-Azure-VM-のディスクの冗長構成は非推奨" class="headerlink" title=" 3. 参考情報 : DR 対策のための Azure VM のディスクの冗長構成は非推奨"></a><a id="3"></a> 3. 参考情報 : DR 対策のための Azure VM のディスクの冗長構成は非推奨</h2><p>Azure VM では、Unmanaged Disk を利用している場合にストレージ アカウントの GRS は非推奨構成です。<br>そのため、Azure VM の DR 要件に関してはディスクの Azure VM Backup または ASR の利用をご検討いただき、ディスク単位での冗長構成については検討対象から外していただいた方が良いかと存じます。 </p><p>・ローカル冗長ストレージ - ローカル冗長ストレージ<br><a href="https://docs.microsoft.com/ja-jp/azure/storage/common/storage-redundancy#locally-redundant-storage">https://docs.microsoft.com/ja-jp/azure/storage/common/storage-redundancy#locally-redundant-storage</a></p><blockquote><p>シナリオで Azure アンマネージド ディスクを使用している場合は、LRS を選択できます。 GRS を使用する Azure アンマネージド ディスクのストレージ アカウントを作成することはできますが、非同期 geo レプリケーションの整合性に関する潜在的な問題のため、お勧めしません。</p></blockquote><p>本記事の内容は以上となります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;こんにちは。Azure VM 、Azure Site Recovery 担当です。&lt;br&gt;今回は Azure のリージョン障害などを想定した Azure VM の Disaster Recovery (DR) 対策を検討中のお</summary>
      
    
    
    
    
    <category term="Azure Backup General" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-Backup-General/"/>
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
  </entry>
  
  <entry>
    <title>Azure Backup の バックアップ / リストア 所要時間について</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureBackupGeneral/Backup_RecoveryTIme/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureBackupGeneral/Backup_RecoveryTIme/</id>
    <published>2022-06-25T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.307Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは。Azure Backup サポートの山本です。<br>今回はお問い合わせをいただくことが多い、Azure Backup におけるバックアップやリストアにかかる時間についてご説明いたします。 Azure VM Backup に限らず、 各 Azure Backup サービスにおける各所要時間を見積もることはかないません。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. 転送データ量とバックアップやリストアにかかる時間</a><br>   <a href="#1-2">  1.2 バックアップ タイムの実績値グラフ</a><br>   <a href="#1-3">  1.3 リストア タイムの実績値グラフ</a><br><a href="#2">2. データディスクの数とバックアップやリストアにかかる時間</a><br>   <a href="#2-1">  2.1 リストア検証</a> </p><hr><h2 id="1-転送データ量とバックアップやリストアにかかる時間"><a href="#1-転送データ量とバックアップやリストアにかかる時間" class="headerlink" title=" 1. 転送データ量とバックアップやリストアにかかる時間"></a><a id="1"></a> 1. 転送データ量とバックアップやリストアにかかる時間</h2><p>よくお客様より、<strong>時間の目安を見積もりたい、100GB だとどれくらいの時間がかかるか？</strong>といったようなお問い合わせをいただくことがございます。</p><p>こちら結論から申し上げますと、<strong>Azure VM Backup におけるバックアップやリストアの時間を見積もることは出来ません。</strong><br>Azure サービスはマルチテナント サービスであるため、 Azure Backup サービスにおける所要時間はバックアップ / リストア対象のバックアップ アイテム (VM) の転送データサイズのみではなく、他のリソース、他のユーザー様の稼働状況、帯域の状況などにも処理時間は左右されるためです。</p><p>よって、同じリソースの条件においても、そのときどきによってリストアやバックアップにかかる時間は変化する場合がございます。<br>そのため、リストアやバックアップにかかる時間については弊社として指標を出しておりません。</p><h3 id="1-1-Azure-VM-Backup-のバックアップ時間について"><a href="#1-1-Azure-VM-Backup-のバックアップ時間について" class="headerlink" title=" 1.1 Azure VM Backup のバックアップ時間について"></a><a id="1-1"></a> 1.1 Azure VM Backup のバックアップ時間について</h3><p>特に、Azure VM Backup のバックアップ時間に関しましては、増分データが 200GB 以下である場合、24時間 以内に完了する仕様となっており、24 時間以内の完了であれば仕様の範疇でございます。</p><p>・バックアップ パフォーマンス<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-introduction#backup-performance">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-introduction#backup-performance</a></p><p>・バックアップ プロセス<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-introduction#backup-process">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-introduction#backup-process</a></p><blockquote><p>抜粋：”スナップショット データはコンテナーにすぐにコピーされない場合があります。 ピーク時には、数時間かかる場合があります。 毎日のバックアップ ポリシーでは、<strong>VM のバックアップの合計時間は 24 時間未満になります。</strong>“</p></blockquote><p>また、Azure VM Backupでは Take Snapshot と Transfer data to vault の2 つのフェーズがありますが、Take Snapshot にかかった時間を確認する方法については下記をご覧ください。</p><p>・Azure VM Backup における Take Snapshot フェーズの確認方法<br><a href="https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_check_VM_backup_Subtask/">https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_check_VM_backup_Subtask/</a></p><p>次に実際の Azure VM Backup の実際のデータより作成したグラフをご参考までにお伝えさせていただきます。</p><h3 id="1-2-Azure-VM-Backup-におけるバックアップ-タイムの実績値グラフ"><a href="#1-2-Azure-VM-Backup-におけるバックアップ-タイムの実績値グラフ" class="headerlink" title=" 1.2 Azure VM Backup におけるバックアップ タイムの実績値グラフ"></a><a id="1-2"></a> 1.2 Azure VM Backup におけるバックアップ タイムの実績値グラフ</h3><p>Azure VM Backup のバックアップにかかった時間と転送データ量の実績値をグラフにしたものになります。<br><img src="https://user-images.githubusercontent.com/71251920/175569827-32081c88-3b8a-4eca-abdc-471033b3d4b8.png"></p><p> Azure VM のバックアップにおいて <strong>転送データ量とかかった時間に相関がない</strong>ことがわかるかと存じます。</p><p>また、転送データ量が数TBなど (200GB より多い) 場合、24 時間以上かかる事例がございますが、上述の通り、データ量から時間を概算することはかないません。</p><h3 id="1-3-Azure-VM-Backup-におけるリストア-タイムの実績値グラフ"><a href="#1-3-Azure-VM-Backup-におけるリストア-タイムの実績値グラフ" class="headerlink" title=" 1.3 Azure VM Backup におけるリストア タイムの実績値グラフ"></a><a id="1-3"></a> 1.3 Azure VM Backup におけるリストア タイムの実績値グラフ</h3><p>こちら、<strong>インスタント リストア</strong>ではなく Recovery Services コンテナー (標準コンテナー / Vault-Standard) からのリストアでございます。<br>Azure VM Backup のリストアにかかった時間と転送データ量の実績値をグラフにしたものになります。<br><img src="https://user-images.githubusercontent.com/71251920/175569833-99834c3c-46f3-4901-8014-5c0a6dc0cb22.png"><br>リストアにおいても<strong>転送データ量とかかった時間に相関がない</strong>ことがわかるかと存じます。</p><h4 id="インスタント-リストアついて"><a href="#インスタント-リストアついて" class="headerlink" title="インスタント リストアついて"></a>インスタント リストアついて</h4><p>インスタント リストアは Recovery Services コンテナーからの転送フェーズがございませんので、上記のグラフ結果よりも早い復元が期待できる機能でございます。</p><p>下記のように回復の種類に “スナップショット” が含まれる場合は自動的にインスタント リストアとなります。</p><p><img src="https://user-images.githubusercontent.com/71251920/178863089-01be3556-bf72-472a-9e48-888f80dd7875.png"></p><p>・Azure Backup のインスタント リストア機能を使用してバックアップと復元のパフォーマンスを改善する<br>　<a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-instant-restore-capability">https://docs.microsoft.com/ja-jp/azure/backup/backup-instant-restore-capability</a></p><h2 id="2-データディスクの数とバックアップやリストアにかかる時間"><a href="#2-データディスクの数とバックアップやリストアにかかる時間" class="headerlink" title=" 2. データディスクの数とバックアップやリストアにかかる時間"></a><a id="2"></a> 2. データディスクの数とバックアップやリストアにかかる時間</h2><p>また類似の質問として、Azure VM Backup において<strong>同じデータ量であればディスクの数が多い方が早いか？または遅いか？</strong>といった質問もいただくことがございますが、<a href="#1">1.</a>と同様の理由から一概に<strong>どちらの方が早くなるなどといったことはお伝えできません。</strong><br>なお、下記公開ドキュメントに、3 種類のパターンを提示したチャーンの影響説明をしておりますのでご参考ください。</p><p>・バックアップ パフォーマンスに対するチャーンの影響<br>　<a href="https://learn.microsoft.com/ja-jp/azure/backup/manage-recovery-points#impact-of-churn-on-backup-performance">https://learn.microsoft.com/ja-jp/azure/backup/manage-recovery-points#impact-of-churn-on-backup-performance</a></p><p>お客様のお役に立てれば幸いです。<br>本記事は以上です。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは。Azure Backup サポートの山本です。&lt;br&gt;今回はお問い合わせをいただくことが多い、Azure Backup におけるバックアップやリストアにかかる時間についてご説明いたします。 Azure VM B</summary>
      
    
    
    
    
    <category term="Azure Backup General" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-Backup-General/"/>
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
  </entry>
  
  <entry>
    <title>Azure Backup の障害調査に必要な情報 (疎通確認)</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureBackupGeneral/RequestForInvestigatingNW/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureBackupGeneral/RequestForInvestigatingNW/</id>
    <published>2022-06-24T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.307Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは。Azure Backup サポートの山本です。<br>今回は Azure Backup のバックアップ失敗、リストア失敗の時の調査をするにあたり、NW 観点で提供いただきたい情報をお伝えいたします。<br>NW 観点以外の情報採集提供依頼については下記をご覧ください<br>・Azure Backup の障害調査に必要な情報<br><a href="https://jpabrs-scem.github.io/blog/AzureBackupGeneral/RequestForInvestigating/">https://jpabrs-scem.github.io/blog/AzureBackupGeneral/RequestForInvestigating/</a></p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. Windows VM における Azure Backup 疎通確認</a><br><a href="#2">2. Linux VM における Azure Backup 疎通確認</a><br><a href="#3">3. プライベート エンドポイント環境における Azure Backup 疎通確認</a></p><hr><h2 id="1-Windows-VM-における-Azure-Backup-疎通確認"><a href="#1-Windows-VM-における-Azure-Backup-疎通確認" class="headerlink" title="1. Windows VM における Azure Backup 疎通確認"></a>1. Windows VM における Azure Backup 疎通確認<a id="1"></a></h2><p>まず、下記 リンク先から疎通確認スクリプトのダウンロードをお願いします。<br><a href="https://github.com/jpabrs-scem/blog/files/11648460/Check_Backup_NW_ver1.7.zip">Check_Backup_NW_ver1.7.zip</a></p><p>(スクリプト実行手順)</p><ol><li>疎通確認スクリプトをダウンロードし、展開してください。<br>※ ファイルの解凍パスワードは <strong>“AzureBackup”</strong> となります。</li><li>PowerShell を右クリックし、管理者として実行をクリックしてください。</li></ol><p> <img src="https://user-images.githubusercontent.com/71251920/175529513-5196c393-be7b-439e-aba3-063969d1ce26.png"></p><ol start="3"><li>PowerShell にて手順 1 で展開したスクリプトの場所に移動してください。<br>例 ) “Takato” というユーザーのデスクトップ上の PowerShell というフォルダ内にスクリプトをダウンロードしたときの移動コマンド<blockquote><p>cd C:\Users\Takato\Desktop\powershell</p></blockquote></li><li>以下コマンドを実行し、スクリプトを実行してください。<br>(現在画像とバージョンが異なりますが、同様の手順でございます。)<blockquote><p>.\Check_Backup_NW_ver1.3.ps1<br><img src="https://user-images.githubusercontent.com/71251920/175529518-afd3ab91-e450-42b9-b7b6-310c6633cca1.png"></p></blockquote></li></ol><ul><li>上記スクリプト実施時に実行ポリシーの制限によりスクリプトが実行できない場合はPowerShell を管理者権限で起動し、下記コマンドを実行し実行ポリシーを変更後、再度実行していただければ幸いでございます。<blockquote><p>Set-ExecutionPolicy Unrestricted</p></blockquote></li></ul><ol start="5"><li>以下のような “ScriptStart Completed” 出力がされるまで、お待ちください。</li></ol><p>*コマンドの実行には、環境によって 20 分ほど要する場合がございます。20 分経っても完了しない場合は、control + c を押下して強制終了してください。</p><p><img src="https://user-images.githubusercontent.com/71251920/175529520-b67e7eab-baef-4036-8c89-64ec9a86e40b.gif"></p><ol start="6"><li>コマンド実行が完了すると、スクリプトと同じフォルダ内に以下のようなログファイルが出力されますので、弊社までご提供お願いいたします。<br>ログファイル名: AzureBackup_Check_NW_yyyymmdd_hhmmss.log</li></ol><p><img src="https://user-images.githubusercontent.com/71251920/175529523-b5004d01-f4cd-4879-9c48-b9de17a8c477.jpg"></p><ul><li>control + c にて強制終了した場合においても該当のログファイルが出力されますので、弊社までご提供お願いいたします。</li></ul><h2 id="2-Linux-VM-における-Azure-Backup-疎通確認"><a href="#2-Linux-VM-における-Azure-Backup-疎通確認" class="headerlink" title="2. Linux VM における Azure Backup 疎通確認"></a>2. Linux VM における Azure Backup 疎通確認<a id="2"></a></h2><p>まず、下記 リンク先から疎通確認スクリプトのダウンロードをお願いします。<br><a href="https://github.com/jpabrs-scem/blog/files/11648461/Check_Backup_NW_Linux_ver1.4.zip">Check_Backup_NW_Linux_ver1.4.zip</a></p><p>(スクリプト実行手順)</p><ol><li><p>疎通確認スクリプトをダウンロードし、展開してください。<br>※ ファイルの解凍パスワードは <strong>“AzureBackup”</strong> となります。</p></li><li><p>対象の Linux マシンにスクリプトを移動し実行します。<br>必要に応じて chmod コマンドなどを用いてパーミッションを変更してください。</p><blockquote><p>chmod 777 Check_Backup_NW_Linux_ver1.4.sh </p></blockquote></li></ol><p>下記のように実行します。</p><blockquote><p>./Check_Backup_NW_Linux_ver1.4.sh</p></blockquote><ol start="3"><li>実行完了<br>実行が完了すれば下記のファイルが作成されます。<br>弊社までご提供お願いいたします。<blockquote><p>ログファイルは CheckNWResult_(ホスト名)_(YYYYMMDDHHMM).log です。</p></blockquote></li></ol><h3 id="2-1-参考画像"><a href="#2-1-参考画像" class="headerlink" title="2.1 参考画像"></a>2.1 参考画像</h3><p><img src="https://user-images.githubusercontent.com/71251920/185762249-d5dbed3c-9bce-409e-8a88-a5b43a52fe95.png" alt="-参考画像-"></p><h2 id="3-プライベート-エンドポイント環境における-Azure-Backup-疎通確認"><a href="#3-プライベート-エンドポイント環境における-Azure-Backup-疎通確認" class="headerlink" title="3. プライベート エンドポイント環境における Azure Backup 疎通確認"></a>3. プライベート エンドポイント環境における Azure Backup 疎通確認<a id="3"></a></h2><p> Azure VM 上の DB のバックアップ (Azure  SQL VM Backup や　Azure SAP HANA バックアップ) や MARS エージェントを利用したバックアップで<strong>プライベート エンドポイントをご利用の場合</strong>は下記もご対応お願いします。</p><p>・必須の DNS エントリを取得する<br><a href="https://learn.microsoft.com/ja-jp/azure/backup/private-endpoints#step-1-get-required-dns-entries">https://learn.microsoft.com/ja-jp/azure/backup/private-endpoints#step-1-get-required-dns-entries</a></p><p>上記 URL に従って下記  PowerShell スクリプトをご実施いただき、名前解決ができるかおよび疎通確認をお願いします。</p><p><a href="https://download.microsoft.com/download/1/2/6/126a410b-0e06-45ed-b2df-84f353034fa1/PrivateIP.ps1">PrivateIP.ps1</a></p><p>*Azure PowerShell が実行できる (Az moduleがインストールされた) 環境でご実施ください。</p><p>・[ご参考] Install the Azure Az PowerShell module<br><a href="https://learn.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-8.3.0">https://learn.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-8.3.0</a></p><h3 id="結果に-“backup”-が含まれる場合から1つの宛先に対する疎通確認"><a href="#結果に-“backup”-が含まれる場合から1つの宛先に対する疎通確認" class="headerlink" title="結果に “backup” が含まれる場合から1つの宛先に対する疎通確認"></a>結果に “backup” が含まれる場合から1つの宛先に対する疎通確認</h3><p>“privatlink” 付の FQDN に対して疎通確認を行ってください。<br>実施いただいたスクリプトの実行結果と後述の疎通確認コマンドの結果をテキスト(可能であれば画面ショットも添えて) zip などにおまとめの上ご提供お願いします。</p><blockquote><p>スクリプト実行結果例)<br><code> </code> &lt;vaultId&gt;-ab-pod01-fc1      <strong>privatelink</strong>.eus.<strong>backup</strong>.windowsazure.com     10.12.0.15</p></blockquote><p>スクリプトの実行結果が上記の場合は下記のようにお願いします。<br>また hosts ファイルをご利用の場合は nslookup コマンドの代わりに ping コマンドをご利用ください。</p><p><strong>windows(PowerShell)</strong></p><blockquote><p>nslookup(ping) &lt;vaultId&gt;-ab-pod01-fc1.<strong>privatelink</strong>.eus.backup.windowsazure.com<br>tnc -port 443 &lt;vaultId&gt;-ab-pod01-fc1.<strong>privatelink</strong>.eus.backup.windowsazure.com<br>tnc -port 443 10.12.0.15<br>Invoke-WebRequest https://&lt;vaultId&gt;-ab-pod01-fc1.<strong>privatelink</strong>.eus.backup.windowsazure.com<br>Invoke-WebRequest <a href="https://10.12.0.15/">https://10.12.0.15</a></p></blockquote><p><strong>Linux</strong></p><blockquote><p>nslookup(ping) &lt;vaultId&gt;-ab-pod01-fc1.<strong>privatelink</strong>.eus.backup.windowsazure.com<br>nc -vz &lt;vaultId&gt;-ab-pod01-fc1.<strong>privatelink</strong>.eus.backup.windowsazure.com<br>nc -vz  10.12.0.15　443<br>curl -I https://&lt;vaultId&gt;-ab-pod01-fc1.<strong>privatelink</strong>.eus.backup.windowsazure.com<br>curl -I <a href="https://10.12.0.15/">https://10.12.0.15</a> </p></blockquote><h3 id="結果に-“backup”-が含まれない-“blob”-や”queue”等が含まれる-場合"><a href="#結果に-“backup”-が含まれない-“blob”-や”queue”等が含まれる-場合" class="headerlink" title="結果に “backup” が含まれない (“blob” や”queue”等が含まれる) 場合"></a>結果に “backup” が含まれない (“blob” や”queue”等が含まれる) 場合</h3><p>こちらは初期調査では一旦不要です。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは。Azure Backup サポートの山本です。&lt;br&gt;今回は Azure Backup のバックアップ失敗、リストア失敗の時の調査をするにあたり、NW 観点で提供いただきたい情報をお伝えいたします。&lt;br&gt;NW</summary>
      
    
    
    
    
    <category term="Azure Backup General" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-Backup-General/"/>
    
    <category term="情報採取" scheme="https://jpabrs-scem.github.io/blog/tags/%E6%83%85%E5%A0%B1%E6%8E%A1%E5%8F%96/"/>
    
  </entry>
  
  <entry>
    <title>DPMとMABSを使用しvCenter Serverに接続する時に、「VMWare Serverと通信できない」Error 33623 が発生した場合の対処方法</title>
    <link href="https://jpabrs-scem.github.io/blog/DPM&amp;MABS/VMware_Error_332623/"/>
    <id>https://jpabrs-scem.github.io/blog/DPM&amp;MABS/VMware_Error_332623/</id>
    <published>2022-03-31T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.391Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは、Microsoft Azure Backup ＆ Recovery Services サポートです。</p><p>最近 DPM (Data Protection Manager)、MABS (Microsoft Azure Backup Server) を使用し、オンプレミス環境や AVS(Azure VMware Solution) 環境にある VMWare 仮想マシンをアックアップする需要が多くなっています。<br>DPM と MABS を VMWare vCenter Server に初期接続する時に、下記のような「VMWare Server と通信できない」エラーが発生した問い合わせがあります。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. 【事象 Error ID 33623】</a><br><a href="#2">2. 【対処方法】</a></p><hr><h2 id="1-【事象】"><a href="#1-【事象】" class="headerlink" title="1. 【事象】"></a>1. 【事象】<a id="1"></a></h2><blockquote><p>Error ID 33623<br>Internal error code 0x80990EF2 </p></blockquote><p>*** ＜DPMコンソールのエラー画面サンプル＞ ***<br><img src="https://user-images.githubusercontent.com/71251920/161022695-3e7da576-4708-442b-800a-45d94a32f307.png"></p><p>上記エラーを解消するためのサポートチケットを起票する前に、まず下記 2 つの設定を確認することを推奨します。</p><h2 id="2-【対処方法】"><a href="#2-【対処方法】" class="headerlink" title="2. 【対処方法】"></a>2. 【対処方法】<a id="2"></a></h2><ol><li>vCenter Server 6.7 以降の場合、DPM、MABS サーバーにで TLS 1.2 を有効にします。</li></ol><p>TLS 1.2を有効化する方法について下記ドキュメントをご参照ください。<br> MABS向けのドキュメント：<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-backup-server-vmware#vmware-vsphere-67-and-70">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-backup-server-vmware#vmware-vsphere-67-and-70</a></p><p>DPM向けのドキュメント：<br><a href="https://docs.microsoft.com/ja-jp/system-center/dpm/back-up-vmware?view=sc-dpm-2019#vmware-vsphere-67">https://docs.microsoft.com/ja-jp/system-center/dpm/back-up-vmware?view=sc-dpm-2019#vmware-vsphere-67</a></p><h3 id="実施ステップのサンプル"><a href="#実施ステップのサンプル" class="headerlink" title="実施ステップのサンプル"></a>実施ステップのサンプル</h3><p>①以下のテキストをコピーして、.txt ファイルに貼り付けます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\.NETFramework\v2.0.50727]</span><br><span class="line">&quot;SystemDefaultTlsVersions&quot;=dword:00000001</span><br><span class="line">&quot;SchUseStrongCrypto&quot;=dword:00000001</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\.NETFramework\v4.0.30319]</span><br><span class="line">&quot;SystemDefaultTlsVersions&quot;=dword:00000001</span><br><span class="line">&quot;SchUseStrongCrypto&quot;=dword:00000001</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v2.0.50727]</span><br><span class="line">&quot;SystemDefaultTlsVersions&quot;=dword:00000001</span><br><span class="line">&quot;SchUseStrongCrypto&quot;=dword:00000001</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v4.0.30319]</span><br><span class="line">&quot;SystemDefaultTlsVersions&quot;=dword:00000001</span><br><span class="line">&quot;SchUseStrongCrypto&quot;=dword:00000001</span><br></pre></td></tr></table></figure><p>②そのファイルを EnableTLS12.reg という名前で DPM、MABSサーバーに保存します。</p><p>③ファイルをダブルクリックして、レジストリ エントリをアクティブ化します。</p><ol start="2"><li>下記ドキュメントを参照し、HTTPS 証明書の検証を無効化にして、事象改善されるかを確認します。<br>MABS向けのドキュメント：<br>「HTTPS 証明書の検証の無効化」セッションを参照します。<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-backup-server-vmware#create-a-secure-connection-to-the-vcenter-server">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-backup-server-vmware#create-a-secure-connection-to-the-vcenter-server</a></li></ol><p>DPM向けのドキュメント：<br>「セキュリティで保護された通信プロトコルを無効にする」セッションを参照します。<br><a href="https://docs.microsoft.com/ja-jp/system-center/dpm/back-up-vmware?view=sc-dpm-2019#configure-dpm-to-protect-vmware">https://docs.microsoft.com/ja-jp/system-center/dpm/back-up-vmware?view=sc-dpm-2019#configure-dpm-to-protect-vmware</a></p><h3 id="実施ステップのサンプル-1"><a href="#実施ステップのサンプル-1" class="headerlink" title="実施ステップのサンプル"></a>実施ステップのサンプル</h3><p>①以下のテキストをコピーして、.txt ファイルに貼り付けます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft Data Protection Manager\VMWare]</span><br><span class="line">&quot;IgnoreCertificateValidation&quot;=dword:00000001</span><br></pre></td></tr></table></figure><p>②そのファイルを DisableSecureAuthentication.reg という名前で DPM、MABS サーバーに保存します。</p><p>③ファイルをダブルクリックして、レジストリ エントリをアクティブ化します。</p><p>もし上記アクションを実施後でも事象改善しない場合、問い合わせを起票していただければと存じます。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは、Microsoft Azure Backup ＆ Recovery Services サポートです。&lt;/p&gt;
&lt;p&gt;最近 DPM (Data Protection Manager)、MABS (Microsof</summary>
      
    
    
    
    
    <category term="TROUBLE SHOOTING" scheme="https://jpabrs-scem.github.io/blog/tags/TROUBLE-SHOOTING/"/>
    
    <category term="DPM / MABS" scheme="https://jpabrs-scem.github.io/blog/tags/DPM-MABS/"/>
    
  </entry>
  
  <entry>
    <title>Azure VM Backup のデータ転送フェーズを意図的に失敗させる方法</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_fail_ttv/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_fail_ttv/</id>
    <published>2022-03-10T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.339Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは、Azure Backup サポートの 荘司 です。<br>今回は、<strong>Azure VM Backup における転送フェーズを意図的に失敗させる方法</strong>について、ご案内いたします。<br>*転送フェーズとは Transfer data to vault フェーズを指します。<br>詳細については幣ブログの関連のページをご覧ください<br>・Transfer data to vault フェーズ - Azure VM Backup の通信要件や処理の流れについて<br><a href="https://jpabrs-scem.github.io/blog/AzureVMBackup/NWRequirementAndProcess/#2-2">https://jpabrs-scem.github.io/blog/AzureVMBackup/NWRequirementAndProcess/#2-2</a></p><p>また下記幣ブログの記事では Take Snapshot フェーズを失敗させる方法をご案内しております。<br>・Azure VM Backup を意図的に失敗させる方法<br><a href="https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_fail_VM_backup/">https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_fail_VM_backup/</a></p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. Transfer data to vault を失敗させる方法概略</a><br><a href="#2">2. Transfer data to vault を失敗させる方法の注意点</a><br><a href="#3">3. Transfer data to vault を失敗させる手順</a></p><hr><h2 id="1-Transfer-data-to-vault-を失敗させる方法概略"><a href="#1-Transfer-data-to-vault-を失敗させる方法概略" class="headerlink" title="1. Transfer data to vault を失敗させる方法概略"></a>1. Transfer data to vault を失敗させる方法概略<a id="1"></a></h2><p>Azure VM Backup を実行し、Take Snapshot 完了後に該当の Azure VM のリストアポイントコレクション (ローカルスナップショットのメタデータ) を削除します。<br>そうすることで Transfer data to vault が失敗し、バックアップストレージ(標準コンテナー/ Recovery Services コンテナー)への転送が失敗します。</p><h2 id="2-Transfer-data-to-vault-を失敗させる方法の注意点"><a href="#2-Transfer-data-to-vault-を失敗させる方法の注意点" class="headerlink" title="2. Transfer data to vault を失敗させる方法の注意点"></a>2. Transfer data to vault を失敗させる方法の注意点<a id="2"></a></h2><ol><li>この方法ではリストアポイントコレクションを削除するため、リストアポイントコレクションを削除する前に取得された復元ポイントおよび該当のバックアップ ジョブで作成された復元ポイントではインスタントリストアが出来なくなります。<br>つまり、回復の種類が “スナップショット” のものは下記のように <em><strong>“UserErrorInstantRpNotFound” と復元するためのリソースがない旨のエラーメッセージがでて復元ができなくなります</strong></em>。<br>“スナップショットと標準コンテナー” のものは バックアップストレージ からの復元が可能です。<br><img src="https://user-images.githubusercontent.com/71251920/157503085-0d5ff930-b877-444f-83ab-7637015cbfeb.png"></li><li>この方法を実施したあと下記のようなエラーが発生しますが、再度バックアップを実行することにより解消されます。<br><img src="https://user-images.githubusercontent.com/71251920/157502733-09a19fbb-23f5-430a-a334-55591de41b52.png"></li></ol><p>その場合、復元した際に <strong>“UserErrorInstantRpNotFound”</strong> となっていた復元ポイントは <strong>無効/Invalid</strong> と表示されます。<br><img src="https://user-images.githubusercontent.com/71251920/157502744-47f216d0-2f8a-4fa4-a72c-79f78a80a546.png"></p><h2 id="3-Transfer-data-to-vault-を失敗させる手順"><a href="#3-Transfer-data-to-vault-を失敗させる手順" class="headerlink" title="3. Transfer data to vault を失敗させる手順"></a>3. Transfer data to vault を失敗させる手順<a id="3"></a></h2><ol><li><p>失敗させたい VM にて今すぐバックアップを実行します。</p></li><li><p>バックアップ ジョブより該当のジョブの詳細を開き、サブタスクが以下の状態となっていることを確認します。(この状態になるのに通常 5 ~ 10 分程度かかります)<br>　・Take Snapshot：Completed<br>　・Transfer data to vault：In progress<br><img src="https://user-images.githubusercontent.com/71251920/157502743-dd6c88d7-a959-47e1-b3cd-8cded953ceb0.png"></p></li><li><p>ポータルのホーム画面にて “Restore Point Celloctions” と検索し、サービス欄に出てきた Restore Point Celloctions をクリックします。<br><img src="https://user-images.githubusercontent.com/71251920/157502742-73239758-d52f-4230-96ba-005cb7e411f6.png"></p></li><li><p>検索欄に該当の VM 名を入力し、出てきた RestorePoint Collection をクリックします。<br>　RestorePoint Collection は “AzureBackup_&lt;VM 名&gt;_xxxxxxxxxxxxx” といった命名規則にて存在しております。<br><img src="https://user-images.githubusercontent.com/71251920/157502740-150a8c21-19e4-4bdd-89ea-28e1f9db93fd.png"></p></li><li><p>Delete をクリックし、出現したメッセージの OK をクリックして RestorePoint Collection を削除します。<br><img src="https://user-images.githubusercontent.com/71251920/157502739-4d1655cc-2ee2-4eb2-ba22-d8cb9d73d4af.png"></p></li><li><p>バックアップ ジョブが完了するのを待ちます。(状況によって数十分から数時間要する場合があります)</p></li><li><p>時間が経過すると、以下のように Transfer data to vault プロセスが失敗したことを確認できます。<br><img src="https://user-images.githubusercontent.com/71251920/157502737-ba0b8cda-001e-421e-a6d7-e3648c2c38fa.png"></p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは、Azure Backup サポートの 荘司 です。&lt;br&gt;今回は、&lt;strong&gt;Azure VM Backup における転送フェーズを意図的に失敗させる方法&lt;/strong&gt;について、ご案内いたします。&lt;br</summary>
      
    
    
    
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
    <category term="Azure VM Backup" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-VM-Backup/"/>
    
  </entry>
  
  <entry>
    <title>ABRS チームについて ~リモートワークでの働きかた~</title>
    <link href="https://jpabrs-scem.github.io/blog/information/team-introduction_2/"/>
    <id>https://jpabrs-scem.github.io/blog/information/team-introduction_2/</id>
    <published>2022-03-04T03:00:00.000Z</published>
    <updated>2023-06-08T00:08:47.451Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>こんにちは！ABRS チームの山本です。<br>今日は、私たちのチームがどのように働いているのか、少しでも皆さんにイメージしていただき、興味をもっていただけるよう、普段の働き方や仕事環境について紹介いたします。<br>現在は全メンバーがリモートワークをしており、首都圏以外にも北海道や大阪在住、またUS在住のメンバーまで在籍しております。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. よくある仕事の流れ</a><br><a href="#2">2. とある日の一日</a><br><a href="#3">3. デスク ツアー！</a><br><a href="#4">4. リモート ワークの魅力</a><br><a href="#5">5. 関連記事</a></p><hr><h3 id="1-よくある仕事の流れ"><a href="#1-よくある仕事の流れ" class="headerlink" title="1. よくある仕事の流れ"></a>1. よくある仕事の流れ<a id="1"></a></h3><p>Microsoft のサポート エンジニアはお客様から起票いただいたサポート リクエストを通してお客様の抱える問題を解決するための技術支援を行います。<br>案件の受付からクローズまで基本的には担当するメンバーがオーナーシップを持って対応します。<br>基本的な案件対応の流れとしては、案件の受付 → 調査方針の決定 → 発生している問題の調査 → 回答、事象の解消を確認 → クローズ(対応終了) です。<br>案件の受付から、概ね 14 日程度でクローズとなります。<br>各エンジニアは 10 ~ 20 件ほどの案件を担当として受け持ち、また同時並行で案件対応を進めていきます。また他にも公開ドキュメントの修正やこうしたブログの執筆も行っております。</p><p>このように記載すると 1 つの案件を最初から最後まで自分ひとりで対応しなければいけないように感じるかもしれません。<br>しかし、実際には同じチームのメンバーや、その他の Azure サポート チームのメンバーと非常に密に連携しながら仕事を進めています。<br>クラウド サービスでは、新しい機能の追加や機能の改修が日常的に行われており、もはや一人のスーパー エンジニアが何でも知っている、という時代ではなくなっています。<br>言い換えれば、新しい機能や未知の問題に直面したとき、あなたがその問題の第一人者です。<br>また、事例の無いお問い合わせを担当するとワクワクするようになります。</p><p>このような状況から、各案件でオーナーシップをとる担当者がいるものの、実際には色々なメンバーと支援をし合いながら調査を行っています。</p><h3 id="2-とある日の一日"><a href="#2-とある日の一日" class="headerlink" title="2. とある日の一日 "></a>2. とある日の一日 <a id="2"></a></h3><p>9:00 - サポート窓口が開きます。<br>業務を開始！まずはメール チェックし、今日一日のタスクの洗い出し。</p><hr><p>9:30 - チームの朝会に参加します！<br>チーム全体への共有事項の展開や、サポート案件対応で困ったポイントを相談します。</p><hr><p>10:00 - 新規案件対応。<br>その日に新しくお問い合わせいただいた案件について、お客様へ電話をして対応方針をお客様と相談します。</p><hr><p>12:00 - お昼休憩！<br>家族と一緒にお昼ご飯を食べます！</p><hr><p>13:00 - ミーティングに参加します！<br>チーム ミーティングや他のサポート チームとのミーティングに参加し、打ち合わせを行います。</p><hr><p>13:30 - 案件調査を行います。<br>気合を入れて、時間のかかる調査 (ログの解析、再現テスト) を行います。</p><hr><p>15:00 - Coffee Break ミーティングに参加。<br>Coffee Break ミーティングでは、業務に関連のない雑談もしてリフレッシュ！<br>コミュニケーションを取るきっかけになり案件対応の相談もしやすくなっているように感じます！</p><hr><p>15:30 - 調査を再開します！<br>サポート窓口が閉まる 17:30 までにお客様へ調査結果を報告できるようラスト スパート！</p><hr><p>16:30 - 夕会<br>一日の進捗を共有したり各メンバの状況をシェア・相談します。</p><hr><p>17:30 - サポート窓口が閉まります。<br>気が済むまで、翌日報告予定の案件の調査や、他メンバーの案件の内容を勉強します。</p><hr><h3 id="3-デスク-ツアー！"><a href="#3-デスク-ツアー！" class="headerlink" title="3. デスク ツアー！"></a>3. デスク ツアー！<a id="3"></a></h3><p>実際のメンバーのデスクですので、こちらからメンバーがどのような環境で働いているのか参考になれば嬉しいです！</p><h5 id="本記事内唯一の縦置きディスプレイ配置！USキーボード！"><a href="#本記事内唯一の縦置きディスプレイ配置！USキーボード！" class="headerlink" title="本記事内唯一の縦置きディスプレイ配置！USキーボード！"></a>本記事内唯一の縦置きディスプレイ配置！USキーボード！</h5><p><img src="https://user-images.githubusercontent.com/71251920/156648350-f0e85a1e-fe54-4866-8268-8914bc880362.png"></p><h5 id="女優ライトでミーティングもバッチリ！リアルフォースキーボード！メインPCは自作の光る-Desk-mini"><a href="#女優ライトでミーティングもバッチリ！リアルフォースキーボード！メインPCは自作の光る-Desk-mini" class="headerlink" title="女優ライトでミーティングもバッチリ！リアルフォースキーボード！メインPCは自作の光る Desk mini !"></a>女優ライトでミーティングもバッチリ！リアルフォースキーボード！メインPCは自作の光る Desk mini !</h5><p><img src="https://user-images.githubusercontent.com/71251920/156648359-3bdc08e5-c0f5-4b50-ae94-7e0aef791006.jpg"></p><h5 id="トラックボールマウス！！"><a href="#トラックボールマウス！！" class="headerlink" title="トラックボールマウス！！"></a>トラックボールマウス！！</h5><p><img src="https://user-images.githubusercontent.com/71251920/156648360-81024452-0551-4987-abb0-944fba099dcc.jpg"></p><h5 id="モニターの上のぬいぐるみは家族にミーティング中かどうかをお知らせする機能あり！！"><a href="#モニターの上のぬいぐるみは家族にミーティング中かどうかをお知らせする機能あり！！" class="headerlink" title="モニターの上のぬいぐるみは家族にミーティング中かどうかをお知らせする機能あり！！"></a>モニターの上のぬいぐるみは家族にミーティング中かどうかをお知らせする機能あり！！</h5><p><img src="https://user-images.githubusercontent.com/71251920/156648362-65cc4352-b2bb-4108-a815-6ac80eeb1e13.jpg"></p><h5 id="ワーキングママ！！"><a href="#ワーキングママ！！" class="headerlink" title="ワーキングママ！！"></a>ワーキングママ！！</h5><p><img src="https://user-images.githubusercontent.com/71251920/156648364-0b6794a8-4dc9-49d6-b774-dddcc5e6cba2.png"></p><h5 id="シンプル-is-ベスト"><a href="#シンプル-is-ベスト" class="headerlink" title="シンプル is ベスト."></a>シンプル is ベスト.</h5><p><img src="https://user-images.githubusercontent.com/71251920/156648366-8a3639de-c478-4780-8db6-e7753b016415.jpg"></p><h5 id="キーボードは社割で買いました！カレンダーは星野道夫さんのです。はやくアラスカに行きたいです！"><a href="#キーボードは社割で買いました！カレンダーは星野道夫さんのです。はやくアラスカに行きたいです！" class="headerlink" title="キーボードは社割で買いました！カレンダーは星野道夫さんのです。はやくアラスカに行きたいです！"></a>キーボードは社割で買いました！カレンダーは星野道夫さんのです。はやくアラスカに行きたいです！</h5><p><img src="https://user-images.githubusercontent.com/71251920/156648368-15eb0558-c2f4-49cb-a887-61e18cc76088.jpg"></p><h5 id="保温機能がついた高性能マグカップ！！"><a href="#保温機能がついた高性能マグカップ！！" class="headerlink" title="保温機能がついた高性能マグカップ！！"></a>保温機能がついた高性能マグカップ！！</h5><p><img src="https://user-images.githubusercontent.com/71251920/156648370-3fbf5c3d-9022-49e5-a392-c061bb204052.jpg"></p><h5 id="ゲーミングな光が-So-Cool"><a href="#ゲーミングな光が-So-Cool" class="headerlink" title="ゲーミングな光が So Cool!"></a>ゲーミングな光が So Cool!</h5><p><img src="https://user-images.githubusercontent.com/71251920/156648371-3c45e268-97bd-49ef-a84e-60695546a15f.jpg"></p><h5 id="チーム唯一の新卒・新入社員！デスクもまだまださらなる進化の可能性を秘めています！！"><a href="#チーム唯一の新卒・新入社員！デスクもまだまださらなる進化の可能性を秘めています！！" class="headerlink" title="チーム唯一の新卒・新入社員！デスクもまだまださらなる進化の可能性を秘めています！！"></a>チーム唯一の新卒・新入社員！デスクもまだまださらなる進化の可能性を秘めています！！</h5><p><img src="https://user-images.githubusercontent.com/71251920/168879380-f0e93804-61b5-4f87-a02d-5d7e57ff17e4.png"></p><h5 id="タブレット端末も活用してトリプルモニタ環境。インフラエンジニア必携”パケットキャプチャの教科書”をデスク脇に備えています！"><a href="#タブレット端末も活用してトリプルモニタ環境。インフラエンジニア必携”パケットキャプチャの教科書”をデスク脇に備えています！" class="headerlink" title="タブレット端末も活用してトリプルモニタ環境。インフラエンジニア必携”パケットキャプチャの教科書”をデスク脇に備えています！"></a>タブレット端末も活用してトリプルモニタ環境。インフラエンジニア必携”パケットキャプチャの教科書”をデスク脇に備えています！</h5><p><img src="https://user-images.githubusercontent.com/71251920/168879386-3526cd8d-a403-402f-a8e6-b434c9207302.png"></p><h5 id="いつも愛車を眺めて仕事しています！"><a href="#いつも愛車を眺めて仕事しています！" class="headerlink" title="いつも愛車を眺めて仕事しています！"></a>いつも愛車を眺めて仕事しています！</h5><p><img src="https://user-images.githubusercontent.com/71251920/196878695-383606ab-cc50-4460-8544-6de6c6c6b56e.png"></p><h3 id="4-リモート-ワークの魅力"><a href="#4-リモート-ワークの魅力" class="headerlink" title="4. リモート ワークの魅力"></a>4. リモート ワークの魅力<a id="4"></a></h3><p>自分好みの環境を作ることが出来る。<br>睡眠時間が増えます。<br>自分の時間が取りやすい (通勤なし、すぐ家族に会える) のは非常に良い。<br>家族との時間が格段に増える。<br>出勤時間が 0 になるので、自由時間が増える。<br>自由なタイミングで休憩時間をとって、役所行ったり子供の面倒を見たり出来る。<br>通勤時間がなくなるので、その分を有意義に使えます。<br>子供のオムツをかえられる。<br>宅配の荷物が受け取れる。</p><h3 id="関連記事"><a href="#関連記事" class="headerlink" title="関連記事"></a>関連記事<a id="5"></a></h3><p>・ABRS &amp; SCEM チームについて<br><a href="https://jpabrs-scem.github.io/blog/information/team-introduction/">https://jpabrs-scem.github.io/blog/information/team-introduction/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;こんにちは！ABRS チームの山本です。&lt;br&gt;今日は、私たちのチームがどのように働いているのか、少しでも皆さんにイメージしていただき、興味をもっていただけるよう、普段の働き方や仕事環境について紹介いたします。&lt;br&gt;現在は全</summary>
      
    
    
    
    
    <category term="Information" scheme="https://jpabrs-scem.github.io/blog/tags/Information/"/>
    
  </entry>
  
</feed>
