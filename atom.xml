<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan CSS ABRS &amp; SCEM Support Blog</title>
  
  <subtitle>Azure Backup,Azure Site Recovery,Azure Migrate および System Center 製品(Orchestrator , Operations/Virtual Machine/Service/Data Protection Manager)に関するサポート情報を発信します。</subtitle>
  <link href="https://jpabrs-scem.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpabrs-scem.github.io/blog/"/>
  <updated>2021-11-18T02:53:41.648Z</updated>
  <id>https://jpabrs-scem.github.io/blog/</id>
  
  <author>
    <name>Japan CSS ABRS &amp; SCEM Support Team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Azure VM Backup における Take Snapshot フェーズの確認方法</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_fail_VM_backup/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_fail_VM_backup/</id>
    <published>2021-11-18T03:00:00.000Z</published>
    <updated>2021-11-18T02:53:41.648Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは。Azure Backup サポートの山本です。<br>今回はお問い合わせをいただくことが多い、 <strong>“Azure VM Backup における Take Snapshot フェーズの確認方法”</strong>  について解説させていただきます。<br>Azure VM Backup では  Take Snapshot フェーズ が終わっていれば VM の再起動などを実施いただいても影響がないため、**Take Snapshot フェーズの “ステータス確認を確認したい”、”かかった時間を知りたい”**、というお問い合わせをよくいただきます。</p><p>まず、はじめに前提知識として Azure VM Backup ではバックアップを取得する際に下記 2 つのサブタスクがございます。<br>1.Take Snapshot (スナップショットの取得)<br>2.Transfer data to vault (Recovery Services コンテナーへの転送)<br><img src="https://user-images.githubusercontent.com/71251920/142253918-138343ac-b7dc-4a35-9e6e-180b4b5542f8.png" alt="Azure VM Backupの 2 つのサブタスク"></p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. サブタスク (Take Snapshot フェーズ) 確認方法</a><br> <a href="#1-1">1-1. Azure Portal を用いたサブタスク (Take Snapshot フェーズ) 確認方法</a><br> <a href="#1-2">1-2. Azure CLI を用いたサブタスク (Take Snapshot フェーズ) 確認方法</a><br> <a href="#1-3">1-3. Azure PowerShell を用いたサブタスク (Take Snapshot フェーズ) 確認方法</a><br><a href="#2">2. サブタスク (Take Snapshot フェーズ) にかかった時間を確認する方法</a></p><hr><h2 id="1-サブタスク-Take-Snapshot-フェーズ-確認方法"><a href="#1-サブタスク-Take-Snapshot-フェーズ-確認方法" class="headerlink" title="1. サブタスク (Take Snapshot フェーズ) 確認方法"></a>1. サブタスク (Take Snapshot フェーズ) 確認方法<a id="1"></a></h2><p>サブタスク確認方法は <strong>Azure Portal で確認する方法</strong>、および、 <strong>Azure CLI や Azure PowerShell といった CLI を用いた方法</strong>がございます。<br>今回弊社検証環境で確認結果も添えてお伝えさせていただきます。<br>また Recovery Services コンテナーのことを RSV と略して表記している部分がございます。</p><ul><li>検証環境情報<br>まず、はじめに今回の検証環境の情報です。<blockquote><p>VM名：VM-Win10<br>リソースグループ：RG-alwaysONVM<br>Recovery Services コンテナー：RSV-JPE-LRS<br>リソースグループ：RG-NormalTest</p></blockquote></li></ul><h3 id="1-1-Azure-Portal-を用いたサブタスク-Take-Snapshot-フェーズ-確認方法"><a href="#1-1-Azure-Portal-を用いたサブタスク-Take-Snapshot-フェーズ-確認方法" class="headerlink" title="1-1. Azure Portal を用いたサブタスク (Take Snapshot フェーズ) 確認方法"></a>1-1. Azure Portal を用いたサブタスク (Take Snapshot フェーズ) 確認方法<a id="1-1"></a></h3><p>[対象の Recovery Services コンテナー] → 左ペインの [バックアップ ジョブ] → 対象のバックアップ ジョブの [View details] → [Sub Tasks] の手順で確認いただくことが可能です。</p><p><img src="https://user-images.githubusercontent.com/71251920/142235689-8f2a6b5d-44b9-47f4-80fe-571407e09e47.png" alt="Check_Subtask"></p><h3 id="1-2-Azure-CLI-を用いたサブタスク-Take-Snapshot-フェーズ-確認方法"><a href="#1-2-Azure-CLI-を用いたサブタスク-Take-Snapshot-フェーズ-確認方法" class="headerlink" title="1-2. Azure CLI を用いたサブタスク (Take Snapshot フェーズ) 確認方法"></a>1-2. Azure CLI を用いたサブタスク (Take Snapshot フェーズ) 確認方法<a id="1-2"></a></h3><p>今回は Windows の PowerShell を用いて Azure CLI を実行します。</p><h4 id="0-事前準備"><a href="#0-事前準備" class="headerlink" title="0.事前準備"></a>0.事前準備</h4><p>　 Azure へログインします。ログインしている環境であれば不要です。</p><blockquote><p>コマンド：<code> </code> <code>az login</code> <code> </code></p></blockquote><h4 id="1-Name-値-の取得-バックアップ-ジョブのステータス確認"><a href="#1-Name-値-の取得-バックアップ-ジョブのステータス確認" class="headerlink" title="1.Name 値 の取得 /  バックアップ ジョブのステータス確認"></a>1.Name 値 の取得 /  バックアップ ジョブのステータス確認</h4><blockquote><p>コマンド：<code> </code> <code>az backup job list --resource-group &lt; RSV リソースグループ名&gt; --vault-name &lt; RSV 名&gt; --status inprogress​ -o table</code> <code> </code><br>コマンド例：<code> </code> <code>az backup job list --resource-group RG-NormalTest --vault-name RSV-JPE-LRS --status inprogress​ -o table</code> <code> </code></p></blockquote><p>上記コマンドを実行いただくと実行中のバックアップ ジョブの name 値が取得できます。<br> 出力結果を Azure VM Backup の実行中のバックアップ ジョブに限定する場合は “–backup-management-type AzureIaasVM” を付けることで可能です。</p><p>　下記例 “name” : “2a8c96f8-c282-4f62-9286-fda08088047e”<br><img src="https://user-images.githubusercontent.com/71251920/142236195-c47b1fe8-73b0-401e-a050-43be7c4a35d6.png" alt="Check_name_value"></p><h4 id="2-サブタスク-Take-Snapshot-フェーズ-のステータス確認"><a href="#2-サブタスク-Take-Snapshot-フェーズ-のステータス確認" class="headerlink" title="2.サブタスク (Take Snapshot フェーズ) のステータス確認"></a>2.サブタスク (Take Snapshot フェーズ) のステータス確認</h4><p>name 値 を用いて下記のコマンドを実行することでサブタスクのステータスが確認できます。<br>下記例では Take Snapshot のステータスが Completed 、Transfer data to vault のステータスが InProgress 、となっており、スナップショットの取得が終わり、 Recovery Services コンテナーへの転送中であることが分かります。</p><blockquote><p>コマンド：<code> </code> <code>az backup job show --name &lt;name値&gt; --resource-group  &lt; RSV リソースグループ名&gt; --vault-name  &lt; RSV 名&gt; --query properties.extendedInfo.tasksList -o table</code> <code> </code></p></blockquote><blockquote><p>コマンド例 :<code> </code> <code>az backup job show --name 2a8c96f8-c282-4f62-9286-fda08088047e --resource-group  RG-NormalTest --vault-name RSV-JPE-LRS --query properties.extendedInfo.tasksList -o table</code> <code> </code></p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/142236727-60dfeae5-4960-4f91-a96e-c9d223acaff2.png" alt="Check_Subtask_Azure_CLI_1"></p><p>–query オプションを付けない場合は下記の部分から確認できます。</p><blockquote><p>コマンド：<code> </code> <code>az backup job show --name &lt; name 値&gt; --resource-group  &lt; RSV リソースグループ名&gt; --vault-name  &lt; RSV 名&gt;</code> <code> </code><br>コマンド例：<code> </code> <code>az backup job show --name 2a8c96f8-c282-4f62-9286-fda08088047e --resource-group  RG-NormalTest --vault-name RSV-JPE-LRS</code> <code> </code></p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/142236740-9817d4cf-13a9-480b-816c-ba09e252aea6.png" alt="Check_Subtask_Azure_CLI_2"></p><ul><li>参考：<br>・Azure CLI を使用した Azure での仮想マシンのバックアップ - バックアップ ジョブを監視する<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/quick-backup-vm-cli#monitor-the-backup-job">https://docs.microsoft.com/ja-jp/azure/backup/quick-backup-vm-cli#monitor-the-backup-job</a><br>・az backup job - az backup job list<br><a href="https://docs.microsoft.com/ja-jp/cli/azure/backup/job?view=azure-cli-latest#az_backup_job_list">https://docs.microsoft.com/ja-jp/cli/azure/backup/job?view=azure-cli-latest#az_backup_job_list</a><br>・JMESPath クエリを使用して Azure CLI コマンドの出力に対してクエリを実行する方法 - 辞書のプロパティを取得する(–query オプションに関する参考情報)<br><a href="https://docs.microsoft.com/ja-jp/cli/azure/query-azure-cli#get-properties-in-a-dictionary">https://docs.microsoft.com/ja-jp/cli/azure/query-azure-cli#get-properties-in-a-dictionary</a></li></ul><h3 id="1-3-Azure-PowerShell-を用いたサブタスク-Take-Snapshot-フェーズ-確認方法"><a href="#1-3-Azure-PowerShell-を用いたサブタスク-Take-Snapshot-フェーズ-確認方法" class="headerlink" title="1-3. Azure PowerShell を用いたサブタスク (Take Snapshot フェーズ) 確認方法"></a>1-3. Azure PowerShell を用いたサブタスク (Take Snapshot フェーズ) 確認方法<a id="1-3"></a></h3><p>今回は Windows の PowerShell を用いて Azure PowerShell を実行します。</p><h4 id="0-事前準備-1"><a href="#0-事前準備-1" class="headerlink" title="0.事前準備"></a>0.事前準備</h4><p>　 Azure へログインします。ログインしている環境であれば不要です。</p><blockquote><p>コマンド：<code> </code> <code>Connect-AzAccount</code> <code> </code>　　</p></blockquote><h4 id="1-定数を設定します。"><a href="#1-定数を設定します。" class="headerlink" title="1.定数を設定します。"></a>1.定数を設定します。</h4><blockquote><p>コマンド：<code> </code> <code>$Vault = Get-AzRecoveryServicesVault -Name ”&lt; RSV 名&gt;”</code> <code> </code><br>コマンド例：<code> </code> <code>$Vault = Get-AzRecoveryServicesVault -Name ”RSV-JPE-LRS”</code> <code> </code></p></blockquote><blockquote><p>コマンド：<code> </code> <code>$VMName = &quot;&lt; VM 名&gt;&quot;</code> <code> </code><br>コマンド例：<code> </code> <code>$VMName = &quot;VM-Win10&quot;</code> <code> </code></p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/142237893-8c25f4e9-4db1-4da5-b27b-7f33160e893a.png" alt="configure_const"></p><h4 id="2-実行中のバックアップ-ジョブの情報を取得・表示"><a href="#2-実行中のバックアップ-ジョブの情報を取得・表示" class="headerlink" title="2.実行中のバックアップ ジョブの情報を取得・表示"></a>2.実行中のバックアップ ジョブの情報を取得・表示<a id="a"></a></h4><p>下記コマンドを実行することで、指定した VM の実行中のバックアップ ジョブの一覧が確認できます。<br>下記例では1つしかないため、$Jobs[0] に実行中のバックアップ ジョブの情報が格納されます。<br>複数ある場合は直近に実行されたものから若い番号に格納されます。</p><blockquote><p>コマンド：<br><code> </code> <code>$Jobs = (Get-AzRecoveryservicesBackupJob -Status &quot;InProgress&quot; -VaultId $Vault.id | ? &#123;$_.WorkloadName -eq $vmName&#125;)</code> <code> </code><br><code> </code> <code>$Jobs</code> <code> </code></p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/142238480-a33273d9-7e95-43e0-b23a-451b947fd4f3.png" alt="Check_job_status_ps_1"></p><blockquote><p>コマンド：<code> </code> <code>$Jobs[0]</code> <code> </code></p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/142238471-c9927a38-86e5-4a5d-9140-dee620472a93.png" alt="Check_job_status_ps_2"></p><h4 id="3．実行中のバックアップ-ジョブのサブタスクを取得・表示"><a href="#3．実行中のバックアップ-ジョブのサブタスクを取得・表示" class="headerlink" title="3．実行中のバックアップ ジョブのサブタスクを取得・表示"></a>3．実行中のバックアップ ジョブのサブタスクを取得・表示</h4><p>下記コマンドを実行することでサブタスクのステータスが確認できます。<br>下記例では、Take Snapshot は Completed、Transfer data to vault は InProgress 、となっており、スナップショットの取得が終わり、 Recovery Services コンテナーへの転送中であることが分かります。</p><blockquote><p>コマンド：<br><code> </code> <code>$SubTasks = Get-AzRecoveryServicesBackupJobDetail -Job $Jobs[0]  -VaultId $Vault.id</code> <code> </code><br><code> </code> <code>$SubTasks.subtasks</code> <code> </code></p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/142249583-ef423e62-9bef-4352-bc34-6a87edf18b4a.png" alt="Check_sub_task_ps_1"></p><p>上記警告については、現在使用可能な ”Get-AzRecoveryServicesBackupJobDetail” のエイリアス ”Get-AzRecoveryServicesBackupJobDetails” が将来的に廃止されていることを示しますが、上記のコマンドであれば使用していないので無視していただいて構いません。</p><p>また下記コマンドを実行していただくことで警告を表示させないことが可能です。</p><blockquote><p>コマンド：Set-Item Env:\SuppressAzurePowerShellBreakingChangeWarnings “true”</p></blockquote><p>上記のコマンドを実行したところ警告が出ていないことが分かります。</p><p><img src="https://user-images.githubusercontent.com/71251920/142249588-14b3aca1-3e4d-4948-81a9-b874ec1b5dc1.png" alt="Check_sub_task_ps_2"></p><p>・How do I get rid of the warnings? (警告の非表示について)<br><a href="https://github.com/Azure/azure-powershell/blob/main/documentation/breaking-changes/breaking-changes-messages-help.md#how-do-i-get-rid-of-the-warnings">https://github.com/Azure/azure-powershell/blob/main/documentation/breaking-changes/breaking-changes-messages-help.md#how-do-i-get-rid-of-the-warnings</a></p><h4 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h4><p>なお、<a href="#a">2.実行中のバックアップ ジョブの情報を取得・表示</a> で下記のように　VM 名を指定しない場合、その他の実行中のバックアップ ジョブも表示されます。(実行中のその他の VM がある場合)</p><blockquote><p>コマンド：<br><code> </code> <code>$Jobs = Get-AzRecoveryservicesBackupJob -Status &quot;InProgress&quot; -VaultId $Vault.id</code> <code> </code><br><code> </code> <code>$Jobs</code> <code> </code></p></blockquote><p>その際の $Jobs[0]、$Jobs[1] の値は次のようになります。<br><img src="https://user-images.githubusercontent.com/71251920/142242086-55eda1c2-5509-4bac-9c5c-c7d1b64c3401.png" alt="Check_job_status_ps_3"></p><ul><li>参考：<br>・APowerShell を使用して Azure VM をバックアップおよび復元する - バックアップ ジョブの監視<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-automation#monitoring-a-backup-job">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-automation#monitoring-a-backup-job</a><br>・Get-AzRecoveryServicesBackupJob<br><a href="https://docs.microsoft.com/ja-jp/powershell/module/az.recoveryservices/get-azrecoveryservicesbackupjob?view=azps-6.6.0">https://docs.microsoft.com/ja-jp/powershell/module/az.recoveryservices/get-azrecoveryservicesbackupjob?view=azps-6.6.0</a></li></ul><h2 id="2-サブタスク-Take-Snapshot-フェーズ-にかかった時間を確認する方法"><a href="#2-サブタスク-Take-Snapshot-フェーズ-にかかった時間を確認する方法" class="headerlink" title="2. サブタスク (Take Snapshot フェーズ) にかかった時間を確認する方法 "></a>2. サブタスク (Take Snapshot フェーズ) にかかった時間を確認する方法 <a id="2"></a></h2><p>お客様では Azure Portal、およびコマンド (Azure CLI 、Azure PowerShell) を用いても残念ながらサブタスク (Take Snapshot フェーズ) にかかった時間を確認できません。<br>しかし、お問い合わせいただくことで弊社にてお客様環境の実績値をお調べしお伝えすることが可能です。<br>その際には下記情報を添えてお問い合わせいただきますようお願いいたします。<br>　・サブスクリプション ID<br>　・VM 名およびそのリソースグループ名<br>　・Recovery Services コンテナー 名およびそのリソースグループ名</p><p>また、今後のバックアップ ジョブであれば、<a href="#1">1. サブタスク (Take Snapshot フェーズ) 確認方法</a>を参考にしていただくことでおおよそ可能かと存じます。<br>具体的には、実行中のバックアップ ジョブを検知し、ループを回して定期的に対象のサブタスク (Take Snapshot フェーズ等) のステータスを確認し、Inprogress である間の時間を計測していただくことでおおよその時間を測定いただければと存じます。<br>なお、具体的な実装につきましては、恐縮ながら Azure サポートサービスの範囲外であるためお客様ご自身でご実装いただきますようお願いいたします。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは。Azure Backup サポートの山本です。&lt;br&gt;今回はお問い合わせをいただくことが多い、 &lt;strong&gt;“Azure VM Backup における Take Snapshot フェーズの確認方法”&lt;/s</summary>
      
    
    
    
    
    <category term="Azure VM Backup" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-VM-Backup/"/>
    
  </entry>
  
  <entry>
    <title>Azure VM Backupでリストアされるディスク名に関して</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureVMBackup/About_Restored_Disk/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureVMBackup/About_Restored_Disk/</id>
    <published>2021-11-03T03:00:00.000Z</published>
    <updated>2021-11-18T02:53:41.648Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><h4 id="Azure-VM-Backupでリストアされるディスク名に関して"><a href="#Azure-VM-Backupでリストアされるディスク名に関して" class="headerlink" title="Azure VM Backupでリストアされるディスク名に関して"></a>Azure VM Backupでリストアされるディスク名に関して</h4><p>こんにちは、Azure Backup サポートの山本です。<br>今回は、Azure VM Backup でリストアされるディスク名に関してよくいただくお問い合わせとして、下記 2 点についてご案内いたします。<br><strong>１．「リストアするディスクの名前を指定できるか」</strong><br><strong>２．「リストアしたディスクの名前を変更可能か」</strong></p><h3 id="１．「リストアするディスクの名前を指定できるか」"><a href="#１．「リストアするディスクの名前を指定できるか」" class="headerlink" title="１．「リストアするディスクの名前を指定できるか」"></a>１．「リストアするディスクの名前を指定できるか」</h3><p>結論から申し上げますと、リストアにて作成されるディスクの名前は指定することができません。<br>また、現在の仕様として下記のような命名規則で作成されます。</p><h3 id="lt-リストアされたディスク命名規則について-gt"><a href="#lt-リストアされたディスク命名規則について-gt" class="headerlink" title="&lt;リストアされたディスク命名規則について&gt;"></a>&lt;リストアされたディスク命名規則について&gt;</h3><p>ディスクの復元が完了しますとリソース グループに OS ディスクとデータ ディスク (ある場合) が以下の命名規則で作成されます。</p><blockquote><p>   &lt;VM名&gt; - osdisk - yyyymmdd - hhmmss<br>   &lt;VM名&gt; - datadisk - &lt;lun 番号&gt; - yyyymmdd – hhmmss</p></blockquote><p>なお、VM 名に - が入っている場合には省略されます。<br>例えば、Windows2019-Disk-Test という VM 名の場合は下記のディスク名で復元されます。　　　</p><blockquote><p>windows2019disktest-osdisk–20210414-125726</p></blockquote><h3 id="２．「リストアしたディスクの名前を変更可能か」"><a href="#２．「リストアしたディスクの名前を変更可能か」" class="headerlink" title="２．「リストアしたディスクの名前を変更可能か」"></a>２．「リストアしたディスクの名前を変更可能か」</h3><p>結論から申し上げますと、Azure VM Backupからリストアしたディスク含め、Azure のマネージドディスクは、下記のとおり<strong>作成済のディスクの名前を変更することはできません</strong>。<br>・ディスクに関してよく寄せられる質問 - マネージド ディスクまたはアンマネージド ディスクの名前を、作成後に変更できますか?<br><a href="https://docs.microsoft.com/ja-jp/azure/virtual-machines/faq-for-disks#------------------------------------------">https://docs.microsoft.com/ja-jp/azure/virtual-machines/faq-for-disks</a></p><blockquote><p>マネージド ディスクの名前は変更できません。 ただし、アンマネージド ディスクの場合は、現在 VHD または VM にアタッチされていなければ、名前を変更できます。</p></blockquote><p>そのため、Azure VM Backup によってリストアされたディスク名を変更されたい場合、代替案として下記がございます。</p><h3 id="代替案"><a href="#代替案" class="headerlink" title="代替案"></a>代替案</h3><p>〈作業概要〉<br>1）復元された OS ディスク・データディスクの「スナップショットの作成」を実施<br>2）作成された OS ディスク・データ ディスクのスナップショットを選択のうえ、さらに「ディスクの作成」を実施（このとき、「ディスク名」を希望の名前で作成）<br>3）仮想マシンへ３）で作成したディスクを、スワップ・アタッチ<br>＊任意の名前のディスクの作成完了後、変更前のディスクは不要であれば削除いただいてかまいません。</p><p>下記のように、ディスクのスナップショットからのディスクの作成の場合、任意の名前を指定することが可能です。<br><img src="https://user-images.githubusercontent.com/71251920/140078998-fe56c03e-f230-4c17-85c6-da53d170172a.jpg" alt="CreateDiskFromSnapshot"></p><p>詳細手順に関しましては、 Azure Iaas テクニカル サポートチームより、下記のブログがございますので参考にしていただければ幸いです。<br>なお、下記リンク先では OS ディスクに限定していますが、データディスクでも同様の手順で既存のディスク (リストアされたディスク) の名前を変更することが可能です。<br>・既存 VM の OS ディスクのリソース名を変更する<br><a href="https://jpaztech.github.io/blog/vm/how-to-change-os-disk-name/">https://jpaztech.github.io/blog/vm/how-to-change-os-disk-name/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;h4 id=&quot;Azure-VM-Backupでリストアされるディスク名に関して&quot;&gt;&lt;a href=&quot;#Azure-VM-Backupでリストアされるディスク名に関して&quot; class=&quot;headerlink&quot; title=&quot;Azur</summary>
      
    
    
    
    
    <category term="Azure VM Backup" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-VM-Backup/"/>
    
  </entry>
  
  <entry>
    <title>Azure VM Backup の クロスリージョン リストア をした際に Error Code ”UserErrorVmProvisioningFailedDueToLackOfResources” で失敗する。</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureVMBackup/CRR_UserErrorVmProvisioningFailedDueToLackOfResources/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureVMBackup/CRR_UserErrorVmProvisioningFailedDueToLackOfResources/</id>
    <published>2021-10-22T03:00:00.000Z</published>
    <updated>2021-11-18T02:53:41.648Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは。Azure Backup サポートの山本です。<br>今回はお問い合わせをいただくことが多い、 <strong>“クロスリージョン リストア を実施した際にセカンダリ リージョン (ペアリージョン) へリストアできない、Error Code : serErrorVmProvisioningFailedDueToLackOfResources で失敗する”</strong> といったお問い合わせについて解説させていただきます。<br>*プライマリリージョンが東日本リージョンの場合、セカンダリリージョンは西日本リージョンとなります。<br>結論から申し上げますと、<strong>対象の VM が東日本リージョンでは 対応しているが、西日本リージョンでは対応していない VM Size であること</strong>が原因でございます。<br>*また、セカンダリリージョンの CPU クオーター制限には抵触していないことが前提でございます。</p><p>ペアリージョンの関係は下記をご確認いただければ幸いです。<br>・ビジネス継続性とディザスター リカバリー (BCDR):Azure のペアになっているリージョン - Azure リージョン ペア<br><a href="https://docs.microsoft.com/ja-jp/azure/best-practices-availability-paired-regions#azure-regional-pairs">https://docs.microsoft.com/ja-jp/azure/best-practices-availability-paired-regions#azure-regional-pairs</a></p><h3 id="本事象の場合に発生する-Error-Code"><a href="#本事象の場合に発生する-Error-Code" class="headerlink" title="本事象の場合に発生する Error Code"></a>本事象の場合に発生する Error Code</h3><hr><p><strong>[Error code]</strong><br>UserErrorVmProvisioningFailedDueToLackOfResources<br><strong>[Warning message]</strong><br>Failed in provisioning the restored VM due to insufficient capacity for the requested VM size in this region.<br><strong>[Recommended action]</strong><br>Read more about improving likelihood of provisioning success at <a href="http://aka.ms/allocation-guidance">http://aka.ms/allocation-guidance</a>. Alternatively try restoring disks to a storage account and then create a VM</p><hr><h3 id="具体的な問題が起こるシナリオ"><a href="#具体的な問題が起こるシナリオ" class="headerlink" title="具体的な問題が起こるシナリオ"></a>具体的な問題が起こるシナリオ</h3><p>例えば、東日本リージョンで Standard E4as_v4 の VM のバックアップを取得しており、クロスリージョン リストアにて西日本リージョンで新規 VM の作成を行う場合に発生いたします。</p><h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>原因としましては、<strong>対象の VM が東日本リージョンでは 対応しているが、西日本リージョンでは対応していない VM Size であること</strong>が原因でございます。 </p><p>下記 URL からリージョンごとにおける VM の対応状況が分かります。<br>今回の Standard E4as_v4の場合、東日本リージョン (Japan East) ではサポートされているが 、西日本リージョン (Japan West) ではサポートされていないことが分かります。<br>下記の URL の通り、東日本リージョン (Japan East) ではサポートされているが 、西日本リージョン (Japan West) ではサポートされていない VM Size が複数ございます。<br>・Products available by region( Virtual Machines)<br><a href="https://azure.microsoft.com/en-us/global-infrastructure/services/?products=virtual-machines&amp;regions=non-regional,us-east,us-east-2,us-central,us-north-central,us-south-central,us-west-central,us-west,us-west-2,japan-east,japan-west">https://azure.microsoft.com/en-us/global-infrastructure/services/?products=virtual-machines&amp;regions=non-regional,us-east,us-east-2,us-central,us-north-central,us-south-central,us-west-central,us-west,us-west-2,japan-east,japan-west</a></p><p><img src="https://user-images.githubusercontent.com/71251920/138295057-8819eb23-3029-403d-9d87-f764ce7b026c.jpg" alt="VM Size_Region_Compatibility"></p><h3 id="回避策"><a href="#回避策" class="headerlink" title="回避策"></a>回避策</h3><p>上記の原因の場合、以下の 2 通りの対応策が考えられます。<br>1.ペアリージョンの両方でサポートされている VM Size を利用する。<br>2.一度 クロスリージョン リストア にて ”ディスクの復元” (VMの作成ではなく) をしていただき、ディスクから VM を作成し、その際に VM Size を変更する。<br>データディスクがある場合は復元したディスクを選択しアタッチする。(LUN 番号が入れ替わらないようにご注意ください)</p><p>下記弊社検証環境での画面ショットです。<br>ディスクから作成することで、下記のように VM Size を変更することが可能です。<br>また、ＶＭ Size に加えて NIC なども設定することが可能です。</p><p><img src="https://user-images.githubusercontent.com/71251920/138295033-694d40b5-8e4e-4366-8f01-b91db652a38e.png" alt="DIskからのVM作成(VM Size Change)"></p><h3 id="lt-リストアされたディスク命名規則について-gt"><a href="#lt-リストアされたディスク命名規則について-gt" class="headerlink" title="&lt;リストアされたディスク命名規則について&gt;"></a>&lt;リストアされたディスク命名規則について&gt;</h3><p>ディスクの復元が完了しますとリソース グループに OS ディスクとデータ ディスク (ある場合) が以下の命名規則で作成されます。</p><blockquote><p>   &lt;VM名&gt; - osdisk - yyyymmdd - hhmmss<br>   &lt;VM名&gt; - datadisk - &lt;lun 番号&gt; - yyyymmdd – hhmmss</p></blockquote><p>なお、VM 名に - が入っている場合には省略されます。<br>例えば、Windows2019-Disk-Test という VM 名の場合は下記のディスク名で復元されます。　　　</p><blockquote><p>windows2019disktest-osdisk–20210414-125726</p></blockquote><h3 id="参考情報"><a href="#参考情報" class="headerlink" title="参考情報"></a>参考情報</h3><p>ディスクからの VM 作成に関して下記、弊社が公開している技術情報に手順がございます。<br>・ディスクからの VM の作成<br><a href="https://docs.microsoft.com/ja-jp/azure/virtual-machines/windows/create-vm-specialized-portal#create-a-vm-from-a-disk">https://docs.microsoft.com/ja-jp/azure/virtual-machines/windows/create-vm-specialized-portal#create-a-vm-from-a-disk</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは。Azure Backup サポートの山本です。&lt;br&gt;今回はお問い合わせをいただくことが多い、 &lt;strong&gt;“クロスリージョン リストア を実施した際にセカンダリ リージョン (ペアリージョン) へリストア</summary>
      
    
    
    
    
    <category term="Azure VM Backup" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-VM-Backup/"/>
    
  </entry>
  
  <entry>
    <title>Azure VM Backup では オフライン バックアップができるのか</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureVMBackup/Azure_VM_Offline_backup/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureVMBackup/Azure_VM_Offline_backup/</id>
    <published>2021-10-20T03:00:00.000Z</published>
    <updated>2021-11-18T02:53:41.648Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><h4 id="Azure-VM-Backup-では-オフライン-バックアップができるのか"><a href="#Azure-VM-Backup-では-オフライン-バックアップができるのか" class="headerlink" title="Azure VM Backup では オフライン バックアップができるのか"></a>Azure VM Backup では オフライン バックアップができるのか</h4><p>皆様こんにちは。Azure Backup サポートの山本です。<br>今回はお問い合わせをいただくことが多い、Azure VM Backup でオフライン バックアップができるのかというご要望について解説します。<br>こちらまず、結論から申し上げますと<strong>可能</strong>でございます。</p><h3 id="オンラインバックアップについて"><a href="#オンラインバックアップについて" class="headerlink" title="オンラインバックアップについて"></a>オンラインバックアップについて</h3><p>まず、オンライン バックアップの場合 、Azure VM Backup は Windows VM の場合も Linux VM の場合も、それぞれのエージェント (およびバックアップ拡張機能) と通信・連携し、スナップショットを取得しています。<br>その際の整合性は通常 Windows OS の場合は VSS (ボリューム シャドウ コピー サービス) と連携しアプリケーション整合性となり、Linux VM の場合は通常ファイルシステム整合性 (スクリプトを構成している場合はアプリケーション整合性) となります。</p><p>・Azure VM バックアップの概要 - スナップショットの整合性<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-introduction#snapshot-consistency">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-introduction#snapshot-consistency</a><br>・Azure Linux VM のアプリケーション整合性バックアップ<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-linux-app-consistent">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-linux-app-consistent</a></p><p><img src="https://user-images.githubusercontent.com/71251920/137937912-912a42c1-f750-4c8b-a157-6a3db50f11c7.png" alt="Windows OS のオンラインバックアップ - アプリケーション整合性"></p><p><img src="https://user-images.githubusercontent.com/71251920/137937882-bb5ea0da-be8a-451c-bd3a-a24c4a8070c4.png" alt="Linux OS のオンラインバックアップ - ファイルシステム整合性"></p><h3 id="オフラインバックアップについて"><a href="#オフラインバックアップについて" class="headerlink" title="オフラインバックアップについて"></a>オフラインバックアップについて</h3><p>次に、オフライン バックアップの場合、VM の電源が落ちているのでエージェントは動いていないため、VM との連携をせずにスナップショットを取得します。(VM 内部と連携しません。)<br>その際の整合性は Windows VM / Linux VM を問わずクラッシュ整合性となります。<br><img src="https://user-images.githubusercontent.com/71251920/137937936-0d85b5e6-7bb8-4131-9553-ec7c9e0e0d58.png" alt="オフライン バックアップ - クラッシュ整合性"></p><h3 id="留意点"><a href="#留意点" class="headerlink" title="留意点"></a>留意点</h3><p>上記のとおり、 Azure VM の電源はオン / オフ どちらでも Azure VM Backup を取得することが可能です。<br>留意点としましては、バックアップ実行中 (正確にはスナップショット取得中) には電源状態の変更を行わないようにお願いします。<br>Azure VM Backup が失敗する可能性がございます。</p><h3 id="参考情報"><a href="#参考情報" class="headerlink" title="参考情報"></a>参考情報</h3><p>・Azure VM バックアップの概要 - スナップショットの整合性<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-introduction#snapshot-consistency">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-introduction#snapshot-consistency</a><br>・Azure Linux VM のアプリケーション整合性バックアップ<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-linux-app-consistent">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-linux-app-consistent</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;h4 id=&quot;Azure-VM-Backup-では-オフライン-バックアップができるのか&quot;&gt;&lt;a href=&quot;#Azure-VM-Backup-では-オフライン-バックアップができるのか&quot; class=&quot;headerlink&quot; t</summary>
      
    
    
    
    
    <category term="Azure VM Backup" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-VM-Backup/"/>
    
  </entry>
  
  <entry>
    <title>Azure VM のリストアの際 NIC の設定が消えてしまう</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureVMBackup/VMRestoring_NIC_Configuration/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureVMBackup/VMRestoring_NIC_Configuration/</id>
    <published>2021-10-20T03:00:00.000Z</published>
    <updated>2021-11-18T02:53:41.648Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><h4 id="Azure-VM-のリストアの際-NIC-の設定が消えてしまう"><a href="#Azure-VM-のリストアの際-NIC-の設定が消えてしまう" class="headerlink" title="Azure VM のリストアの際 NIC の設定が消えてしまう"></a>Azure VM のリストアの際 NIC の設定が消えてしまう</h4><p>皆様こんにちは。Azure Backup サポートの山本です。<br>今回はお問い合わせをいただくことが多い、Azure VM のリストアの際 NIC の設定が消えてしまうというお問い合わせについて解説させていただきます。</p><p>こちら結論から申し上げますと、<strong>Azure VM Backupのリストアメニューにて、[新規VMの作成] を選んだ際、デフォルトで NIC が新たに作成され (設定できない) アタッチされるため、復元時に NIC の情報が消えてしまうのは仕様</strong>となっております。<br>Azure VM Backup ではディスクの情報をバックアップしますが、NIC の情報はバックアップいたしません。<br>なお、リストアメニューにて [既存の置き換え] を選択された場合は VM のディスクのみを入れ替え (スワップ) 、NIC はそのまま利用されるため、NIC の設定が消えるようなことは起こりません。</p><h3 id="代替案"><a href="#代替案" class="headerlink" title="代替案"></a>代替案</h3><p>次のような代替案がございます。<br>(手順１) Azure VM バックアップのリストア メニューからディスクとして一旦復元する。<br>(手順２) ディスクから VM を作成する。<br>      その際に既存の任意の設定をいれた NIC を選択する。<br>    　データディスクがある場合は復元したディスクを選択しアタッチする。(LUN 番号が入れ替わらないようにご注意ください)</p><p>(手順２) に関しましては、 Azure Portal からの操作の場合、下記のような手順で可能でございます。<br>NIC を指定できることが分かります。<br><img src="https://user-images.githubusercontent.com/71251920/137943407-1dad9711-f799-4921-9365-17f1ac006f3b.png" alt="DiskからのVM作成"></p><h3 id="lt-リストアされたディスク命名規則について-gt"><a href="#lt-リストアされたディスク命名規則について-gt" class="headerlink" title="&lt;リストアされたディスク命名規則について&gt;"></a>&lt;リストアされたディスク命名規則について&gt;</h3><p>ディスクの復元が完了しますとリソース グループに OS ディスクとデータ ディスク (ある場合) が以下の命名規則で作成されます。</p><blockquote><p>   &lt;VM名&gt; - osdisk - yyyymmdd - hhmmss<br>   &lt;VM名&gt; - datadisk - &lt;lun 番号&gt; - yyyymmdd – hhmmss</p></blockquote><p>なお、VM 名に - が入っている場合には省略されます。<br>例えば、Windows2019-Disk-Test という VM 名の場合は下記のディスク名で復元されます。　　　</p><blockquote><p>windows2019disktest-osdisk–20210414-125726</p></blockquote><h3 id="参考情報"><a href="#参考情報" class="headerlink" title="参考情報"></a>参考情報</h3><p>・Azure portal で Azure VM データを復元する方法 - ディスクを復元する<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-arm-restore-vms#restore-disks">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-arm-restore-vms#restore-disks</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;h4 id=&quot;Azure-VM-のリストアの際-NIC-の設定が消えてしまう&quot;&gt;&lt;a href=&quot;#Azure-VM-のリストアの際-NIC-の設定が消えてしまう&quot; class=&quot;headerlink&quot; title=&quot;Azure </summary>
      
    
    
    
    
    <category term="Azure VM Backup" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-VM-Backup/"/>
    
  </entry>
  
  <entry>
    <title>グローバル アセンブリ キャッシュの警告イベントについて</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureVMBackup/GAC/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureVMBackup/GAC/</id>
    <published>2021-10-01T03:00:00.000Z</published>
    <updated>2021-11-18T02:53:41.648Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><h4 id="グローバルアセンブリキャッシュ-GAC-の警告イベントについて"><a href="#グローバルアセンブリキャッシュ-GAC-の警告イベントについて" class="headerlink" title="グローバルアセンブリキャッシュ (GAC) の警告イベントについて"></a>グローバルアセンブリキャッシュ (GAC) の警告イベントについて</h4><p>皆様こんにちは。Azure Backup サポートの谷脇です。<br>今回はお問い合わせをいただくことが多い、 Windows VM の Azure VM バックアップ取得時に発現するイベントログについて解説させていただきます。</p><p>バックアップを取得した際に、『グローバル アセンブリ キャッシュからのアセンブリの削除に失敗しました』の警告が表示される。</p><p>こちらの警告は、グローバルアセンブリキャッシュ (GAC) からファイルの削除に失敗した際に出力されます。<br>※ グローバルアセンブリキャッシュとは<br>コンピュータ上の多数のアプリケーション間で共有するためにインストールされたアセンブリを格納するマシン全体のコード キャッシュ。</p><p>Azure Backup では、 Azure VM のバックアップを取得する際に、以下の2つのファイルを削除、インストールする場合があります。このメッセージが発現した際は、GAC 上からその削除、インストールに失敗しています。<br>・iaasvmazurestorage.dll<br>・iaasvmsnapshotmessage.dll</p><p>このエラーが出る要因として、以前のファイルが存在しない場合や、以前のファイルがロックされている場合が考えられます。しかしながらファイルの削除やインストールはリトライが行われリトライにより成功する場合も多くなっております。<br>従って、正常に Azure Backup によるバックアップが取得できている場合、GAC 上のファイルは正常に参照できている状態であり、無視可能なエラーメッセージです。</p><p>以下の画面のようなイベントログが発現します。</p><blockquote><p>&lt;イベントログ例 &gt;<br>ソース : COM+ SOAP Services<br>EventID : 0<br>Message : グローバル アセンブリ キャッシュからのアセンブリの削除に失敗しました :  C:\Packages\Plugins\Microsoft.Azure.RecoveryServices.VMSnapshot\1.0.70.0\iaasvmsnapshotmessage.dll iaasvmsnapshotmessage,Version=3.0.0.0</p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/135617775-6ac8b8e6-c1a7-4311-9375-8389248969fe.png" alt="グローバル アセンブリ キャッシュのエラー"><br>このエラーメッセージが発現することを抑止する方法はありませんが、正常にバックアップが取得できていましたら、上記の通り無視可能なエラーメッセージです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;h4 id=&quot;グローバルアセンブリキャッシュ-GAC-の警告イベントについて&quot;&gt;&lt;a href=&quot;#グローバルアセンブリキャッシュ-GAC-の警告イベントについて&quot; class=&quot;headerlink&quot; title=&quot;グローバルア</summary>
      
    
    
    
    
    <category term="Azure VM Backup" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-VM-Backup/"/>
    
  </entry>
  
  <entry>
    <title>Azure VM バックアップを任意のタイミングのみで取得したい</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureVMBackup/invalid_schedule/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureVMBackup/invalid_schedule/</id>
    <published>2021-10-01T03:00:00.000Z</published>
    <updated>2021-11-18T02:53:41.660Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><h4 id="Azure-VM-バックアップを任意のタイミングのみで取得したい"><a href="#Azure-VM-バックアップを任意のタイミングのみで取得したい" class="headerlink" title="Azure VM バックアップを任意のタイミングのみで取得したい"></a>Azure VM バックアップを任意のタイミングのみで取得したい</h4><p>皆様こんにちは。Azure Backup サポートの谷脇です。<br>今回はお問い合わせをいただくことが多い、 “任意のタイミングのみでバックアップの取得をしたい”、というご要望について解説します。</p><p>まず、Azure VM バックアップはバックアップ ポリシーを利用しスケジュールされたバックアップを取得する運用を想定した製品仕様となっております。<br>しかし、任意のタイミングのみでバックアップする場合、バックアップを取得するタイミング以外は基本的にバックアップポリシーが無効化された状態となります。<br>そのため、<strong>弊社としては任意のタイミングのみでバックアップを取得していただく運用を推奨しておりません。</strong></p><p>一方、上記のように任意のタイミングのみでバックアップを行いたいというご要望は多く寄せられております。<br>任意のタイミングのみでバックアップを取得する運用を行う際の懸念点がございますので以下にてご紹介します。<br>懸念点を踏まえ、任意のタイミングのみでバックアップを取得する運用方法について解説させていただきます。</p><p>以下の文章では、任意のタイミングで取得していただくバックアップを [アドホック バックアップ] 、スケジュールされ取得していただくバックアップを [スケジュール バックアップ] としています。</p><h4 id="アドホック-バックアップのみを取得する運用を行う際の懸念点"><a href="#アドホック-バックアップのみを取得する運用を行う際の懸念点" class="headerlink" title="[アドホック バックアップのみを取得する運用を行う際の懸念点]"></a>[アドホック バックアップのみを取得する運用を行う際の懸念点]</h4><p>通常時、バックアップ ポリシーを無効化 (バックアップの停止) し、必要なときだけバックアップを有効化しアドホック バックアップを取得する場合、下記のような懸念点が考えられます。</p><p>Azure Poretal からバックアップ アイテムを選択し、[バックアップの停止] を行うことが出来ます。</p><p><img src="https://user-images.githubusercontent.com/71251920/135618848-76248e66-8013-452e-a471-c4f7c8c37281.png" alt="Stop Azure VM Backup"></p><p>バックアップ ポリシーを無効化すると Garbage Collection と呼ばれるクリーンアップが実行されず、期限切れ復旧ポイントや復旧ポイントのメタデータがクリーンアップされません。<br>メタデータがたまることによって最短で 18 個以上復旧ポイントがたまった場合に、それ以降のバックアップが取得できなくなる可能性があります。</p><p>バックアップが有効化されている場合、Garbage Collection が一日 (24 時間) のうちどこかで行われる仕様ですので、上記エラーは通常は発生いたしません。</p><p>上記の懸念点を踏まえ、アドホック バックアップのみでの運用方法をご紹介します。</p><p>[アドホック バックアップのみを取得する運用を行う方法]<br>あくまで一例ですが、週に一度 48 時間程度バックアップを有効化していただくことでGarbage Collection を実行する方法がございます。<br>(バックアップを有効化した状態で、24 時間のうちどこかで Garbage Collection が実行されますので、目安として 48 時間としています。)<br>こちらの方法で定期的に Garbage Collection を行うことが出来ます。</p><h4 id="具体的な運用方法の例"><a href="#具体的な運用方法の例" class="headerlink" title="[具体的な運用方法の例]"></a>[具体的な運用方法の例]</h4><p>週１回 水曜日にバックアップを実行するスケジュールを組んだバックアップ ポリシーを作成し、適用します。<br>平日は [バックアップの停止] をし、週末の土曜日、日曜日だけ [バックアップの再開] をします。</p><p>上記の運用でしたら、アドホック バックアップを取得せず、週末に Garbage Collection を実行させる運用が可能です。</p><p>また、スケジュール バックアップが不要で、バックアップの頻度が低く、オフライン バックアップ (VM が停止した状態で取得するバックアップ) の取得をされる場合、Azure VM バックアップ以外のサービスを用いていただく以下のようなディスクのスナップショットを用いる代替案もございます。</p><h4 id="代替案"><a href="#代替案" class="headerlink" title="[代替案]"></a>[代替案]</h4><p>スケジュール バックアップが不要で、バックアップの頻度が低く、オフライン バックアップ (VM が停止した状態で取得するバックアップ) の取得をされる場合、ディスクのスナップショットを用いる代替案がございます。<br>保持期限などはなく、任意のタイミングで削除できます。<br>スナップショットからディスクを作成することができ、そこから VM に対してディスクのスワップや新規 VM の作成を行うことができます。</p><p>ディスクのスナップショットに関しましては下記ドキュメントに記載がございます。<br>・ VM を停止 (割り当て解除) し、OS ディスクの [スナップショット] を取得<br><a href="https://jpaztech.github.io/blog/vm/vm-replica-3/#2-VM-%E3%82%92%E5%81%9C%E6%AD%A2-%E5%89%B2%E3%82%8A%E5%BD%93%E3%81%A6%E8%A7%A3%E9%99%A4-%E3%81%97%E3%80%81OS-%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E3%81%AE-%E3%82%B9%E3%83%8A%E3%83%83%E3%83%97%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88-%E3%82%92%E5%8F%96%E5%BE%97">https://jpaztech.github.io/blog/vm/vm-replica-3/#2-VM-%E3%82%92%E5%81%9C%E6%AD%A2-%E5%89%B2%E3%82%8A%E5%BD%93%E3%81%A6%E8%A7%A3%E9%99%A4-%E3%81%97%E3%80%81OS-%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E3%81%AE-%E3%82%B9%E3%83%8A%E3%83%83%E3%83%97%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88-%E3%82%92%E5%8F%96%E5%BE%97</a></p><p>・ポータルまたは PowerShell を使用してスナップショットを作成する<br><a href="https://docs.microsoft.com/ja-jp/azure/virtual-machines/snapshot-copy-managed-disk?tabs=portal">https://docs.microsoft.com/ja-jp/azure/virtual-machines/snapshot-copy-managed-disk?tabs=portal</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;h4 id=&quot;Azure-VM-バックアップを任意のタイミングのみで取得したい&quot;&gt;&lt;a href=&quot;#Azure-VM-バックアップを任意のタイミングのみで取得したい&quot; class=&quot;headerlink&quot; title=&quot;Azur</summary>
      
    
    
    
    
    <category term="Azure VM Backup" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-VM-Backup/"/>
    
  </entry>
  
  <entry>
    <title>ABRS &amp; SCEM チームについて</title>
    <link href="https://jpabrs-scem.github.io/blog/information/team-introduction/"/>
    <id>https://jpabrs-scem.github.io/blog/information/team-introduction/</id>
    <published>2021-09-17T03:00:00.000Z</published>
    <updated>2021-11-18T02:53:41.660Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><h4 id="ABRS-amp-SCEM-チームについて"><a href="#ABRS-amp-SCEM-チームについて" class="headerlink" title="ABRS &amp; SCEM チームについて"></a>ABRS &amp; SCEM チームについて</h4><p>我々のチームは文字通り、ABRS と SCEM という二つの領域をカバーしているチームです。<br>ABRS チーム (Azure Backup and Recovery Service) は主にデータ保護ソリューションを提供する技術領域として Azure Backup 、SCDPM / MABS、 Azure Site Recovery 、Azure Migrate、Azure Resource Mover、Movere の技術サポートを担当しています。</p><p>また、SCEMチーム (System Center Enterprise Management) は統合運用管理製品群として提供されている System Center という製品群のうち、次の Enterprise Management製品を担当します。<br>SCOM (System Center Operations Manager), SCVMM (System Center Virtual Machine Manager), SCO (System Center Operations), SCSM (System Center Service manager) の技術サポートを担当しています。</p><p>現在は完全にフルリモートで各自家から仕事、(WfH, work from home と呼んでいます) しています。<br>新しく加入したメンバーも多いチームですが、フルリモートであっても Teams などをフル活用してメンバー間のコミュニケーションは活発に行われており、チーム全員楽しく新しいチャレンジができています。<br>以下に当チームの代表的な製品をご紹介します。</p><p>• Azure Backup<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/">https://docs.microsoft.com/ja-jp/azure/backup/</a><br>• DPM/MABS<br><a href="https://docs.microsoft.com/ja-jp/system-center/dpm/dpm-overview">https://docs.microsoft.com/ja-jp/system-center/dpm/dpm-overview</a><br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-support-matrix-mabs-dpm">https://docs.microsoft.com/ja-jp/azure/backup/backup-support-matrix-mabs-dpm</a><br>• Azure Site Recovery<br><a href="https://docs.microsoft.com/ja-jp/azure/site-recovery/">https://docs.microsoft.com/ja-jp/azure/site-recovery/</a><br>• Azure Migrate<br><a href="https://docs.microsoft.com/ja-jp/azure/migrate/">https://docs.microsoft.com/ja-jp/azure/migrate/</a><br>• System Center 製品群　<br><a href="https://docs.microsoft.com/ja-jp/system-center/">https://docs.microsoft.com/ja-jp/system-center/</a></p><h4 id="Azure-Backup-ってどんな製品？"><a href="#Azure-Backup-ってどんな製品？" class="headerlink" title="Azure Backup ってどんな製品？"></a>Azure Backup ってどんな製品？</h4><p>Azure Backup はデータをバックアップし、それを Microsoft Azure クラウド から回復するための製品です。<br>例えば、Azure VM, Azure Files, Azure Managed Disks, Azure BLOB などのバックアップを行うことが出来ます。<br>Azure VM のバックアップでは、ディスクのスナップショットを取得し、取得したスナップショットを Recovery Services コンテナーにデータ転送することで実現しています。<br>また、取得したスナップショットから復元を行うこともできます。<br><img src="https://user-images.githubusercontent.com/71251920/133728140-8c4f95d7-e3dc-4439-8356-056e0590aebf.png" alt="azure_backup"></p><h4 id="DPM-MABS-ってどんな製品？"><a href="#DPM-MABS-ってどんな製品？" class="headerlink" title="DPM/MABS ってどんな製品？"></a>DPM/MABS ってどんな製品？</h4><p>DPM (System Center Data Protection Manager) と MABS（Microsoft Azure Backup Server) は、多様な保護対象をバックアップと回復するための製品です。<br>バックアップされたデータはローカル・ディスクだけではなく、Microsoft Azure クラウドにも保存できます。<br>主に下記のワークロードを保護する機能を提供しています。<br>・Microsoft ワークロードのアプリケーション (SQL Server、Exchange、SharePoint など)<br>・Windows オペレーティング システムを実行するコンピューターのファイル、フォルダー、ボリューム<br>・Windows オペレーティング システムを実行するコンピューターのシステム状態のバックアップまたは完全なベア メタル バックアップ<br>・Windows または Linux を実行する Hyper-V 仮想マシンと VMWare 仮想マシン<br><img src="https://user-images.githubusercontent.com/71251920/133728130-f8ca4a41-0a0b-42da-ad6f-108a80fe2908.png" alt="DPM"></p><h4 id="Azure-Site-Recovery-ってどんな製品？"><a href="#Azure-Site-Recovery-ってどんな製品？" class="headerlink" title="Azure Site Recovery ってどんな製品？"></a>Azure Site Recovery ってどんな製品？</h4><p>Azure Site Recovery (ASR) は、データの保護を行うことで、メンテナンスや災害などによるシステム停止の際に、お客様のビジネス継続性の確保とディザスター リカバリー (BCDR) を可能とするための製品です。システム停止時には、プライマリ サイトからセカンダリ サイト へフェール オーバーすることで、ビジネス継続性を確保することができます。<br>主に以下の環境のデータの保護を行うことができます。<br>・Azure プライマリ リージョン から Azure セカンダリ リージョン への保護<br>・オンプレミス VM / 物理サーバー サイト から Azure サイト への保護</p><p>オンプレミス VM / 物理サーバー サイト から Azure サイト への保護の図：<br><img src="https://user-images.githubusercontent.com/71251920/133694495-87f3774d-656f-4ee4-8728-206be247a534.png" alt="ASR_P2A"></p><h4 id="Azure-Migrate-ってどんな製品？"><a href="#Azure-Migrate-ってどんな製品？" class="headerlink" title="Azure Migrate ってどんな製品？"></a>Azure Migrate ってどんな製品？</h4><p>Azure Migrate は、オンプレミスのアプリとワークロード、およびプライベート/パブリック クラウド VM の検出、評価、および Azure への移行を追跡するための中央ハブであり、Azure Migrate ツールのほか、サードパーティの ISV オファリングが用意されています。<br>Azure Migrate を使用することでオンプレミスの VMware VM、Hyper-V VM、物理サーバー、その他の仮想化された VM、データベース、Web アプリ、仮想デスクトップの評価と移行を一元化することができます。<br><img src="https://user-images.githubusercontent.com/71251920/133727696-e693d2f9-aaa2-4eeb-8bb6-498ea225a939.png" alt="Azure Migrate"></p><h4 id="System-Center-ってどんな製品？"><a href="#System-Center-ってどんな製品？" class="headerlink" title="System Center ってどんな製品？"></a>System Center ってどんな製品？</h4><p>今回は System Center 製品群のうち、SCOM (System Center Operations Manager) に関してご説明させていただきます。<br>Microsoft System Center の 1 つのコンポーネントである Operations Manager は、1 つのコンソールから多数のコンピューターのサービス、デバイス、および操作を監視できるソフトウェアです。<br>Windows Server や Linux コンピューターなどのエージェント側の死活監視からログ情報/イベント情報の監視、アラート発砲まで一元的に機能をご提供します。<br><img src="https://user-images.githubusercontent.com/71251920/133543828-aa1bc2cc-ae05-4b80-b53f-1a87b1ddce2f.png" alt="SCOM"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;h4 id=&quot;ABRS-amp-SCEM-チームについて&quot;&gt;&lt;a href=&quot;#ABRS-amp-SCEM-チームについて&quot; class=&quot;headerlink&quot; title=&quot;ABRS &amp;amp; SCEM チームについて&quot;&gt;&lt;</summary>
      
    
    
    
    
    <category term="Information" scheme="https://jpabrs-scem.github.io/blog/tags/Information/"/>
    
  </entry>
  
</feed>
